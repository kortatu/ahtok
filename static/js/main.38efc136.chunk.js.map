{"version":3,"sources":["Utils.ts","tok/Token.ts","tok/TokenSpan.tsx","tok/ParamChanger.tsx","AppActions.ts","tok/SkillTestChanger.tsx","tok/PassZone.tsx","tok/CharacterSelector.tsx","AppState.ts","tok/Scenario.ts","tok/ContextManager.tsx","CommonStyles.ts","tok/TokenBag.tsx","tok/ScenarioPassZone.tsx","TokTheme.ts","tok/AHCharacter.ts","tok/LaEraOlvidada.ts","tok/ElLegadoDeDunwich.ts","tok/Campaign.ts","tok/ElCirculoRoto.ts","AppReducers.ts","AppStore.ts","CampaignWizard.tsx","TokHeader.tsx","App.tsx","serviceWorker.ts","I18n.tsx","index.tsx"],"names":["incDecNatural","previous","incDec","Math","max","elderSignEffect","tokenBag","character","tokenSpecDef","value","count","chaos","name","actualName","id","uuid","copyTokenSpec","tokenSpec","findName","tokenBagSpec","tokens","find","t","removeToken","tokenName","newBag","map","ts","tokenSpecInBag","filter","addTokens","forEach","push","buildBagSpec","incDecContextNatural","state","key","buildEffectSpecs","effectMap","Map","effectSpecs","ns","set","effect","buildBagFromSpec","bagSpec","effects","context","tokenDef","get","FALLO_AUTOMATICO","sortTokens","sort","a","b","tokenFloatAverage","numOfTokens","reduce","sum","token","tokenAverage","floor","accumulated","previousValues","last","length","undefined","histogram","prev","curr","prevValue","concat","seal","tokensFiltered","decCount","tokenBagPassZone","accum","total","vc","prob","sorted","i","j","tokensWithValue","passZoneLines","tokenBagMap","skill","test","lines","stillPass","result","pass","nextPass","currentProb","firstFail","TokenSpan","props","useState","fadeIn","setFadeIn","Fade","in","onExited","onClick","style","cursor","className","fadeOut","fadeOutFadeIn","ContextValueChanger","valueSpec","useTranslation","type","NumericParamChanger","inline","currentValue","incValue","incDecContextValue","decValue","BooleanParamChanger","toggle","toggleContextValue","incDecStyle","verticalAlign","InputLabel","IconButton","_","Switch","checked","onChange","color","inputProps","changeSkill","changeTest","CurrentSkillTestChanger","connect","skillTest","dispatch","incSkill","decSkill","incTest","decTest","Typography","variant","CurrentPassZone","ownProps","passZone","Grid","container","alignItems","item","xs","sm","md","direction","line","PassLine","textAlign","lineSeparator","liStyle","borderColor","spacing","toFixed","noWrap","index","useStyles","makeStyles","theme","createStyles","formControl","margin","minWidth","selectEmpty","marginTop","CurrentCharacterSelector","selectedCharacter","characters","selectedCampaign","setCharacter","changeCharacter","FormControl","Select","labelId","shortName","e","target","c","aChar","MenuItem","buildBagFromState","appState","selectedScenario","scenarioEffectSpec","gameContext","initContext","contextSpec","valuesSpec","vs","initialValue","CurrentScenarioContextManager","spec","paddingTop","Object","keys","contextKey","useModalStyles","paper","position","left","top","width","opacity","backgroundColor","palette","background","border","secondary","main","boxShadow","shadows","padding","BagDisplay","showAverage","fadeOutTokens","bag","allTokensIndividually","allTokens","CurrentTokenBagManager","addToken","classes","allKnown","Box","BagSpecDisplay","CurrentScenarioPassZone","scenario","open","setOpen","Modal","onClose","aria-labelledby","Button","tokTheme","baseFontFamily","uglyQuaFontFamily","responsiveFontSizes","createMuiTheme","typography","fontFamily","join","fontSize","tonalOffset","primary","headerFontFamily","headerFontFamilyNonAscii","AHCharacters","JoeDiamond","DianaStanley","LeoAnderson","UrsulaDowns","LolaHayes","LaPerdicionDeEztli","fichas","translations","description","buildLaEraOlvidadaCampaignSpec","scenarios","min","bagSpecsByLevel","easy","normal","hard","expert","PerdidosEnElTiempoYEnElEspacio","SHROUD","AHLevels","Campaigns","TheCircleUndone","buildElCirculoRotoCampaignSpec","TheForgottenAge","TheDunwichLegacy","campaignTranslations","values","allTrans","campaign","thisTranslations","lang","scenarioLang","valueSpecLang","Campaign","campaignSpec","currentBagSpec","currentScenario","this","startCampaign","scenarioNum","scenarioIndex","getScenarioSpec","level","EnLasGarrasDelCaos","getPerdicionYBrecha","potentialBag","AnteElTronoNegro","ceil","getHalfDoomInAzathot","defaultCampaign","start","addTokensToBagSpec","startAlvaroElCirculoRotoLPDP","firstScenario","initialContext","initialSkillTest","appReducers","combineReducers","action","nextScenario","prevScenario","tokenAction","scenarioSpec","contextAction","assign","contextToggleAction","skillTestAction","loadCurrentLang","appLang","localStorage","getItem","userLang","navigator","language","dashPosition","indexOf","substring","preloadCampaign","storageStateString","JSON","parse","loadStorageStage","campaignSpecId","cId","currentCharacter","currentContext","startAlvaroLaEraOlvidada","currentScenarioSpec","initialState","store","createStore","subscribe","getState","newStorageCampaign","setItem","stringify","CampaignWizardChanger","setCampaign","close","selectCampaign","campaignWizard","setCampaignWizard","campaignId","WizardStep2","setCampaignFromWizard","WizardStep3","contains","characterId","some","ch","addCharacter","ev","error","component","FormLabel","FormGroup","FormControlLabel","control","Checkbox","label","Flags","require","TokHeader","modalOpen","setModalOpen","i18n","myLang","themeSpec","campaignName","nonAsciiCharsInName","changeLang","changeLanguage","saveLang","float","GB","ES","variantMapping","h1","App","changeScenario","ThemeProvider","CssBaseline","Container","maxWidth","Boolean","window","location","hostname","match","i18","use","initReactI18next","init","resources","es","translation","lng","fallbackLng","I18n","ReactDOM","render","StrictMode","document","getElementById","serviceWorker","ready","then","registration","unregister","catch","console","message"],"mappings":"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","file":"static/js/main.38efc136.chunk.js","sourcesContent":["export function incDecNatural(previous: number, incDec: boolean) {\n    return incDec ? previous + 1 : Math.max(0, previous - 1);\n}\n\nexport function repeat(num: number, f: () => void) {\n    for (let i = 0; i < num; i++) {\n        f();\n    }\n}\n\nexport function repeatMap<T>(num: number, f: (index: number) => T): T[] {\n    const list = []\n    for (let i = 0; i < num; i++) {\n        list.push(f(i));\n    }\n    return list;\n}\n\nexport function nonAscii(aString: string) {\n    const ascii = /^[ -~]+$/;\n    return !ascii.test(aString);\n}\n\nexport interface Translation {\n    [k: string]: string\n}\n","import {AHCharacter} from \"./AHCharacter\";\nimport {incDecNatural} from \"../Utils\";\nimport * as uuid from \"uuid\";\n\nexport interface TokenSpec {\n    id: string;\n    value: number,\n    count: number,\n    name: string,\n    chaos: boolean\n}\nexport type EffectSpec = (tokenBag: TokenBag) => number;\n\nexport const elderSignEffect = (tokenBag: TokenBag) => tokenBag.character.elderSignEffect(tokenBag);\n\nexport interface Token extends TokenSpec {\n    effect: EffectSpec;\n}\n\nexport function tokenSpecDef(value: number, count: number, chaos = false, name?: string): TokenSpec {\n    const actualName = name ?? \"Token\" + value;\n    return {\n        value, count, chaos,\n        name: actualName,\n        id: actualName + \"_\" + uuid.v4()\n    }\n}\n\nfunction copyTokenSpec(tokenSpec: TokenSpec): TokenSpec {\n    return {\n        ...tokenSpec\n    }\n}\n\nfunction decCount(t: Token) {\n    return {...t, count: t.count - 1};\n}\n\nexport interface TokenBagSpec {\n    tokens: TokenSpec[];\n}\n\nfunction findName(tokenBagSpec: TokenBagSpec, name: string): TokenSpec | undefined {\n    return tokenBagSpec.tokens.find(t => t.name === name);\n}\n\nexport function removeToken(tokenBagSpec: TokenBagSpec, tokenName: string): TokenBagSpec {\n    const newBag = {\n        tokens: tokenBagSpec.tokens.map(ts => copyTokenSpec(ts))\n    }\n    const tokenSpecInBag = findName(newBag, tokenName);\n    if (tokenSpecInBag) {\n        tokenSpecInBag.count-=1;\n    }\n    newBag.tokens = newBag.tokens.filter(ts => ts.count > 0);\n    return newBag;\n}\n\nexport function addTokens(tokenBagSpec: TokenBagSpec, ...tokens: TokenSpec[]): TokenBagSpec {\n    const newBag = {\n        tokens: tokenBagSpec.tokens.map(ts => copyTokenSpec(ts))\n    }\n    tokens.forEach(tokenSpec => {\n        const tokenSpecInBag = findName(newBag, tokenSpec.name);\n        if (tokenSpecInBag) {\n            tokenSpecInBag.count += tokenSpec.count\n        } else {\n            newBag.tokens.push(tokenSpec);\n        }\n    })\n    return newBag;\n}\n\n\nexport function buildBagSpec(...tokens: TokenSpec[]): TokenBagSpec {\n    return {tokens}\n}\n\nexport function allTokenSpecs(bagSpec: TokenBagSpec): TokenSpec[] {\n    const allTokensIndividually: TokenSpec[] = [];\n    bagSpec.tokens.forEach( t => {\n        for(let i = 0; i < t.count; i++) allTokensIndividually.push({...t, count: 1});\n    })\n    return allTokensIndividually;\n}\n\nexport function allKnownTokens(): TokenBagSpec {\n    return buildBagSpec(\n        tokenSpecDef(2, 1, false, 'elderSign'),\n        tokenSpecDef(1, 1, false),\n        tokenSpecDef(0, 1, false),\n        tokenSpecDef(-1, 1, false),\n        tokenSpecDef(-2, 1, false),\n        tokenSpecDef(-3, 1, false),\n        tokenSpecDef(-4, 1, false),\n        tokenSpecDef(-5, 1, false),\n        tokenSpecDef(-6, 1, false),\n        // tokenSpecDef(-7, 1, false),\n        tokenSpecDef(-8, 1, false),\n        // tokenSpecDef(-9, 1, false),\n        tokenSpecDef(0, 1, true, 'Calavera'),\n        tokenSpecDef(0, 1, true, 'Sectario'),\n        tokenSpecDef(0, 1, true, 'Lápida'),\n        tokenSpecDef(0, 1, true, 'Antiguo'),\n        FALLO_AUTOMATICO\n    );\n}\n\nexport type ScenarioContext = { [key: string]: number|boolean };\nexport function incDecContextNatural(state: ScenarioContext, key: string, incDec: boolean) {\n    return incDecNatural(state[key] as number, incDec);\n}\nexport function incContextValue(context: ScenarioContext, key: string): ScenarioContext {\n    const newValue: number = ((context[key] as number) ?? 0) + 1;\n    const newContext = {\n        ...context,\n        [key]: newValue\n    }\n    return newContext;\n}\n\nexport function decContextValue(context: ScenarioContext, key: string): ScenarioContext {\n    let oldValue: number = (context[key] as number) ?? 0;\n    let newContext = context;\n    if (oldValue > 0) {\n        const newValue = oldValue - 1;\n        newContext = {\n            ...context,\n            [key]: newValue\n        }\n    }\n    return newContext;\n}\n\nexport function toggleContextValue(context: ScenarioContext, key: string): ScenarioContext {\n    const oldValue = context[key] as boolean;\n    return {\n        ...context,\n        [key]: !oldValue\n    };\n}\n\nexport interface TokenBag {\n    context: ScenarioContext;\n    character: AHCharacter;\n    tokens: Token[];\n}\n\nexport type ScenarioEffectSpecs = { name: string, effect: EffectSpec }[];\n\nexport function buildEffectSpecs(...effectSpecs: ScenarioEffectSpecs): Map<string, EffectSpec> {\n    const effectMap = new Map<string, EffectSpec>();\n    effectSpecs.forEach( ns => effectMap.set(ns.name, ns.effect));\n    return effectMap;\n}\n\nexport function buildBagFromSpec(bagSpec: TokenBagSpec, effects: Map<string, EffectSpec>, character: AHCharacter, context: ScenarioContext): TokenBag {\n    return {\n        character,\n        context,\n        tokens: bagSpec.tokens.map(tokenSpec => tokenDef(tokenSpec, effects.get(tokenSpec.name)))\n    }\n}\n\n\n\nexport function tokenDef(tokenSpec: TokenSpec, effect?: EffectSpec): Token {\n    return {\n        ...tokenSpec,\n        effect: effect ?? (() => tokenSpec.value),\n    }\n}\n\nconst FALLO_AUTOMATICO_VALUE = -99\n\nexport const FALLO_AUTOMATICO = tokenSpecDef(FALLO_AUTOMATICO_VALUE, 1, true, \"Fallo\");\n\nfunction sortTokens(tokenBag: TokenBag) {\n    return tokenBag.tokens.sort((a, b) => b.effect(tokenBag) - a.effect(tokenBag));\n}\n\nexport function tokenFloatAverage(tokenBag: TokenBag) {\n    const tokens = tokenBag.tokens;\n    let numOfTokens = 0;\n    const total = tokens.reduce<number>((sum, token) => {\n        if (token.effect(tokenBag) !== FALLO_AUTOMATICO_VALUE) {\n            numOfTokens += token.count;\n            return sum + (token.effect(tokenBag) * token.count)\n        } else {\n            return sum;\n        }\n    }, 0);\n    return total / numOfTokens;\n}\n\nexport function tokenAverage(tokenBag: TokenBag): number {\n    return Math.floor(tokenFloatAverage(tokenBag));\n}\n\ninterface ValueCount {\n    value: number;\n    count: number;\n}\n\nexport function tokensWithValue(tokenBag: TokenBag, value: number): Token[] {\n    const tokens = [];\n    const sorted = sortTokens(tokenBag);\n    let i = 0;\n    while (i < sorted.length && sorted[i].effect(tokenBag) >= value) {\n        if (sorted[i].effect(tokenBag) === value) {\n            for (let j=0; j < sorted[i].count; j++) {\n                tokens.push(sorted[i]);\n            }\n        }\n        i++;\n    }\n    return tokens;\n}\n\nexport function histogram(tokenBag: TokenBag) {\n    return sortTokens(tokenBag).reduce<ValueCount[]>((previousValues: ValueCount[], token: Token) => {\n        const last = previousValues.length >= 1 ? previousValues[previousValues.length - 1] : undefined;\n        if (last && last.value === token.effect(tokenBag)) {\n            last.count = last.count + token.count;\n        } else {\n            previousValues.push({value: token.effect(tokenBag), count: token.count});\n        }\n        return previousValues;\n    }, []);\n}\n\nexport function accumulated(tokenBag: TokenBag) {\n    return histogram(tokenBag).reduce<ValueCount[]>((prev, curr: ValueCount) => {\n        const prevValue = prev.length > 0 ? prev[prev.length - 1].count : 0;\n        return prev.concat({value: curr.value, count: curr.count + prevValue});\n    }, []);\n}\n\n\n\nexport function sealAll(tokenBag: TokenBag, tokenName: string): TokenBag {\n    const tokensFiltered: Token[] = tokenBag.tokens.map(t => {\n        return t.name !== tokenName ? t : null\n    }).filter(t => t !== null) as Token[];\n    return {\n        ...tokenBag,\n        tokens: tokensFiltered,\n    }\n}\n\nexport function seal(tokenBag: TokenBag, tokenName: string): TokenBag {\n    const tokensFiltered = tokenBag.tokens.map(t => {\n        return t.name !== tokenName ? t : decCount(t)\n    }).filter(t => t.count > 0)\n    return {\n        ...tokenBag,\n        tokens: tokensFiltered\n    }\n}\n\nexport function allTokens(bag: TokenBag): Token[] {\n    const allTokensIndividually: Token[] = [];\n    bag.tokens.forEach( t => {\n        for(let i = 0; i < t.count; i++) allTokensIndividually.push({...t, count: 1, id: t.id + \"_\" + i});\n    })\n    return allTokensIndividually;\n}\n\n\n// TokenBagPassZone\nexport interface WithTokenBag {\n    tokenBag: TokenBag;\n}\nexport interface ITokensInPassLine {\n    tokens: Token[];\n    prob: number;\n}\nexport type TokenBagPassZone = Map<number, ITokensInPassLine> & WithTokenBag;\nexport function tokenBagPassZone(tokenBag: TokenBag): TokenBagPassZone {\n    const accum = accumulated(tokenBag);\n    const map = new Map<number, ITokensInPassLine>() as TokenBagPassZone;\n    map.tokenBag = tokenBag;\n    const total = accum[accum.length - 1].count;\n    accum.forEach(vc => {\n        if (vc.value !== FALLO_AUTOMATICO_VALUE) {\n            const prob = 100 * vc.count / total;\n            const tokens = tokensWithValue(tokenBag, vc.value);\n            map.set(vc.value, {tokens, prob});\n        }\n    });\n    return map;\n}\n\nexport interface ISkillLine {\n    key: number;\n    tokens: Token[];\n    prob: number;\n    pass: boolean;\n    firstFail: boolean;\n    currentProb: boolean;\n}\n\nexport function passZoneLines(tokenBagMap: TokenBagPassZone, skill: number, test: number): ISkillLine[] {\n    const lines: ISkillLine[] = [];\n    let stillPass = true;\n    tokenBagMap.forEach((value, key) => {\n        const result = Math.max(skill+key, 0);\n        const pass = result >= test;\n        const nextPass = Math.max(result -1, 0) >= test;\n        const currentProb = pass && !nextPass;\n        const firstFail = !pass && stillPass;\n        stillPass = pass;\n        lines.push({\n            key,\n            tokens: value.tokens,\n            prob: value.prob,\n            pass,\n            firstFail,\n            currentProb\n        });\n    });\n    return lines;\n}\n\nexport function printSkillLine(tokenBagMap: TokenBagPassZone, skill: number, test: number): string {\n    let output = \"\";\n    output+=\"******************\\n\";\n    output+=`Skill: ${skill}, Test: ${test}\\n`;\n    output+=\"******************\\n\";\n    const lines = passZoneLines(tokenBagMap, skill, test);\n    lines.forEach(line => {\n        const keyFormat = line.key.toString().padStart(2, \" \");\n        if (line.firstFail) {\n            output+=\"------------------\\n\";\n        }\n        output+=`${keyFormat} => ${line.prob.toFixed(2)}% ${line.currentProb ? \"<----\":\"     \"}`;\n        output+=\"[\" + line.tokens.map(t => t.name).join(',') + \"]\\n\";\n    });\n    output+=\"******************\\n\";\n    return output;\n}\n\nexport function nnDec(nn: number): number {\n    return Math.max(nn -1 , 0);\n}\n\n\n","import {TokenSpec} from \"./Token\";\nimport React, {useState} from \"react\";\nimport {Fade} from \"@material-ui/core\";\n\nexport function TokenSpan(props: {token: TokenSpec, onClick?: (token: TokenSpec) => void, fadeOut?: boolean, fadeOutFadeIn?: boolean}){\n    const [fadeIn, setFadeIn] = useState(true);\n    const handler = () => {\n        if (props.onClick) {\n            if (props.fadeOut || props.fadeOutFadeIn) {\n                setFadeIn(false);\n            } else {\n                props.onClick(props.token);\n            }\n        }\n    };\n    const fadeExitedHandler = () => {\n        if (props.onClick) {\n            props.onClick(props.token);\n        }\n        setFadeIn(true);\n    }\n    return (\n        <Fade in={fadeIn} onExited={fadeExitedHandler}>\n            <span style={{cursor: \"pointer\"}} className={\"Token \" + props.token.name} onClick={handler}>T</span>\n        </Fade>\n    )\n}","import React from \"react\";\nimport {IContextValueSpec} from \"./Scenario\";\nimport {IconButton, InputLabel, Switch} from \"@material-ui/core\";\nimport {useTranslation} from \"react-i18next\";\n\nexport function ContextValueChanger(props: {\n    currentValue: number | boolean, valueSpec: IContextValueSpec, incDecContextValue: (incDec: boolean) => void, toggleContextValue: () => void}) {\n    const valueSpec = props.valueSpec;\n    const { t } = useTranslation();\n    if (valueSpec.type === \"number\") {\n        return (\n            <NumericParamChanger inline={false} name={t(valueSpec.name)} currentValue={props.currentValue as number}\n                                 incValue={() => props.incDecContextValue(true)}\n                                 decValue={() => props.incDecContextValue(false)} />\n        )\n    } else {\n        return (\n            <BooleanParamChanger name={t(valueSpec.name)} currentValue={props.currentValue as boolean}\n                                 toggle={() => props.toggleContextValue()}/>\n        )\n    }\n}\n\ntype NumericParamChangerProps =\n    { inline: boolean, name: string, currentValue: number, incValue: () => void, decValue: () => void };\n\nexport function NumericParamChanger({inline, name, currentValue, incValue, decValue}: NumericParamChangerProps) {\n    const incDecStyle = {verticalAlign: \"middle\"};\n    return (\n        <div className=\"ParamChanger\">\n            {inline ? <span>{name}</span> : <InputLabel>{name}</InputLabel>}\n            <IconButton className=\"IconAction material-icons\" style={incDecStyle} onClick={_ => incValue()}>arrow_circle_up</IconButton>\n            {currentValue}\n            <IconButton className=\"IconAction material-icons\" style={incDecStyle} onClick={_ => decValue()}>arrow_circle_down</IconButton>\n        </div>\n    )\n}\n\ntype BooleanParamChangerProps = { name: string, currentValue: boolean, toggle: () => void };\n\nexport function BooleanParamChanger({name, currentValue, toggle}: BooleanParamChangerProps) {\n    return (\n        <div className=\"ParamChanger\">\n            <InputLabel>{name}:</InputLabel>\n            <Switch\n                checked={currentValue}\n                onChange={_ => toggle()}\n                color=\"primary\"\n                name=\"name\"\n                inputProps={{ 'aria-label': 'primary checkbox' }}\n            />\n        </div>\n    )\n}","import {Action} from \"redux\";\nimport {AHCharacter} from \"./tok/AHCharacter\";\nimport {IScenarioSpec} from \"./tok/Scenario\";\nimport {TokenSpec} from \"./tok/Token\";\nimport {Campaign} from \"./tok/Campaign\";\n\nexport interface IAppAction extends Action {}\nexport interface ICampaignAction extends IAppAction {}\nexport interface ICampaignSelectAction extends ICampaignAction { campaign: Campaign }\nexport interface IScenarioAction extends IAppAction { scenarioSpec: IScenarioSpec }\nexport interface ICharacterAction extends IAppAction { character: AHCharacter }\nexport interface IContextAction extends IAppAction { key: string }\nexport interface IIncDecAction extends IAppAction { incDec: boolean }\nexport interface ITokenAction extends IAppAction { tokenSpec: TokenSpec}\n\n// Campaign\nexport const SELECT_CAMPAIGN = 'SELECT_CAMPAIGN';\nexport const NEXT_SCENARIO = 'NEXT_SCENARIO';\nexport const PREV_SCENARIO = 'PREV_SCENARIO';\n// Scenario\nexport const CHANGE_SCENARIO = 'CHANGE_SCENARIO';\n\n// Character\nexport const CHANGE_CHARACTER = 'CHANGE_CHARACTER';\n\n// Context\nexport const INC_DEC_CONTEXT_VALUE = 'INC_DEC_CONTEXT_VALUE';\nexport const TOGGLE_CONTEXT_VALUE = 'TOGGLE_CONTEXT_VALUE';\n\n// SkillTest\nexport const CHANGE_SKILL = 'CHANGE_SKILL';\nexport const CHANGE_TEST = 'CHANGE_TEST';\n\n//BagTokenSpec\nexport const ADD_TOKEN = 'ADD_TOKEN';\nexport const REMOVE_TOKEN = 'REMOVE_TOKEN';\n\n//Campaign Wizard\nexport const SELECT_CAMPAIGN_SPEC = 'SELECT_CAMPAIGN_SPEC';\n\nexport function selectCampaign(campaign: Campaign): ICampaignSelectAction {\n    return {\n        type: SELECT_CAMPAIGN,\n        campaign\n    }\n}\n\nexport function advanceScenario(): ICampaignAction {\n    return {\n        type: NEXT_SCENARIO\n    }\n}\n\nexport function getBackScenario(): ICampaignAction {\n    return {\n        type: PREV_SCENARIO\n    }\n}\n\n// Scenario\nexport function changeScenario(scenarioSpec: IScenarioSpec): IScenarioAction {\n    return {\n        type: CHANGE_SCENARIO,\n        scenarioSpec\n    }\n}\n// Character\nexport function changeCharacter(character: AHCharacter): ICharacterAction {\n    return {\n        type: CHANGE_CHARACTER,\n        character\n    }\n}\n\n// Context\nexport function incDecContextValue(key: string, incDec: boolean): IContextAction & IIncDecAction {\n    return {\n        type: INC_DEC_CONTEXT_VALUE,\n        key, incDec\n    }\n}\n\nexport function toggleContextValue(key: string): IContextAction {\n    return {\n        type: TOGGLE_CONTEXT_VALUE,\n        key\n    }\n}\n\n// SkillTest\nexport function changeSkill(incDec: boolean): IIncDecAction {\n    return {\n        type: CHANGE_SKILL,\n        incDec\n    }\n}\nexport const decreaseSkill = () => changeSkill(false);\nexport const increaseSkill = () => changeSkill(true);\n\nexport function changeTest(incDec: boolean): IIncDecAction {\n    return {\n        type: CHANGE_TEST,\n        incDec\n    }\n}\nexport const decreaseTest = () => changeTest(false);\nexport const increaseTest = () => changeTest(true);\n\nexport function addToken(tokenSpec: TokenSpec): ITokenAction {\n    return {\n        type: ADD_TOKEN,\n        tokenSpec\n    }\n}\n\nexport function removeToken(tokenSpec: TokenSpec): ITokenAction {\n    return {\n        type: REMOVE_TOKEN,\n        tokenSpec\n    }\n}\n","import {Typography} from \"@material-ui/core\";\nimport {NumericParamChanger} from \"./ParamChanger\";\nimport React from \"react\";\nimport {connect} from \"react-redux\";\nimport {AppState} from \"../AppState\";\nimport {Dispatch} from \"redux\";\nimport {decreaseSkill, decreaseTest, increaseSkill, increaseTest} from \"../AppActions\";\nimport {useTranslation} from \"react-i18next\";\n\nconst mapStateToProps = (state: AppState) => {\n    return {\n        skill: state.skillTest.skill,\n        test: state.skillTest.test\n    }\n}\n\nconst mapDispatchToProps = (dispatch: Dispatch) => {\n    return {\n        incSkill: () => dispatch(increaseSkill()),\n        decSkill: () => dispatch(decreaseSkill()),\n        incTest: () => dispatch(increaseTest()),\n        decTest: () => dispatch(decreaseTest())\n    }\n}\n\nexport const CurrentSkillTestChanger = connect(mapStateToProps, mapDispatchToProps)(SkillTestChanger);\n\nfunction SkillTestChanger(props: {skill: number, test: number,\n                                  incSkill: () => void, decSkill: () => void,\n                                  incTest: () => void, decTest: () => void}) {\n    const {skill, test, incSkill, decSkill, incTest, decTest} = props;\n    const { t } = useTranslation();\n    return (\n        <Typography variant=\"h5\">\n            <NumericParamChanger inline={true} name={t('Skill')} currentValue={skill} incValue={incSkill} decValue={decSkill}/>\n            <NumericParamChanger inline={true} name={t('Test')} currentValue={test} incValue={incTest} decValue={decTest}/>\n        </Typography>\n    );\n}","import React from \"react\";\nimport {passZoneLines, ISkillLine, TokenBagPassZone, TokenBag, tokenBagPassZone} from \"./Token\";\nimport \"./Tok.css\"\nimport {TokenSpan} from \"./TokenSpan\";\nimport {Grid, Typography} from \"@material-ui/core\";\nimport {CurrentSkillTestChanger} from \"./SkillTestChanger\";\nimport {SkillTest} from \"./SkillTest\";\nimport {connect} from \"react-redux\";\nimport {AppState} from \"../AppState\";\nimport {useTranslation} from \"react-i18next\";\n\nfunction mapStateToProps(state: AppState, ownProps: {tokenBag: TokenBag}) {\n    return {\n        passZone: tokenBagPassZone(ownProps.tokenBag),\n        skillTest: state.skillTest\n    }\n}\n\nexport const CurrentPassZone = connect(mapStateToProps)(PassZone);\n\nexport function PassZone({passZone, skillTest}: {passZone: TokenBagPassZone, skillTest: SkillTest}) {\n    const { t } = useTranslation();\n    const lines = passZoneLines(passZone, skillTest.skill, skillTest.test);\n    return (\n        <Grid container className=\"PassZone\" alignItems={\"center\"}>\n            <Grid item xs={12} sm={7} md={6} >\n            <Typography variant=\"h4\">{t('Pass zone')}</Typography>\n            <hr />\n            <Grid container direction=\"column\">\n                {\n                    lines.map(line => (\n                        <Grid key={line.key} item>\n                            <PassLine line={line} />\n                        </Grid>\n                    ))\n                }\n            </Grid>\n            <hr />\n            </Grid>\n            <Grid item xs={12} sm={5} md={6} style={{textAlign: \"center\"}}>\n                <CurrentSkillTestChanger />\n            </Grid>\n        </Grid>\n    )\n}\n\nfunction PassLine(props: {line: ISkillLine}) {\n    const line = props.line;\n    const liStyle = {\n        color: line.pass ? \"green\" : \"red\",\n    }\n    let lineSeparator;\n    if (line.firstFail) {\n        lineSeparator = <hr className=\"PassSeparator Current\"/>;\n    } else {\n        lineSeparator = <hr className=\"PassSeparator\" style={{borderColor: \"transparent\"}}/>;\n    }\n    return (\n        <div>{lineSeparator}\n        <Grid container  direction=\"row\"  alignItems=\"flex-start\" spacing={1}>\n            <Grid item style={{...liStyle, textAlign: \"center\"}} xs={2} sm={1}>\n                <Typography variant=\"h5\" >{line.key}</Typography>\n            </Grid>\n            <Grid item style={liStyle} className=\"LineProb\" xs={2} sm={2}>\n                <Typography variant=\"body1\">{line.prob.toFixed(2)}%</Typography>\n            </Grid>\n            <Grid item style={{textAlign: \"left\"}} xs={8} sm={9}>\n                <Typography variant=\"h3\" noWrap={true}>\n                {line.tokens.map((token, index) => (\n                    <TokenSpan key={index} token={token} />\n                ))}\n                </Typography>\n            </Grid>\n        </Grid>\n        </div>\n    )\n}\n","import {createStyles, FormControl, InputLabel, makeStyles, MenuItem, Select, Theme} from \"@material-ui/core\";\nimport {AppState} from \"../AppState\";\nimport {Dispatch} from \"redux\";\nimport {AHCharacter} from \"./AHCharacter\";\nimport {changeCharacter} from \"../AppActions\";\nimport {connect} from \"react-redux\";\nimport React from \"react\";\nimport {useTranslation} from \"react-i18next\";\n\nconst useStyles = makeStyles((theme: Theme) =>\n    createStyles({\n        formControl: {\n            margin: theme.spacing(1),\n            minWidth: 120,\n        },\n        selectEmpty: {\n            marginTop: theme.spacing(2),\n        },\n    }),\n);\n\nconst mapStateToProps = (state: AppState) => ({character: state.selectedCharacter, characters: state.selectedCampaign.characters});\nconst mapDispatchToProps = (dispatch: Dispatch) => ({setCharacter: (character: AHCharacter) => dispatch(changeCharacter(character))});\nexport const CurrentCharacterSelector = connect(\n    mapStateToProps,\n    mapDispatchToProps)(CharacterSelector);\n\nexport function CharacterSelector(props: {character: AHCharacter, characters: AHCharacter[], setCharacter: (character: AHCharacter) => void}) {\n    const {character, characters, setCharacter} = props;\n    const { t } = useTranslation();\n    const findCharacterByShortName = (shortName: string): AHCharacter | undefined => {\n        return characters.find(c => c.shortName === shortName);\n    }\n\n    return <div>\n        <InputLabel>{t('Current character')}:</InputLabel>\n        <FormControl variant=\"standard\" className={useStyles().formControl}>\n            <Select\n                labelId=\"character-selector-label\"\n                id=\"character-selector\"\n                value={character.shortName}\n                onChange={e => setCharacter(findCharacterByShortName(e.target.value as string)!)}>\n                {characters.map(aChar => (\n                    <MenuItem key={aChar.shortName} value={aChar.shortName}>{aChar.shortName}</MenuItem>\n                ))}\n            </Select>\n        </FormControl>\n    </div>;\n}","import {Campaign} from \"./tok/Campaign\";\nimport {IScenarioSpec} from \"./tok/Scenario\";\nimport {buildBagFromSpec, buildEffectSpecs, ScenarioContext, TokenBagSpec} from \"./tok/Token\";\nimport {SkillTest} from \"./tok/SkillTest\";\nimport {AHCharacter} from \"./tok/AHCharacter\";\n\nexport interface AppState {\n    selectedCampaign: Campaign;\n    bagSpec: TokenBagSpec;\n    selectedScenario: IScenarioSpec;\n    selectedCharacter: AHCharacter;\n    gameContext: ScenarioContext;\n    skillTest: SkillTest;\n}\n\nexport function buildBagFromState(appState: AppState) {\n    return buildBagFromSpec(\n        appState.bagSpec,\n        buildEffectSpecs(...appState.selectedScenario.scenarioEffectSpec),\n        appState.selectedCharacter,\n        appState.gameContext\n    );\n}\n","import {ScenarioContext, ScenarioEffectSpecs} from \"./Token\";\nimport {Translation} from \"../Utils\";\n\nexport interface IScenarioSpec {\n    name: string;\n    scenarioEffectSpec: ScenarioEffectSpecs;\n    contextSpec: IScenarioContextSpec;\n    translations: Translation;\n}\n\nexport function initContext(contextSpec: IScenarioContextSpec): ScenarioContext {\n    const context: ScenarioContext = {};\n    contextSpec.valuesSpec.forEach( vs => context[vs.name] = vs.initialValue)\n    return context;\n}\n\nexport interface IScenarioContextSpec {\n    valuesSpec: IContextValueSpec[];\n}\n\nexport function findValueSpec(contextSpec: IScenarioContextSpec, key: string) {\n    return contextSpec.valuesSpec.find(vs => vs.name === key);\n}\n\nexport type IContextValueType = \"number\" | \"boolean\";\n\nexport interface IContextValueSpec {\n    name: string;\n    description: string;\n    initialValue: number | boolean;\n    type: IContextValueType;\n    translations: Translation;\n}\n","import {connect} from \"react-redux\";\nimport {AppState} from \"../AppState\";\nimport React, {Dispatch} from \"react\";\nimport {\n    IContextAction,\n    IIncDecAction,\n    incDecContextValue,\n    toggleContextValue\n} from \"../AppActions\";\nimport {findValueSpec, IScenarioContextSpec} from \"./Scenario\";\nimport {Typography} from \"@material-ui/core\";\nimport {ContextValueChanger} from \"./ParamChanger\";\nimport {ScenarioContext} from \"./Token\";\n\nexport const CurrentScenarioContextManager = connect(\n    (state: AppState) => ({spec: state.selectedScenario.contextSpec, context: state.gameContext}),\n    (dispatch: Dispatch<IContextAction | IContextAction & IIncDecAction>) => ({\n        incDecContextValue: (key: string, incDec: boolean) => dispatch(incDecContextValue(key, incDec)),\n        toggleContextValue: (key: string) => dispatch(toggleContextValue(key))\n    })\n)(ContextManager);\ntype ContextManagerProps = {\n    spec: IScenarioContextSpec, context: ScenarioContext,\n    incDecContextValue: (key: string, incDec: boolean) => void,\n    toggleContextValue: (key: string) => void\n};\n\nfunction ContextManager({spec, context, incDecContextValue, toggleContextValue}: ContextManagerProps) {\n    return <Typography variant=\"h5\" style={{paddingTop: \"2vmin\"}}>\n        {Object.keys(context).map(contextKey => (\n            <ContextValueChanger key={contextKey} currentValue={context[contextKey]}\n                                 valueSpec={(findValueSpec(spec, contextKey)!)}\n                                 incDecContextValue={(incDec: boolean) => incDecContextValue(contextKey, incDec)}\n                                 toggleContextValue={() => toggleContextValue(contextKey)}/>\n        ))}\n    </Typography>\n\n}","import {makeStyles} from \"@material-ui/core/styles\";\nimport {createStyles, Theme} from \"@material-ui/core\";\n\nexport const useModalStyles = makeStyles((theme: Theme) =>\n    createStyles({\n        paper: {\n            position: 'relative',\n            left: \"15%\",\n            top: \"25%\",\n            width: \"70%\",\n            opacity: 0.9,\n            backgroundColor: theme.palette.background.paper,\n            border : '2px solid',\n            borderColor: theme.palette.secondary.main,\n            boxShadow: theme.shadows[5],\n            padding: theme.spacing(2, 4, 3),\n        },\n    }),\n);","import {allKnownTokens, allTokens, TokenBag, TokenBagSpec, tokenFloatAverage, TokenSpec} from \"./Token\";\nimport {Box, Typography} from \"@material-ui/core\";\nimport {TokenSpan} from \"./TokenSpan\";\nimport {AppState} from \"../AppState\";\nimport {Dispatch} from \"redux\";\nimport {addToken, ITokenAction, removeToken} from \"../AppActions\";\nimport {connect} from \"react-redux\";\nimport React from \"react\";\nimport {useTranslation} from \"react-i18next\";\nimport {useModalStyles} from \"../CommonStyles\";\n\nexport function BagDisplay({tokenBag, showAverage = true, onClick, fadeOutTokens = false}:\n                               {tokenBag: TokenBag, showAverage?: boolean, onClick?: (token: TokenSpec) => void, fadeOutTokens: boolean}) {\n    const { t } = useTranslation();\n    return <div className=\"BagDisplay\">\n        {showAverage ? (<Typography>{t('Bag average')}: {tokenFloatAverage(tokenBag).toFixed(2)}</Typography>) : null }\n        <p className=\"TokenStrip\">\n            {allTokens(tokenBag).map((token, index) => (\n                <TokenSpan key={token.id} token={token} onClick={onClick} fadeOut={fadeOutTokens}/>\n            ))}\n        </p>\n    </div>\n}\n\nexport const CurrentTokenBagManager = connect(\n    (state: AppState, ownProps: { tokenBag: TokenBag }) => {\n        return {\n            tokenBag: ownProps.tokenBag\n        }\n    },\n    (dispatch: Dispatch<ITokenAction>) => {\n        return {\n            addToken: (token: TokenSpec) => dispatch(addToken(token)),\n            removeToken: (token: TokenSpec) => dispatch(removeToken(token)),\n        }\n    }\n)(TokenBagManager);\nfunction TokenBagManager({tokenBag, addToken, removeToken}: {tokenBag: TokenBag,\n    addToken: (token: TokenSpec) => void, removeToken: (token: TokenSpec) => void}) {\n    const classes = useModalStyles();\n    const { t }  = useTranslation();\n    const allKnown = allKnownTokens();\n    return (\n        <Box textAlign=\"center\" className={classes.paper}>\n            <Typography id=\"bag-management-title\" variant=\"h3\">{t('Chaos bag')}</Typography>\n            <Typography>{t('Current bag')}. {t('Select tokens to remove them')}</Typography>\n            <BagDisplay tokenBag={tokenBag} showAverage={false}\n                        onClick={(token: TokenSpec) => removeToken(token)} fadeOutTokens={true}/>\n            <Typography >{t('Select tokens to add them to the bag')}</Typography>\n            <BagSpecDisplay tokenBagSpec={allKnown} onClick={(token: TokenSpec) => addToken(token)}/>\n        </Box>\n    );\n}\n\nfunction BagSpecDisplay({tokenBagSpec, onClick}: {tokenBagSpec: TokenBagSpec, onClick?: (token: TokenSpec) => void}) {\n    return <div className=\"BagDisplay\">\n        <p className=\"TokenStrip\">\n            {tokenBagSpec.tokens.map((token, index) => (\n                <TokenSpan key={index} token={token} onClick={onClick} fadeOut={false} fadeOutFadeIn={true}/>\n            ))}\n        </p>\n    </div>\n}\n\n\n\n\n","import React, {useState} from \"react\";\nimport {IScenarioSpec} from \"./Scenario\";\nimport {CurrentPassZone} from \"./PassZone\";\nimport {TokenBag} from \"./Token\";\nimport {Box, Button, Modal, Typography} from \"@material-ui/core\";\nimport {CurrentCharacterSelector} from \"./CharacterSelector\";\nimport {connect} from \"react-redux\";\nimport {AppState, buildBagFromState} from \"../AppState\";\nimport {CurrentScenarioContextManager} from \"./ContextManager\";\nimport {BagDisplay, CurrentTokenBagManager} from \"./TokenBag\";\nimport {useTranslation} from \"react-i18next\";\n\n\nconst mapStateToProps = (state: AppState) => ({tokenBag: buildBagFromState(state), scenario: state.selectedScenario});\n\nexport const CurrentScenarioPassZone = connect(mapStateToProps)(ScenarioPassZone);\n\nexport function ScenarioPassZone({tokenBag, scenario}: {tokenBag: TokenBag, scenario: IScenarioSpec}) {\n    const [open, setOpen] = useState<boolean>(false);\n    const { t } = useTranslation();\n    return (\n        <div className=\"Scenario\">\n            <div className=\"ScenarioInfo\">\n                <Typography variant=\"h3\">{t(scenario.name)}</Typography>\n                <CurrentScenarioContextManager />\n                <CurrentCharacterSelector />\n            </div>\n            <CurrentPassZone tokenBag={tokenBag}/>\n\n            <BagDisplay tokenBag={tokenBag} onClick={() => setOpen(true)} fadeOutTokens={false}/>\n            <Modal open={open} onClose={() => setOpen(false)} aria-labelledby=\"bag-management-title\">\n                <CurrentTokenBagManager tokenBag={tokenBag}/>\n            </Modal>\n            <Box textAlign={\"center\"}>\n                <Button color=\"secondary\" onClick={() => setOpen(true)}>{t('Manage chaos bag')}</Button>\n            </Box>\n        </div>\n    );\n}\n","import {createMuiTheme, responsiveFontSizes} from \"@material-ui/core\";\n\nexport function tokTheme() {\n    const baseFontFamily = [\n        '-apple-system',\n        'BlinkMacSystemFont',\n        '\"Segoe UI\"',\n        'Roboto',\n        '\"Helvetica Neue\"',\n        'Arial',\n        'sans-serif',\n        '\"Apple Color Emoji\"',\n        '\"Segoe UI Emoji\"',\n        '\"Segoe UI Symbol\"',\n    ];\n    const birminghamFontFamily = \"Birmingham\";\n    const uglyQuaFontFamily = 'UglyQua';\n    const theme = responsiveFontSizes(createMuiTheme({\n        typography: {\n            fontFamily: [uglyQuaFontFamily].concat(baseFontFamily).join(','),\n            fontSize: 14\n        },\n        palette: {\n            tonalOffset: 1,\n            type: \"dark\",\n            primary: {\n                main: \"#205b57\",\n            },\n            secondary: {\n                main: \"#f4ebcc\",\n            }\n        }\n    }));\n\n    const headerFontFamily = [birminghamFontFamily].concat(baseFontFamily).join(',');\n    const headerFontFamilyNonAscii = [uglyQuaFontFamily].concat(baseFontFamily).join(',');\n    return {\n        theme,\n        headerFontFamily,\n        headerFontFamilyNonAscii\n    };\n}","import {EffectSpec} from \"./Token\";\n\nexport interface AHCharacter {\n    id: string,\n    name: string;\n    shortName: string;\n    elderSignEffect: EffectSpec;\n}\n\n\nexport const AHCharacters: {[key: string]: AHCharacter} = {\n    JoeDiamond: {id: \"JoeDiamond\", name: \"Joe Diamond\", shortName: \"Joe\", elderSignEffect: () => 1},\n    DianaStanley: {id: \"DianaStanley\", name: \"Diana Stanley\", shortName: \"Diana\", elderSignEffect: () => 2},\n    LeoAnderson: {id: \"LeoAnderson\", name: \"Leo Anderson\", shortName: \"Leo\", elderSignEffect: () => 2},\n    UrsulaDowns: {id: \"UrsulaDowns\", name: \"Ursula Downs\", shortName: \"Ursula\", elderSignEffect: () => 2},\n    LolaHayes: {id: \"LolaHayes\", name: \"Lola Hayes\", shortName: \"Lola\", elderSignEffect: () => 2},\n}","import {\n    buildBagSpec,\n    elderSignEffect,\n    FALLO_AUTOMATICO,\n    seal,\n    tokenAverage,\n    TokenBag,\n    TokenBagSpec,\n    tokenSpecDef\n} from \"./Token\";\nimport {Campaign, ICampaignSpec} from \"./Campaign\";\nimport {IScenarioSpec} from \"./Scenario\";\nimport {AHCharacters} from \"./AHCharacter\";\n\nfunction easy(): TokenBagSpec {\n    return buildBagSpec(\n        tokenSpecDef(1, 1, false, \"elderSign\"),\n        tokenSpecDef(1, 2),\n        tokenSpecDef(0, 3),\n        tokenSpecDef(-1, 2),\n        tokenSpecDef(-2,1),\n        tokenSpecDef(-3, 1),\n        tokenSpecDef(0, 2, true, \"Calavera\"),\n        tokenSpecDef(0, 1, true, \"Antiguo\"),\n        FALLO_AUTOMATICO\n    );\n}\nexport function normal(): TokenBagSpec {\n    return buildBagSpec(\n        tokenSpecDef(1, 1, false, \"elderSign\"),\n        tokenSpecDef(1, 1),\n        tokenSpecDef(0, 3),\n        tokenSpecDef(-1, 1),\n        tokenSpecDef(-2,2),\n        tokenSpecDef(-3, 1),\n        tokenSpecDef(-5, 1),\n        tokenSpecDef(0, 2, true, \"Calavera\"),\n        tokenSpecDef(0, 1, true, \"Antiguo\"),\n        FALLO_AUTOMATICO\n    );\n}\nfunction hard (): TokenBagSpec {\n    return buildBagSpec(\n        tokenSpecDef(1, 1, false, \"elderSign\"),\n        tokenSpecDef(1, 1),\n        tokenSpecDef(0, 2),\n        tokenSpecDef(-1, 1),\n        tokenSpecDef(-2,2),\n        tokenSpecDef(-3, 2),\n        tokenSpecDef(-4, 1),\n        tokenSpecDef(-6, 1),\n        tokenSpecDef(0, 2, true, \"Calavera\"),\n        tokenSpecDef(0, 1, true, \"Antiguo\"),\n        FALLO_AUTOMATICO\n    );\n}\n\nfunction expert (): TokenBagSpec {\n    return buildBagSpec(\n        tokenSpecDef(1, 1, false, \"elderSign\"),\n        tokenSpecDef(0, 1),\n        tokenSpecDef(-1, 1),\n        tokenSpecDef(-2,2),\n        tokenSpecDef(-3, 2),\n        tokenSpecDef(-4, 2),\n        tokenSpecDef(-6, 1),\n        tokenSpecDef(-8, 1),\n        tokenSpecDef(0, 2, true, \"Calavera\"),\n        tokenSpecDef(0, 1, true, \"Antiguo\"),\n        FALLO_AUTOMATICO\n    );\n}\n\nfunction NaturalezaSalvaje(): IScenarioSpec {\n    const PUNTOS_DE_VENGANZA=\"Vengeance points\";\n    const LUGARES_EN_JUEGO=\"Locations in play\";\n    const CARTAS_EXPLORACION=\"Cards in exploration deck\";\n    const ENVENENADO=\"Poisoned\";\n\n    return {\n        name: \"The Untamed Wilds\",\n        translations: {\n            \"es\": \"Naturaleza Salvaje\"\n        },\n        scenarioEffectSpec: [\n            {name: \"elderSign\", effect: elderSignEffect},\n            {name: \"Calavera\", effect: (tokenBag) => 0 - (tokenBag.context[PUNTOS_DE_VENGANZA] as number)},\n            {name: \"Sectario\", effect: (tokenBag) => 0 - Math.min(5, tokenBag.context[LUGARES_EN_JUEGO] as number)},\n            {name: \"Lápida\", effect: (tokenBag) => 0 - Math.min(5, tokenBag.context[CARTAS_EXPLORACION] as number)},\n            {name: \"Antiguo\", effect: (tokenBag) => tokenBag.context[ENVENENADO] ? -99 : -2},\n        ],\n        contextSpec: {\n            valuesSpec: [{\n                name: PUNTOS_DE_VENGANZA,\n                description: \"Puntos de Venganza en la zona de victoria\",\n                type: \"number\",\n                initialValue: 0,\n                translations: {\n                    \"es\": \"Puntos de venganza\"\n                }\n            },{\n                name: LUGARES_EN_JUEGO,\n                description: \"Lugares en juego\",\n                type: \"number\",\n                initialValue: 1,\n                translations: {\n                    \"es\": \"Lugares en juego\"\n                }\n            },{\n                name: CARTAS_EXPLORACION,\n                description: \"Lugares en el mazo de exploración\",\n                type: \"number\",\n                initialValue: 0,\n                translations: {\n                    \"es\": \"Cartas en el mazo de exploración\"\n                }\n            },{\n                name: ENVENENADO,\n                description: \"Envenenado\",\n                type: \"boolean\",\n                initialValue: false,\n                translations: {\n                    \"es\": \"Envenenado\"\n                }\n            }]\n        }\n    };\n}\n\nfunction LaPerdicionDeEztli(): IScenarioSpec {\n    const FICHAS_PERDICION=\"Locations with doom\";\n    const PERDICION_EN_TU_LUGAR=\"Doom on your location\";\n    function fichas(tokenBag: TokenBag) {\n        return 0 - (tokenBag.context[FICHAS_PERDICION] as  number);\n    }\n    return {\n        name: \"The Doom of Eztli\",\n        translations: {\n            \"es\": \"La perdición de Eztli\",\n        },\n        scenarioEffectSpec: [\n            {name: \"elderSign\", effect: elderSignEffect},\n            {name: \"Calavera\", effect: (tokenBag) => tokenBag.context[PERDICION_EN_TU_LUGAR] ? -3 : -1},\n            {name: \"Sectario\", effect: (tokenBag) => fichas(tokenBag)},\n            {name: \"Lápida\", effect: (tokenBag) => fichas(tokenBag)},\n            {name: \"Antiguo\", effect: (tokenBag) => tokenAverage(seal(tokenBag, \"Antiguo\"))},\n        ],\n        contextSpec: {\n            valuesSpec: [{\n                name: FICHAS_PERDICION,\n                description: \"Number of locations with doom on them\",\n                type: \"number\",\n                initialValue: 0,\n                translations: {\n                    \"es\": \"Lugares con perdición\"\n                }\n            },{\n                name: PERDICION_EN_TU_LUGAR,\n                description: \"Doom on yout location\",\n                type: \"boolean\",\n                initialValue: false,\n                translations: {\n                    \"es\": \"Perdición en tu lugar\"\n                }\n            }]\n        }\n    };\n}\n\nfunction LosHilosDelDestino(): IScenarioSpec {\n    const MAYOR_PERDICION_EN_CULTISTA=\"Highest doom\";\n    return {\n        name: \"Threads of Fate\",\n        translations: {\n            \"es\": \"Los hilos del destino\"\n        },\n        scenarioEffectSpec: [\n            {name: \"elderSign\", effect: (tokenBag) => tokenBag.character.elderSignEffect(tokenBag)},\n            {name: \"Calavera\", effect: (tokenBag) => 0 - (tokenBag.context[MAYOR_PERDICION_EN_CULTISTA] as number)},\n            {name: \"Sectario\", effect: (tokenBag) => -2},\n            {name: \"Lápida\", effect: (tokenBag) => -2},\n            {name: \"Antiguo\", effect: (tokenBag) => -2},\n        ],\n        contextSpec: {\n            valuesSpec: [{\n                name: MAYOR_PERDICION_EN_CULTISTA,\n                description: \"Highest number of doom in a cultist\",\n                type: \"number\",\n                initialValue: 0,\n                translations: {\n                    \"es\": \"Mayor perdición en un cultista\"\n                }\n            }]\n        }\n    };\n}\n\nfunction ElLimiteDelOtroLado(): IScenarioSpec {\n    const LUGAR_ANTIGUO=\"Ancient location\";\n    return {\n        name: \"The Boundary Beyond\",\n        translations: {\n            \"es\": \"El límite del otro lado\"\n        },\n        scenarioEffectSpec: [\n            {name: \"elderSign\", effect: elderSignEffect},\n            {name: \"Calavera\", effect: (tokenBag) => (tokenBag.context[LUGAR_ANTIGUO] as boolean) ? -3 : -1},\n            {name: \"Sectario\", effect: (tokenBag) => tokenAverage(seal(tokenBag, \"Sectario\"))},\n            {name: \"Lápida\", effect: (tokenBag) => tokenAverage(seal(tokenBag, \"Lápida\"))},\n            {name: \"Antiguo\", effect: (tokenBag) => -4},\n        ],\n        contextSpec: {\n            valuesSpec: [{\n                name: LUGAR_ANTIGUO,\n                description: \"You are at an ancient location\",\n                type: \"boolean\",\n                initialValue: false,\n                translations: {\n                    \"es\": \"Lugar antiguo\"\n                }\n            }]\n        }\n    };\n}\n\nfunction ElCorazonDeLosAncianos(): IScenarioSpec {\n    const EN_UNA_CUEVA=\"Cave location\";\n    const ENVENENADO=\"Poisoned\";\n    return {\n        name: \"Heart of the Elders\",\n        translations: {\n            \"es\": \"El corazón de los ancianos\"\n        },\n        scenarioEffectSpec: [\n            {name: \"elderSign\", effect: elderSignEffect},\n            {name: \"Calavera\", effect: (tokenBag) => (tokenBag.context[EN_UNA_CUEVA] as boolean) ? -3 : -1},\n            {name: \"Sectario\", effect: (tokenBag) => -2},\n            {name: \"Lápida\", effect: (tokenBag) => (tokenBag.context[ENVENENADO] as boolean) ? -99 : -2},\n            {name: \"Antiguo\", effect: (tokenBag) => -3},\n        ],\n        contextSpec: {\n            valuesSpec: [{\n                name: EN_UNA_CUEVA,\n                description: \"You are at in a cave location\",\n                type: \"boolean\",\n                initialValue: false,\n                translations: {\n                    \"es\": \"Lugar cueva\"\n                }\n            },{\n                name: ENVENENADO,\n                description: \"You are poisoned\",\n                type: \"boolean\",\n                initialValue: false,\n                translations: {\n                    \"es\": \"Envenenado\"\n                }\n            }]\n        }\n    };\n}\n\nfunction LaCiudadDeLosArchivos(): IScenarioSpec {\n    const CARTAS_EN_LA_MANO=\"Cards in hand\";\n\n    return {\n        name: \"The City of Archives\",\n        translations: {\n            \"es\": \"La ciudad de los archivos\"\n        },\n        scenarioEffectSpec: [\n            {name: \"elderSign\", effect: elderSignEffect},\n            {name: \"Calavera\", effect: (tokenBag) => (tokenBag.context[CARTAS_EN_LA_MANO] as number) >= 5 ? -3 : -1},\n            {name: \"Sectario\", effect: (tokenBag) => -2},\n            {name: \"Lápida\", effect: (tokenBag) => -2},\n            {name: \"Antiguo\", effect: (tokenBag) => -3},\n        ],\n        contextSpec: {\n            valuesSpec: [{\n                name: CARTAS_EN_LA_MANO,\n                description: \"Cards in hand\",\n                type: \"number\",\n                initialValue: 0,\n                translations: {\n                    \"es\": \"Cartas en la mano\"\n                }\n            }]\n        }\n    };\n}\n\nfunction LasProfundidadesDeYoth(): IScenarioSpec {\n    const NIVEL_DE_PROFUNDIDAD=\"Depth level\";\n    const PUNTOS_DE_VENGANZA=\"Vengeance points\";\n    return {\n        name: \"The Depths of Yoth\",\n        translations: {\n            \"es\": \"Las profundidades de Yoth\"\n        },\n        scenarioEffectSpec: [\n            {name: \"elderSign\", effect: elderSignEffect},\n            {name: \"Calavera\", effect: (tokenBag) => 0 - (tokenBag.context[NIVEL_DE_PROFUNDIDAD] as number)},\n            {name: \"Sectario\", effect: (tokenBag) => tokenAverage(seal(tokenBag, \"Sectario\"))},\n            {name: \"Lápida\", effect: (tokenBag) => tokenAverage(seal(tokenBag, \"Lápida\"))},\n            {name: \"Antiguo\", effect: (tokenBag) => (tokenBag.context[PUNTOS_DE_VENGANZA] as number) >= 3 ? -99 : -2},\n        ],\n        contextSpec: {\n            valuesSpec: [{\n                name: NIVEL_DE_PROFUNDIDAD,\n                description: \"Current Depth level\",\n                type: \"number\",\n                initialValue: 0,\n                translations: {\n                    \"es\": \"Nivel de profundidad\"\n                }\n            },{\n                name: PUNTOS_DE_VENGANZA,\n                description: \"Vengeance points in the victory display\",\n                type: \"number\",\n                initialValue: 0,\n                translations: {\n                    \"es\": \"Puntos de venganza\"\n                }\n            }]\n        }\n    };\n}\n\nfunction EonesDestozados(): IScenarioSpec {\n    const RELIQUIA_DE_LAS_ERAS_EN_TU_LUGAR=\"Relic of ages at your location\";\n    const ENVENENADO=\"Poisoned\";\n    return {\n        name: \"Shattered Aeons\",\n        translations: {\n            \"es\": \"Eones destrozados\"\n        },\n        scenarioEffectSpec: [\n            {name: \"elderSign\", effect: elderSignEffect},\n            {name: \"Calavera\", effect: (tokenBag) => (tokenBag.context[RELIQUIA_DE_LAS_ERAS_EN_TU_LUGAR] as boolean) ? -4 : -2},\n            {name: \"Sectario\", effect: (tokenBag) => -2},\n            {name: \"Lápida\", effect: (tokenBag) => (tokenBag.context[ENVENENADO] as boolean) ? -99 : -2},\n            {name: \"Antiguo\", effect: (tokenBag) => -2},\n        ],\n        contextSpec: {\n            valuesSpec: [{\n                name: RELIQUIA_DE_LAS_ERAS_EN_TU_LUGAR,\n                description: \"Relic of ages at your location\",\n                type: \"boolean\",\n                initialValue: false,\n                translations: {\n                    \"es\": \"Reliquia de las eras en tu lugar\"\n                }\n            },{\n                name: ENVENENADO,\n                description: \"You are poisoned\",\n                type: \"boolean\",\n                initialValue: false,\n                translations: {\n                    \"es\": \"Envenenado\"\n                }\n            }]\n        }\n    };\n}\n\nexport function buildLaEraOlvidadaCampaignSpec(): ICampaignSpec {\n    return {\n        id: \"TheForgottenAge\",\n        name: \"The Forgotten Age\",\n        scenarios: [\n            NaturalezaSalvaje(),LaPerdicionDeEztli(), LosHilosDelDestino(), ElLimiteDelOtroLado(),\n            ElCorazonDeLosAncianos(), LaCiudadDeLosArchivos(), LasProfundidadesDeYoth(), EonesDestozados()\n        ],\n        bagSpecsByLevel: {\n            easy: easy(),\n            normal: normal(),\n            hard: hard(),\n            expert: expert(),\n        },\n        translations: {\n            \"es\": \"La Era Olvidada\",\n        }\n    }\n}\n\nexport function startAlvaroLaEraOlvidada() {\n    const campaign = Campaign.start(buildLaEraOlvidadaCampaignSpec(), [\n        AHCharacters[\"LeoAnderson\"], AHCharacters[\"DianaStanley\"],\n    ], \"normal\");\n    campaign.startCampaign(0);\n    return campaign;\n}\n","import {\n    addTokens,\n    buildBagSpec,\n    FALLO_AUTOMATICO,\n    removeToken, seal,\n    tokenAverage,\n    TokenBagSpec,\n    tokenSpecDef\n} from \"./Token\";\nimport {IScenarioSpec} from \"./Scenario\";\nimport {ICampaignSpec} from \"./Campaign\";\n\nfunction easy(): TokenBagSpec {\n    return buildBagSpec(\n        tokenSpecDef(1, 1, false, \"elderSign\"),\n        tokenSpecDef(1, 2),\n        tokenSpecDef(0, 3),\n        tokenSpecDef(-1, 3),\n        tokenSpecDef(-2,2),\n        tokenSpecDef(0, 2, true, \"Calavera\"),\n        tokenSpecDef(0, 1, true, \"Sectario\"),\n        FALLO_AUTOMATICO\n    );\n}\nexport function normal(): TokenBagSpec {\n    return buildBagSpec(\n        tokenSpecDef(1, 1, false, \"elderSign\"),\n        tokenSpecDef(1, 1),\n        tokenSpecDef(0, 2),\n        tokenSpecDef(-1, 3),\n        tokenSpecDef(-2,2),\n        tokenSpecDef(-3, 1),\n        tokenSpecDef(-4, 1),\n        tokenSpecDef(0, 2, true, \"Calavera\"),\n        tokenSpecDef(0, 1, true, \"Sectario\"),\n        FALLO_AUTOMATICO\n    );\n}\n\nfunction hard (): TokenBagSpec {\n    return buildBagSpec(\n        tokenSpecDef(1, 1, false, \"elderSign\"),\n        tokenSpecDef(0, 3),\n        tokenSpecDef(-1, 2),\n        tokenSpecDef(-2,2),\n        tokenSpecDef(-3, 2),\n        tokenSpecDef(-4, 1),\n        tokenSpecDef(-5, 1),\n        tokenSpecDef(0, 2, true, \"Calavera\"),\n        tokenSpecDef(0, 1, true, \"Sectario\"),\n        FALLO_AUTOMATICO\n    );\n}\n\nfunction expert (): TokenBagSpec {\n    return buildBagSpec(\n        tokenSpecDef(1, 1, false, \"elderSign\"),\n        tokenSpecDef(0, 1),\n        tokenSpecDef(-1, 2),\n        tokenSpecDef(-2,2),\n        tokenSpecDef(-3, 2),\n        tokenSpecDef(-4, 2),\n        tokenSpecDef(-5, 1),\n        tokenSpecDef(-6, 1),\n        tokenSpecDef(-8, 1),\n        tokenSpecDef(0, 2, true, \"Calavera\"),\n        tokenSpecDef(0, 1, true, \"Sectario\"),\n        FALLO_AUTOMATICO\n    );\n}\n\nfunction ActividadExtracurricular(): IScenarioSpec {\n    const CARDS_IN_DISCARD_PILE=\"Cards in your discard pile\";\n    const COST_OF_DISCARED_CARDS=\"Printed cost of discarded cards\";\n    return {\n        name: \"Extracurricular Activiry\",\n        translations: {\n            \"es\": \"Actividad extracurricular\",\n        },\n        scenarioEffectSpec: [\n            {name: \"elderSign\", effect: (tokenBag) => tokenBag.character.elderSignEffect(tokenBag)},\n            {name: \"Calavera\", effect: (tokenBag) => -1},\n            {name: \"Sectario\", effect: (tokenBag) => tokenBag.context[CARDS_IN_DISCARD_PILE] >= 10 ? -3 : -1},\n            {name: \"Antiguo\", effect: (tokenBag) => -tokenBag.context[COST_OF_DISCARED_CARDS]},\n        ],\n        contextSpec: {\n            valuesSpec: [{\n                name: CARDS_IN_DISCARD_PILE,\n                description: \"Cards in your discard pile\",\n                type: \"number\",\n                initialValue: 0,\n                translations: {\n                    \"es\": \"Cartas en tu pila de descarte\"\n                }\n            }, {\n                name: COST_OF_DISCARED_CARDS,\n                description: \"Discard two cards X is the total printed cost of those discarded cardfs\",\n                type: \"number\",\n                initialValue: 3,\n                translations: {\n                    \"es\": \"Coste impreso de las cartas descartadas\"\n                }\n            }\n            ]\n        }\n    };\n}\n\nfunction LaCasaSiempreGana(): IScenarioSpec {\n    const SPEND_2_RESOURCES=\"Spend 2 resources to treat skull token as 0\";\n    return {\n        name: \"The House Always Win\",\n        translations: {\n            \"es\": \"La casa siempre gana\",\n        },\n        scenarioEffectSpec: [\n            {name: \"elderSign\", effect: (tokenBag) => tokenBag.character.elderSignEffect(tokenBag)},\n            {name: \"Calavera\", effect: (tokenBag) => tokenBag.context[SPEND_2_RESOURCES] ? 0 : -2},\n            {name: \"Sectario\", effect: (tokenBag) => -3},\n            {name: \"Lápida\", effect: (tokenBag) => -2},\n        ],\n        contextSpec: {\n            valuesSpec: [{\n                name: SPEND_2_RESOURCES,\n                description: \"You may spend 2 resources to treat this token as a 0, instead.\",\n                type: \"boolean\",\n                initialValue: false,\n                translations: {\n                    \"es\": \"Gasta 2 recursos para tratar la calavera como un token 0\"\n                }\n            }]\n        }\n    };\n}\n\nfunction ElMuseoMiskatonic(): IScenarioSpec {\n    const HAUNTING_HORROR_AT_YOUR_LOCATION=\"Haunting horror at your location\";\n    return {\n        name: \"The Miskatonic Museum\",\n        translations: {\n            \"es\": \"El Museo Miskatonic\",\n        },\n        scenarioEffectSpec: [\n            {name: \"elderSign\", effect: (tokenBag) => tokenBag.character.elderSignEffect(tokenBag)},\n            {name: \"Calavera\", effect: (tokenBag) => tokenBag.context[HAUNTING_HORROR_AT_YOUR_LOCATION] ? -3 : -1},\n            {name: \"Sectario\", effect: (tokenBag) => -1},\n            {name: \"Lápida\", effect: (tokenBag) => -2},\n            {name: \"Antiguo\", effect: (tokenBag) => -3},\n        ],\n        contextSpec: {\n            valuesSpec: [{\n                name: HAUNTING_HORROR_AT_YOUR_LOCATION,\n                description: \"Haunting horror at your location\",\n                type: \"boolean\",\n                initialValue: false,\n                translations: {\n                    \"es\": \"Horrendo cazador está en tu Lugar\"\n                }\n            }]\n        }\n    };\n}\n\nfunction ElEssexCountyExpress(): IScenarioSpec {\n    const CURRENT_AGENDA=\"Current Agenda #\";\n    return {\n        name: \"Essex County Express\",\n        translations: {\n            \"es\": \"El Essex County Express\",\n        },\n        scenarioEffectSpec: [\n            {name: \"elderSign\", effect: (tokenBag) => tokenBag.character.elderSignEffect(tokenBag)},\n            {name: \"Calavera\", effect: (tokenBag) => -tokenBag.context[CURRENT_AGENDA]},\n            {name: \"Sectario\", effect: (tokenBag) => -1},\n            {name: \"Lápida\", effect: (tokenBag) => -2},\n            {name: \"Antiguo\", effect: (tokenBag) => -3},\n        ],\n        contextSpec: {\n            valuesSpec: [{\n                name: CURRENT_AGENDA,\n                description: \"\",\n                type: \"number\",\n                initialValue: 1,\n                translations: {\n                    \"es\": \"Número de plan en curso\"\n                }\n            }]\n        }\n    };\n}\n\nfunction SangreEnElAltar(): IScenarioSpec {\n    const LOCATION_WITHOUT=\"Location cards in play with no card underneath\";\n    return {\n        name: \"Blood on the Altar\",\n        translations: {\n            \"es\": \"Sangre en el altar\",\n        },\n        scenarioEffectSpec: [\n            {name: \"elderSign\", effect: (tokenBag) => tokenBag.character.elderSignEffect(tokenBag)},\n            {name: \"Calavera\", effect: (tokenBag) => -Math.min(4, tokenBag.context[LOCATION_WITHOUT] as number)},\n            {name: \"Sectario\", effect: (tokenBag) => -2},\n            {name: \"Lápida\", effect: (tokenBag) => -2},\n            {name: \"Antiguo\", effect: (tokenBag) => -3},\n        ],\n        contextSpec: {\n            valuesSpec: [{\n                name: LOCATION_WITHOUT,\n                description: \"Location cards in play with no card underneath\",\n                type: \"number\",\n                initialValue: 0,\n                translations: {\n                    \"es\": \"Lugares sin ninguna carta debajo\"\n                }\n            }]\n        }\n    };\n}\n\nfunction InvisiblesYSinDimension(): IScenarioSpec {\n    const BROOD_IN_PLAY=\"Brood in play\";\n    const REMOVE_A_CLUE_FROM_BROOD=\"Remove all clue tokens from a Brood\";\n    return {\n        name: \"Undimensioned and Unseen\",\n        translations: {\n            \"es\": \"Invisibles y sin dimension\",\n        },\n        scenarioEffectSpec: [\n            {name: \"elderSign\", effect: (tokenBag) => tokenBag.character.elderSignEffect(tokenBag)},\n            {name: \"Calavera\", effect: (tokenBag) => -tokenBag.context[BROOD_IN_PLAY]},\n            {name: \"Sectario\", effect: (tokenBag) => tokenAverage(seal(tokenBag, \"Sectario\"))},\n            {name: \"Lápida\", effect: (tokenBag) => tokenBag.context[REMOVE_A_CLUE_FROM_BROOD] ? 0 : -4},\n            {name: \"Antiguo\", effect: (tokenBag) => -3},\n        ],\n        contextSpec: {\n            valuesSpec: [{\n                name: BROOD_IN_PLAY,\n                description: \"Brood of Yog-Sothoth in play\",\n                type: \"number\",\n                initialValue: 0,\n                translations: {\n                    \"es\": \"Progenies en juego\"\n                }\n            },{\n                name: REMOVE_A_CLUE_FROM_BROOD,\n                description: \"Remove all clue tokens from a Brood\",\n                type: \"boolean\",\n                initialValue: false,\n                translations: {\n                    \"es\": \"Retirar todas las fichas de Pista de una Progenie\"\n                }\n            }]\n        }\n    };\n}\n\nfunction DondeAguardaLaPerdicion(): IScenarioSpec {\n    const ALTERED_LOCATION=\"Altered location\";\n    const AGENDA_2=\"Agenda 2\";\n    const COST_OF_DISCARED_CARDS=\"Printed cost of discarded cards\";\n    return {\n        name: \"Where Doom Awaits\",\n        translations: {\n            \"es\": \"Donde aguarda la perdición\",\n        },\n        scenarioEffectSpec: [\n            {name: \"elderSign\", effect: (tokenBag) => tokenBag.character.elderSignEffect(tokenBag)},\n            {name: \"Calavera\", effect: (tokenBag) => tokenBag.context[ALTERED_LOCATION] ? -3 : -1},\n            {name: \"Sectario\", effect: (tokenBag) => tokenAverage(seal(tokenBag, \"Sectario\"))},\n            {name: \"Lápida\", effect: (tokenBag) => tokenBag.context[AGENDA_2] ? -4 : -2},\n            {name: \"Antiguo\", effect: (tokenBag) => -tokenBag.context[COST_OF_DISCARED_CARDS]},\n        ],\n        contextSpec: {\n            valuesSpec: [{\n                name: ALTERED_LOCATION,\n                description: \"At an altered location\",\n                type: \"boolean\",\n                initialValue: false,\n                translations: {\n                    \"es\": \"Lugar Alterado\"\n                }\n            }, {\n                name: AGENDA_2,\n                description: \"It's agenda 2\",\n                type: \"boolean\",\n                initialValue: false,\n                translations: {\n                    \"es\": \"Plan 2\"\n                }\n            }, {\n                name: COST_OF_DISCARED_CARDS,\n                description: \"Discard two cards X is the total printed cost of those discarded cardfs\",\n                type: \"number\",\n                initialValue: 3,\n                translations: {\n                    \"es\": \"Coste impreso de las cartas descartadas\"\n                }\n            }]\n        }\n    };\n}\n\nfunction PerdidosEnElTiempoYEnElEspacio(): IScenarioSpec {\n    const EXTRADIMENSIONAL_LOCATIONS=\"Extradimensional locations\";\n    const SHROUD=\"Shroud of your location\"\n    return {\n        name: \"Lost in Time and Space\",\n        translations: {\n            \"es\": \"Perdidos en el tiempo y en el espacio\",\n        },\n        scenarioEffectSpec: [\n            {name: \"elderSign\", effect: (tokenBag) => tokenBag.character.elderSignEffect(tokenBag)},\n            {name: \"Calavera\", effect: (tokenBag) => -tokenBag.context[EXTRADIMENSIONAL_LOCATIONS]},\n            {name: \"Sectario\", effect: (tokenBag) => tokenAverage(seal(tokenBag, \"Sectario\"))},\n            {name: \"Lápida\", effect: (tokenBag) => -3},\n            {name: \"Antiguo\", effect: (tokenBag) => -tokenBag.context[SHROUD]},\n        ],\n        contextSpec: {\n            valuesSpec: [{\n                name: EXTRADIMENSIONAL_LOCATIONS,\n                description: \"Extradimensional locations in play\",\n                type: \"number\",\n                initialValue: 0,\n                translations: {\n                    \"es\": \"Lugares Extradimensionales\"\n                }\n            },{\n                name: SHROUD,\n                description: \"Shroud value of your location\",\n                type: \"number\",\n                initialValue: 2,\n                translations: {\n                    \"es\": \"Velo de tu lugar\"\n                }\n            }]\n        }\n    };\n}\n\nexport function buildElLegadoDeDunwichCampaignSpec(): ICampaignSpec {\n    return {\n        id: \"TheDunwichLegacy\",\n        name: \"The Dunwich Legacy\",\n        scenarios: [\n            ActividadExtracurricular(), LaCasaSiempreGana(), ElMuseoMiskatonic(), ElEssexCountyExpress(),\n            SangreEnElAltar(), InvisiblesYSinDimension(), DondeAguardaLaPerdicion(), PerdidosEnElTiempoYEnElEspacio()\n        ],\n        bagSpecsByLevel: {\n            easy: easy(),\n            normal: normal(),\n            hard: hard(),\n            expert: expert(),\n        },\n        translations: {\n            \"es\": \"El legado de Dunwich\"\n        }\n    }\n}","import {IScenarioSpec} from \"./Scenario\";\nimport {addTokens, TokenBagSpec, TokenSpec} from \"./Token\";\nimport {AHCharacter} from \"./AHCharacter\";\nimport {buildElCirculoRotoCampaignSpec} from \"./ElCirculoRoto\";\nimport {Translation} from \"../Utils\";\nimport {buildLaEraOlvidadaCampaignSpec} from \"./LaEraOlvidada\";\nimport {buildElLegadoDeDunwichCampaignSpec} from \"./ElLegadoDeDunwich\";\n\nexport type AHLevel = \"easy\" | \"normal\" | \"hard\" | \"expert\";\nexport const AHLevels = [\"easy\" , \"normal\" , \"hard\" , \"expert\"]\ntype IBagSpecByLevel = {\n    [key in AHLevel]: TokenBagSpec;\n};\n\nexport interface ICampaignSpec {\n    id: string;\n    name: string;\n    scenarios: IScenarioSpec[];\n    bagSpecsByLevel: IBagSpecByLevel;\n    translations: Translation;\n}\n\ninterface ICampaigns {\n    [key: string]: ICampaignSpec\n}\nexport const Campaigns: ICampaigns = {\n    TheCircleUndone: buildElCirculoRotoCampaignSpec(),\n    TheForgottenAge: buildLaEraOlvidadaCampaignSpec(),\n    TheDunwichLegacy: buildElLegadoDeDunwichCampaignSpec()\n}\n\nexport const campaignTranslations = Object.values(Campaigns).reduce<any>((allTrans, campaign) => {\n    const thisTranslations = campaign.translations;\n    Object.keys(thisTranslations).forEach(lang => {\n        if (allTrans[lang] === undefined) {\n            allTrans[lang] = {}\n        }\n        allTrans[lang][campaign.name] = thisTranslations[lang];\n    });\n    campaign.scenarios.forEach(scenario =>  {\n        Object.keys(scenario.translations).forEach(scenarioLang => {\n            if (allTrans[scenarioLang] === undefined) {\n                allTrans[scenarioLang] = {}\n            }\n            allTrans[scenarioLang][scenario.name] = scenario.translations[scenarioLang]\n        });\n        scenario.contextSpec.valuesSpec.forEach(valueSpec => {\n            Object.keys(valueSpec.translations).forEach(valueSpecLang => {\n                if (allTrans[valueSpecLang] === undefined) {\n                    allTrans[valueSpecLang] = {}\n                }\n                allTrans[valueSpecLang][valueSpec.name] = valueSpec.translations[valueSpecLang];\n            });\n\n        })\n    });\n    return allTrans;\n}, {});\n\ninterface ICampaign {\n}\n\nexport class Campaign implements ICampaign {\n    public currentScenario = 0;\n\n    constructor(public name: string,\n                public campaignSpec: ICampaignSpec,\n                public characters: AHCharacter[],\n                public currentBagSpec: TokenBagSpec,\n                currentScenario = 0) {\n        this.startCampaign(currentScenario);\n    }\n\n    public static start(campaignSpec: ICampaignSpec, characters: AHCharacter[], level: AHLevel): Campaign {\n        return new Campaign(campaignSpec.name, campaignSpec, characters, campaignSpec.bagSpecsByLevel[level]);\n    }\n\n\n    startCampaign(scenarioNum = 0) {\n        this.currentScenario = scenarioNum;\n        let scenarioIndex = 0;\n        while (scenarioIndex <= scenarioNum) {\n            this.currentScenario = scenarioIndex;\n            scenarioIndex++;\n        }\n    }\n\n    getScenarioSpec() {\n        return this.campaignSpec.scenarios[this.currentScenario];\n    }\n\n    addTokensToBagSpec(...tokens: TokenSpec[]) {\n        this.currentBagSpec = addTokens(this.currentBagSpec, ...tokens);\n    }\n\n    nextScenario() {\n        if ((this.currentScenario + 1 ) < this.campaignSpec.scenarios.length) {\n            this.currentScenario++;\n            // console.log(\"Current scenario index\", this.currentScenario, \"name\", this.campaignSpec.scenarios[this.currentScenario].name);\n            if (this.currentScenario >= this.campaignSpec.scenarios.length) {\n                // TODO: Modify current bag spec depending on resolution or preparation of new scenario\n                // advanceScenario\n            }\n        }\n        return this.getScenarioSpec();\n    }\n\n    // Returns to the previous scenario with the bag as it was\n    prevScenario() {\n        if (this.currentScenario  > 0) {\n            this.currentScenario--;\n        }\n        return this.getScenarioSpec();\n    }\n}\n","import {\n    addTokens,\n    buildBagSpec,\n    FALLO_AUTOMATICO,\n    removeToken, seal,\n    tokenAverage, TokenBag,\n    TokenBagSpec,\n    tokenSpecDef\n} from \"./Token\";\nimport {AHLevel, Campaign, ICampaignSpec} from \"./Campaign\";\nimport {IScenarioSpec} from \"./Scenario\";\nimport {AHCharacter, AHCharacters} from \"./AHCharacter\";\n\n\nfunction easy(): TokenBagSpec {\n    return buildBagSpec(\n        tokenSpecDef(1, 1, false, \"elderSign\"),\n        tokenSpecDef(1, 2),\n        tokenSpecDef(0, 3),\n        tokenSpecDef(-1, 2),\n        tokenSpecDef(-2,1),\n        tokenSpecDef(-3, 1),\n        tokenSpecDef(0, 2, true, \"Calavera\"),\n        FALLO_AUTOMATICO\n    );\n}\nexport function normal(): TokenBagSpec {\n    return buildBagSpec(\n        tokenSpecDef(1, 1, false, \"elderSign\"),\n        tokenSpecDef(1, 1),\n        tokenSpecDef(0, 2),\n        tokenSpecDef(-1, 2),\n        tokenSpecDef(-2,2),\n        tokenSpecDef(-3, 1),\n        tokenSpecDef(-4, 1),\n        tokenSpecDef(0, 2, true, \"Calavera\"),\n        FALLO_AUTOMATICO\n        );\n}\nfunction hard (): TokenBagSpec {\n    return addTokens(\n            removeToken(normal(), \"1\"),\n            tokenSpecDef(-5, 1),\n    )\n}\n\nfunction expert (): TokenBagSpec {\n    return buildBagSpec(\n        tokenSpecDef(1, 1, false, \"elderSign\"),\n        tokenSpecDef(0, 1),\n        tokenSpecDef(-1, 2),\n        tokenSpecDef(-2,2),\n        tokenSpecDef(-3, 1),\n        tokenSpecDef(-4, 1),\n        tokenSpecDef(-6, 1),\n        tokenSpecDef(-8, 1),\n        tokenSpecDef(0, 2, true, \"Calavera\"),\n        FALLO_AUTOMATICO\n    );\n}\n\nfunction Prologo(): IScenarioSpec {\n    return {\n        name: \"Disappearance at the Twilight Estate\",\n        translations: {\n            \"es\": \"Desaparición en la finca del crepúsculo\",\n        },\n        scenarioEffectSpec: [\n            {name: \"elderSign\", effect: (tokenBag) => tokenBag.character.elderSignEffect(tokenBag)},\n            {name: \"Calavera\", effect: () => -3},\n        ],\n        contextSpec: {\n            valuesSpec: []\n        }\n    };\n}\n\nfunction LaHoraBruja(): IScenarioSpec {\n    return {\n        name: \"The Witching Hour\",\n        translations: {\n            \"es\": \"La hora bruja\"\n        },\n        scenarioEffectSpec: [\n            { name: \"elderSign\", effect: (tokenBag) => tokenBag.character.elderSignEffect(tokenBag) },\n            { name: \"Calavera\", effect: () => -1 },\n            { name: \"Lápida\", effect: () => -3 },\n            { name: \"Antiguo\", effect: () => -3 },\n        ],\n        contextSpec: {\n            valuesSpec: []\n        }\n    }\n}\n\nfunction ALasPuertasDeLaMuerte(): IScenarioSpec {\n    const HAUNTED_LOCATION = \"Haunted location\";\n    return {\n        name: \"At Death's Doorstep\",\n        translations: {\n            \"es\": \"A las puertas de la muerte\",\n        },\n        scenarioEffectSpec: [\n            { name: \"elderSign\", effect: (tokenBag) => tokenBag.character.elderSignEffect(tokenBag) },\n            { name: \"Calavera\", effect: (tokenBag) => tokenBag.context[HAUNTED_LOCATION] ? -3 : -1 },\n            { name: \"Lápida\", effect: () => -2 },\n            { name: \"Antiguo\", effect: () => -2 },\n        ],\n        contextSpec: {\n            valuesSpec: [{\n                name: HAUNTED_LOCATION,\n                description: \"Haunted location\",\n                type: \"boolean\",\n                initialValue: false,\n                translations: {\n                    \"es\": \"Lugar embrujado\"\n                }\n            }]\n        }\n    }\n}\n\nfunction ElNombreSecreto(): IScenarioSpec {\n    const EXTRADIMENSIONAL_LOCATION = \"Extradimensional location\";\n    return {\n        name: \"The Secret Name\",\n        translations: {\n            \"es\": \"El nombre secreto\",\n        },\n        scenarioEffectSpec: [\n            { name: \"elderSign\", effect: (tokenBag) => tokenBag.character.elderSignEffect(tokenBag) },\n            { name: \"Calavera\", effect: (tokenBag) => tokenBag.context[EXTRADIMENSIONAL_LOCATION] ? -3 : -1 },\n            { name: \"Sectario\", effect: tokenBag => tokenAverage(seal(tokenBag, \"Sectario\"))},\n            { name: \"Lápida\", effect: () => -2 },\n            { name: \"Antiguo\", effect: () => -3 },\n        ],\n        contextSpec: {\n            valuesSpec: [{\n                name: EXTRADIMENSIONAL_LOCATION,\n                description: \"Extradimensional location\",\n                type: \"boolean\",\n                initialValue: false,\n                translations: {\n                    \"es\": \"Lugar Extradimensional\"\n                }\n            }]\n        }\n    }\n}\n\nfunction LaPagaDelPecado(): IScenarioSpec {\n    const UNFINISHED_BUSINESS = \"Unfinished business\";\n    const FIGHTING_EVADING_HERETIC = \"Fighting/evading Heretic\";\n    return {\n        name: \"The Wages of Sin\",\n        translations: {\n            \"es\": \"La paga del pecado\",\n        },\n        scenarioEffectSpec: [\n            {name: \"elderSign\", effect: (tokenBag) => tokenBag.character.elderSignEffect(tokenBag)},\n            {name: \"Calavera\", effect: (tokenBag) => 0 - (tokenBag.context[UNFINISHED_BUSINESS] as number)},\n            {name: \"Sectario\", effect: (tokenBag) => tokenBag.context[FIGHTING_EVADING_HERETIC] ? -4 : -3 },\n            {name: \"Lápida\", effect: () => -3},\n            {name: \"Antiguo\", effect: () => -2},\n        ],\n        contextSpec: {\n            valuesSpec: [\n                {\n                    name: UNFINISHED_BUSINESS,\n                    description: \"Unfinished business\",\n                    type: \"number\",\n                    initialValue: 0,\n                    translations: {\n                        \"es\": \"Asuntos inconclusos\",\n                    }\n                },\n                {\n                    name: FIGHTING_EVADING_HERETIC,\n                    description: \"Fighting/evading Heretic\",\n                    type: \"boolean\",\n                    initialValue: false,\n                    translations: {\n                        \"es\": \"Atacando/Evitando Hereje\"\n                    }\n                }\n            ]\n        }\n    };\n}\n\nfunction PorElBienComun(): IScenarioSpec {\n    const MAXIMA_PERDICION = \"Max Doom\";\n    return {\n        name: \"For the Greater Good\",\n        translations: {\n            \"es\": \"Por el bien común\",\n        },\n        scenarioEffectSpec: [\n            {name: \"elderSign\", effect: (tokenBag) => tokenBag.character.elderSignEffect(tokenBag)},\n            {name: \"Calavera\", effect: (tokenBag) => 0 - (tokenBag.context[MAXIMA_PERDICION] as number)},\n            {name: \"Sectario\", effect: tokenBag => tokenAverage(seal(tokenBag, \"Sectario\")) - 2},\n            {name: \"Lápida\", effect: () => -3},\n            {name: \"Antiguo\", effect: () => -3},\n        ],\n        contextSpec: {\n            valuesSpec: [{\n                name: MAXIMA_PERDICION,\n                description: \"Highest number of doom on a Cultist\",\n                type: \"number\",\n                initialValue: 0,\n                translations: {\n                    \"es\": \"Máxima perdición\"\n                }\n            }]\n        }\n    };\n}\n\nfunction UnionYDesilusion(): IScenarioSpec {\n    const ACCION_CIRCULO = \"Circle action\";\n    return {\n        name: \"Union and Disillusion\",\n        translations: {\n            \"es\": \"Unión y desilusión\"\n        },\n        scenarioEffectSpec: [\n            {name: \"elderSign\", effect: (tokenBag) => tokenBag.character.elderSignEffect(tokenBag)},\n            {name: \"Calavera\", effect: (tokenBag) =>\n                    tokenBag.context[ACCION_CIRCULO] ? tokenAverage(seal(tokenBag, \"Calavera\")) - 2 : -2},\n            {name: \"Sectario\", effect: () => -3},\n            {name: \"Lápida\", effect: () => -3},\n            {name: \"Antiguo\", effect: () => -3},\n        ],\n        contextSpec: {\n            valuesSpec: [{\n                name: ACCION_CIRCULO,\n                description: \"This skill test is a circle action\",\n                type: \"boolean\",\n                initialValue: false,\n                translations: {\n                    \"es\": \"Acción círculo\"\n                }\n            }]\n        }\n    };\n}\n\nfunction EnLasGarrasDelCaos(): IScenarioSpec {\n    const PERDICION_Y_BRECHA = \"Doom and breaches on your location\";\n    const getPerdicionYBrecha = (tokenBag: TokenBag) => {\n        return tokenBag.context[PERDICION_Y_BRECHA] as number;\n    }\n\n    return {\n        name: \"In the Clutches of Chaos\",\n        translations: {\n          \"es\": \"En las garras del caos\",\n        },\n        scenarioEffectSpec: [\n            {name: \"elderSign\", effect: (tokenBag) => tokenBag.character.elderSignEffect(tokenBag)},\n            {name: \"Calavera\", effect: (tokenBag) => 0 - getPerdicionYBrecha(tokenBag)},\n            {name: \"Sectario\", effect: (tokenBag) => {\n                //Creates a new bag and a new context for this calculation\n                    const potentialBag = seal(tokenBag, \"Sectario\");\n                    potentialBag.context = {\n                        [PERDICION_Y_BRECHA]: Math.max(3, getPerdicionYBrecha(tokenBag) + 1),\n                    }\n                    return tokenAverage(potentialBag);\n                }},\n            {name: \"Lápida\", effect: () => -2},\n            {name: \"Antiguo\", effect: () => -3},\n        ],\n        contextSpec: {\n            valuesSpec: [{\n                name: PERDICION_Y_BRECHA,\n                description: \"Total amount of doom and breaches on your location\",\n                type: \"number\",\n                initialValue: 0,\n                translations: {\n                    \"es\": \"Perdición y brecha en tu lugar\"\n                }\n            }]\n        }\n    };\n}\n\nfunction AnteElTronoNegro(): IScenarioSpec {\n    const PERDICION_EN_AZATHOTH = \"Doom on Azathoth\";\n    const getHalfDoomInAzathot = (tokenBag: TokenBag) => {\n        return Math.ceil((tokenBag.context[PERDICION_EN_AZATHOTH] as number) / 2);\n    }\n\n    return {\n        name: \"Before the Black Throne\",\n        translations: {\n            \"es\": \"Ante el trono negro\"\n        },\n        scenarioEffectSpec: [\n            {name: \"elderSign\", effect: (tokenBag) => tokenBag.character.elderSignEffect(tokenBag)},\n            {name: \"Calavera\", effect: (tokenBag) => 0 - Math.max(2, getHalfDoomInAzathot(tokenBag))},\n            {name: \"Sectario\", effect: (tokenBag) => tokenAverage(seal(tokenBag, \"Sectario\"))},\n            {name: \"Lápida\", effect: () => -2},\n            {name: \"Antiguo\", effect: () => -4},\n        ],\n        contextSpec: {\n            valuesSpec: [{\n                name: PERDICION_EN_AZATHOTH,\n                description: PERDICION_EN_AZATHOTH,\n                type: \"number\",\n                initialValue: 0,\n                translations: {\n                    \"es\": \"Perdición en Azathoth\"\n                }\n            }]\n        }\n    };\n}\n\nexport function buildElCirculoRotoCampaignSpec(): ICampaignSpec {\n    return {\n        id: \"TheCircleUndone\",\n        name: \"The Circle Undone\",\n        scenarios: [\n            Prologo(),\n            LaHoraBruja(), ALasPuertasDeLaMuerte(), ElNombreSecreto(), LaPagaDelPecado(),\n            PorElBienComun(), UnionYDesilusion(), EnLasGarrasDelCaos(), AnteElTronoNegro()\n        ],\n        bagSpecsByLevel: {\n            easy: easy(),\n            normal: normal(),\n            hard: hard(),\n            expert: expert(),\n        },\n        translations: {\n            \"es\": \"El círculo roto\"\n        }\n    }\n}\n\nexport function startElCirculoRoto(characters: AHCharacter[], level: AHLevel) {\n    return Campaign.start(buildElCirculoRotoCampaignSpec(), characters, level);\n}\n\nexport function startAlvaroElCirculoRotoLPDP() {\n    const campaign = startElCirculoRoto([\n        AHCharacters[\"JoeDiamond\"], AHCharacters[\"DianaStanley\"],\n        // {name: \"Joe Diamond\", shortName: \"Joe\", elderSignEffect: () => 1},\n        // {name: \"Diana Stanley\", shortName: \"Diana\", elderSignEffect: () => 2},\n    ], \"normal\");\n    campaign.addTokensToBagSpec(\n        tokenSpecDef(0, 2, true, \"Lápida\"), // <- La hora bruja: Los inv han aceptado su destino\n        tokenSpecDef(0, 1, true, \"Sectario\"), // <- El precio del progreso, unirme a la logia\n        tokenSpecDef(0, 1, true, \"Calavera\"), // <- El nombre secreto, coger el Libro Negro\n        // tokenSpecDef(0, 1, true, \"Antiguo\"),\n        // tokenSpecDef(-5, 1, false),\n    );\n    campaign.startCampaign(0);\n    return campaign;\n}","import {CombinedState, combineReducers, Reducer} from \"redux\";\nimport {Campaign} from \"./tok/Campaign\";\nimport {initContext, IScenarioSpec} from \"./tok/Scenario\";\nimport {\n    addTokens,\n    incDecContextNatural,\n    removeToken,\n    ScenarioContext,\n    TokenBagSpec\n} from \"./tok/Token\";\nimport {startAlvaroElCirculoRotoLPDP} from \"./tok/ElCirculoRoto\";\nimport {\n    ADD_TOKEN,\n    CHANGE_CHARACTER,\n    CHANGE_SCENARIO,\n    CHANGE_SKILL,\n    CHANGE_TEST,\n    IAppAction, ICampaignSelectAction,\n    ICharacterAction,\n    IContextAction,\n    IIncDecAction,\n    INC_DEC_CONTEXT_VALUE,\n    IScenarioAction, ITokenAction,\n    NEXT_SCENARIO,\n    PREV_SCENARIO, REMOVE_TOKEN, SELECT_CAMPAIGN,\n    TOGGLE_CONTEXT_VALUE\n} from \"./AppActions\";\nimport {AppState} from \"./AppState\";\nimport {SkillTest} from \"./tok/SkillTest\";\nimport {AHCharacter} from \"./tok/AHCharacter\";\nimport {incDecNatural} from \"./Utils\";\n\n\nconst defaultCampaign = startAlvaroElCirculoRotoLPDP();\n\nconst  selectedCampaign: Reducer<Campaign, IAppAction> = (state: Campaign = defaultCampaign, action: IAppAction) => {\n    switch (action.type) {\n        case NEXT_SCENARIO:\n            state.nextScenario();\n            return state;\n        case PREV_SCENARIO:\n            state.prevScenario();\n            return state;\n        case SELECT_CAMPAIGN:\n            return (action as ICampaignSelectAction).campaign;\n        default:\n            return state;\n    }\n}\n\n\nconst firstScenario = defaultCampaign.getScenarioSpec();\nconst selectedScenario: Reducer<IScenarioSpec, IAppAction> = (state = firstScenario, action: IAppAction) => {\n    switch (action.type) {\n        case SELECT_CAMPAIGN:\n            return (action as ICampaignSelectAction).campaign.getScenarioSpec();\n        case CHANGE_SCENARIO:\n            return (action as IScenarioAction).scenarioSpec;\n        default:\n            return state;\n    }\n}\n\nconst selectedCharacter: Reducer<AHCharacter, IAppAction> = (state = defaultCampaign.characters[0], action: IAppAction) => {\n    switch (action.type) {\n        case CHANGE_CHARACTER:\n            return (action as ICharacterAction).character;\n        case SELECT_CAMPAIGN:\n            return (action as ICampaignSelectAction).campaign.characters[0];\n        default:\n            return state;\n    }\n}\nconst initialContext = initContext(firstScenario.contextSpec);\nconst gameContext: Reducer<ScenarioContext, IAppAction> = (gameContext = initialContext, action: IAppAction) => {\n    switch (action.type) {\n        case SELECT_CAMPAIGN:\n            return initContext((action as ICampaignSelectAction).campaign.getScenarioSpec().contextSpec);\n        case CHANGE_SCENARIO:\n            return initContext((action as IScenarioAction).scenarioSpec.contextSpec);\n        case INC_DEC_CONTEXT_VALUE:\n            const contextAction = action as IContextAction & IIncDecAction;\n            const key = contextAction.key;\n            return Object.assign({}, gameContext, {\n                [key]: incDecContextNatural(gameContext, key, contextAction.incDec)\n            });\n        case TOGGLE_CONTEXT_VALUE:\n            const contextToggleAction = action as IContextAction;\n            return Object.assign({}, gameContext, {\n                [contextToggleAction.key]: !(gameContext[contextToggleAction.key] as boolean)\n            });\n        default:\n            return gameContext;\n    }\n}\n\nconst initialSkillTest = {skill: 4, test: 2} as SkillTest;\nconst skillTest: Reducer<SkillTest, IAppAction> = (state = initialSkillTest, action) => {\n    const skillTestAction = action as IIncDecAction;\n    switch (action.type) {\n        case CHANGE_SKILL:\n            return Object.assign({}, state, {\n                skill: incDecNatural(state.skill, skillTestAction.incDec)\n            });\n        case CHANGE_TEST:\n            return Object.assign({}, state, {\n                test: incDecNatural(state.test, skillTestAction.incDec)\n            });\n        default:\n            return state;\n\n    }\n}\n\nconst bagSpec: Reducer<TokenBagSpec, IAppAction> = (state = defaultCampaign.currentBagSpec, action) => {\n    const tokenAction = action as ITokenAction;\n    switch (action.type) {\n        case SELECT_CAMPAIGN:\n            return (action as ICampaignSelectAction).campaign.currentBagSpec;\n        case ADD_TOKEN:\n            return addTokens(state, tokenAction.tokenSpec);\n        case REMOVE_TOKEN:\n            return removeToken(state, tokenAction.tokenSpec.name);\n        default:\n            return state;\n    }\n}\n\nexport const appReducers: Reducer<CombinedState<AppState>, IAppAction>  = combineReducers<AppState, IAppAction>({\n    selectedCampaign,  bagSpec, selectedCharacter, selectedScenario, gameContext, skillTest\n});\n","import {createStore, Store} from \"redux\";\nimport {appReducers} from \"./AppReducers\";\nimport {IAppAction} from \"./AppActions\";\nimport {AppState} from \"./AppState\";\nimport {Campaign, Campaigns, ICampaignSpec} from \"./tok/Campaign\";\nimport {SkillTest} from \"./tok/SkillTest\";\nimport {ScenarioContext, TokenBagSpec} from \"./tok/Token\";\nimport {AHCharacters} from \"./tok/AHCharacter\";\nimport {initContext} from \"./tok/Scenario\";\nimport {startAlvaroLaEraOlvidada} from \"./tok/LaEraOlvidada\";\n\n\ninterface IStorageStage {\n    name: string;\n    campaignSpecId: string;\n    bagSpec: TokenBagSpec;\n    characters: string[];\n    currentScenario: number;\n    currentCharacter: string;\n    currentContext: ScenarioContext;\n}\nfunction loadStorageStage(): IStorageStage | undefined {\n    const storageStateString = localStorage.getItem(\"ahtok.kortsoft.net/state\");\n    return storageStateString ? JSON.parse(storageStateString) : undefined;\n}\n\n\nconst LANGUAGE_STORE_KEY = \"ahtok.kortsoft.net/lang\";\n\nexport function loadCurrentLang() {\n    const appLang = localStorage.getItem(LANGUAGE_STORE_KEY);\n    if (appLang === null) {\n        let userLang: string = navigator.language;\n        const dashPosition = userLang.indexOf(\"-\");\n        if (dashPosition > -1) {\n            userLang = userLang.substring(0, dashPosition);\n        }\n        return userLang;\n    }\n    return appLang;\n}\n\nfunction initialState():AppState {\n    function defaultCampaign() {\n        return startAlvaroLaEraOlvidada();\n    }\n    const preloadCampaign = loadStorageStage();\n    if (preloadCampaign) {\n        const campaignSpec: ICampaignSpec = Campaigns[preloadCampaign.campaignSpecId];\n        const characters = preloadCampaign.characters.map(cId => AHCharacters[cId]);\n        const campaign = new Campaign(\n            preloadCampaign.name, campaignSpec, characters,\n            preloadCampaign.bagSpec, preloadCampaign.currentScenario);\n        const character = AHCharacters[preloadCampaign.currentCharacter];\n        return {\n            selectedCampaign: campaign,\n            selectedScenario: campaign.getScenarioSpec(),\n            selectedCharacter: character,\n            skillTest: {skill: 4, test: 2} as SkillTest,\n            gameContext: preloadCampaign.currentContext,\n            bagSpec: preloadCampaign.bagSpec\n        }\n    } else {\n        const campaign = defaultCampaign();\n        const currentScenarioSpec = campaign.getScenarioSpec();\n        return {\n            selectedCampaign: campaign,\n            selectedScenario: currentScenarioSpec,\n            selectedCharacter: campaign.characters[0],\n            skillTest: {skill: 4, test: 2} as SkillTest,\n            gameContext: initContext(currentScenarioSpec.contextSpec),\n            bagSpec: campaign.currentBagSpec,\n        };\n    }\n\n}\n\nconst appState = initialState();\nexport let store: Store<AppState, IAppAction> =\n    createStore<AppState, IAppAction, {}, {}>(appReducers, appState);\n\nexport function resetStore() {\n    store = createStore<AppState, IAppAction, {}, {}>(appReducers);\n}\n\nexport function saveLang(lang: string) {\n    localStorage.setItem(LANGUAGE_STORE_KEY, lang);\n}\n\nstore.subscribe(() => {\n    const campaign = store.getState().selectedCampaign;\n    const newStorageCampaign: IStorageStage = {\n        name: campaign.name,\n        campaignSpecId: campaign.campaignSpec.id,\n        bagSpec: store.getState().bagSpec,\n        characters: campaign.characters.map(c => c.id),\n        currentScenario: campaign.currentScenario,\n        currentCharacter: store.getState().selectedCharacter.id,\n        currentContext: store.getState().gameContext\n    };\n    localStorage.setItem(\"ahtok.kortsoft.net/state\", JSON.stringify(newStorageCampaign));\n});","import {AHLevel, AHLevels, Campaign, Campaigns} from \"./tok/Campaign\";\nimport {useTranslation} from \"react-i18next\";\nimport React, {useState} from \"react\";\nimport {useModalStyles} from \"./CommonStyles\";\nimport {\n    Box,\n    Button,\n    Checkbox,\n    createStyles,\n    FormControl,\n    FormControlLabel,\n    FormGroup,\n    FormLabel,\n    InputLabel,\n    makeStyles,\n    MenuItem,\n    Select,\n    Theme,\n    Typography\n} from \"@material-ui/core\";\nimport {connect} from \"react-redux\";\nimport {AppState} from \"./AppState\";\nimport {Dispatch} from \"redux\";\nimport {selectCampaign} from \"./AppActions\";\nimport {AHCharacter, AHCharacters} from \"./tok/AHCharacter\";\n\nconst useStyles = makeStyles((theme: Theme) =>\n    createStyles({\n        formControl: {\n            margin: theme.spacing(1),\n            minWidth: 120,\n        },\n        selectEmpty: {\n            marginTop: theme.spacing(2),\n        },\n    }),\n);\ntype WizardProps = { campaignWizard: CampaignWizard, setCampaignWizard: (campaignWizard: CampaignWizard) => void }\nexport const CampaignWizardChanger = connect((_: AppState) => ({}),\n    (dispatch: Dispatch, ownProps: { close: () => void }) => ({\n        setCampaign: (campaign: Campaign) => {\n            ownProps.close();\n            dispatch(selectCampaign(campaign));\n        }\n    }))(CampaignWizardComp)\n\nfunction CampaignWizardComp({setCampaign}: { setCampaign: (campaign: Campaign) => void }) {\n    const {t} = useTranslation();\n    const [campaignWizard, setCampaignWizard] = useState({characters: []} as CampaignWizard)\n    const classes = useModalStyles();\n\n    function selectCampaignId(campaignId: string) {\n        setCampaignWizard({campaignId, characters: []})\n    }\n\n    function setCampaignFromWizard(campaignWizard: CampaignWizard) {\n\n        const campaignSpec = Campaigns[campaignWizard.campaignId!];\n        const campaign = Campaign.start(campaignSpec, campaignWizard.characters, campaignWizard.level!);\n        campaign.startCampaign(0);\n        setCampaign(campaign);\n    }\n\n    return (\n        <Box textAlign=\"center\" className={classes.paper}>\n            <Typography id=\"bag-management-title\" variant=\"h3\">{t('Create campaign')}</Typography>\n            <InputLabel style={{marginTop: \"15px\"}}>{t('Select campaign')}</InputLabel>\n            <FormControl variant=\"standard\" className={useStyles().formControl}>\n                <Select\n                    labelId=\"campaign-selector-label\"\n                    id=\"campaign-selector\"\n                    value={campaignWizard.campaignId ?? \"\"}\n                    onChange={e => selectCampaignId(e.target.value as string)}>\n                    {Object.keys(Campaigns).map(campaignId => (\n                        <MenuItem key={campaignId} value={campaignId}>{t(Campaigns[campaignId].name)}</MenuItem>\n                    ))}\n                </Select>\n            </FormControl>\n            {campaignWizard.campaignId ?\n                <WizardStep2 campaignWizard={campaignWizard} setCampaignWizard={setCampaignWizard}/> : null}\n            {campaignWizard.campaignId && campaignWizard.level && campaignWizard.characters.length > 0 ?\n                <Button onClick={() => setCampaignFromWizard(campaignWizard)}>{t('Create')}</Button> : null}\n        </Box>\n    )\n}\n\nfunction WizardStep2({campaignWizard, setCampaignWizard}: WizardProps) {\n    const {t} = useTranslation();\n\n    function selectLevel(level: AHLevel) {\n        setCampaignWizard(Object.assign({}, campaignWizard, {level}))\n    }\n\n    return (\n        <Box>\n            <InputLabel style={{marginTop: \"15px\"}}>{t('Select level')}</InputLabel>\n            <FormControl variant=\"standard\" className={useStyles().formControl}>\n                <Select\n                    labelId=\"level-selector-label\"\n                    id=\"level-selector\"\n                    value={campaignWizard.level ?? \"\"}\n                    onChange={e => selectLevel(e.target.value as AHLevel)}>\n                    {AHLevels.map(level => (\n                        <MenuItem key={level} value={level}>{t(level)}</MenuItem>\n                    ))}\n                </Select>\n            </FormControl>\n            {campaignWizard.level ?\n                <WizardStep3 campaignWizard={campaignWizard} setCampaignWizard={setCampaignWizard}/> : null}\n        </Box>\n    )\n}\n\nfunction WizardStep3({campaignWizard, setCampaignWizard}: { campaignWizard: CampaignWizard, setCampaignWizard: (campaignWizard: CampaignWizard) => void }) {\n    const {t} = useTranslation();\n\n    function contains(characterId: string) {\n        return campaignWizard.characters.some(ch => ch.id === characterId);\n    }\n\n    function addCharacter(ev: React.ChangeEvent<HTMLInputElement>, checked: boolean) {\n        const character = AHCharacters[ev.target.name as string];\n        let characters;\n        if (checked) {\n            characters = campaignWizard.characters.concat(character);\n        } else {\n            characters = campaignWizard.characters.filter(ch => ch.id !== character.id);\n        }\n        setCampaignWizard(Object.assign({}, campaignWizard, {characters}));\n    }\n\n    const error = campaignWizard.characters.length > 4;\n    return (\n        <Box>\n            <FormControl error={error} component=\"fieldset\" className={useStyles().formControl}>\n                <FormLabel component=\"legend\">{t('Pick up two four characters')}</FormLabel>\n                <FormGroup>\n                    {Object.keys(AHCharacters).map(characterId => (\n                        <FormControlLabel\n                            key={characterId}\n                            control={<Checkbox checked={contains(characterId)} onChange={addCharacter}\n                                               name={characterId}/>}\n                            label={AHCharacters[characterId].name}\n                        />\n                    ))}\n                </FormGroup>\n            </FormControl>\n        </Box>\n    )\n}\n\ninterface CampaignWizard {\n    campaignId?: string;\n    level?: AHLevel;\n    characters: AHCharacter[];\n}","import {Box, IconButton, Modal, Typography} from \"@material-ui/core\";\nimport {nonAscii} from \"./Utils\";\nimport React, {useState} from \"react\";\nimport {Campaign} from \"./tok/Campaign\";\nimport {useTranslation} from \"react-i18next\";\nimport {tokTheme} from \"./TokTheme\";\nimport {loadCurrentLang, saveLang} from \"./AppStore\";\nimport {CampaignWizardChanger} from \"./CampaignWizard\";\n\nconst Flags = require('country-flag-icons/react/3x2');\n\nexport function TokHeader({campaign}: {campaign: Campaign}) {\n    const [modalOpen, setModalOpen] = useState<boolean>(false);\n    const { t, i18n } = useTranslation();\n    const myLang = loadCurrentLang();\n    const themeSpec = tokTheme();\n    const campaignName = t(campaign.name);\n    const nonAsciiCharsInName = nonAscii(campaignName);\n\n    function changeLang(lang: string) {\n        i18n.changeLanguage(lang);\n        saveLang(lang);\n    }\n\n    return(\n        <Box className=\"App-header\">\n            <Box style={{float: \"right\"}}>\n                <Flags.GB className={\"IconAction\"} onClick={() => changeLang(\"en\")}\n                          style={{width: \"2em\", opacity: myLang === \"en\" ? \"1.0\" : \"0.4\"}}/>\n                <Flags.ES className={\"IconAction\"} onClick={() => changeLang(\"es\")}\n                          style={{width: \"2em\", opacity: myLang === \"es\" ? \"1.0\" : \"0.4\"}}/>\n            </Box>\n            <Typography onClick={() => setModalOpen(true)} style={{\n                cursor: \"pointer\",\n                fontFamily: nonAsciiCharsInName ? themeSpec.headerFontFamilyNonAscii : themeSpec.headerFontFamily,\n                textAlign: \"center\"}} variant=\"h2\" color=\"secondary\" variantMapping={{h1: \"header\"}} className=\"App-header\">\n                {campaignName}\n                <IconButton color=\"secondary\" className=\"IconAction material-icons\" style={{textAlign: \"center\"}} onClick={() => setModalOpen(true)}>edit</IconButton>\n            </Typography>\n            <Modal open={modalOpen} onClose={() => setModalOpen(false)} aria-labelledby=\"campaign-creatuib-title\">\n                <CampaignWizardChanger close={() => setModalOpen(false)}/>\n            </Modal>\n        </Box>\n    )\n}\n\n","import React from 'react';\nimport './App.css';\nimport {CurrentScenarioPassZone} from \"./tok/ScenarioPassZone\";\nimport {Box, Button, Container, CssBaseline} from \"@material-ui/core\";\nimport {ThemeProvider} from \"@material-ui/core/styles\";\nimport {tokTheme} from \"./TokTheme\";\nimport {connect} from \"react-redux\";\nimport {changeScenario as changeScenarioAction} from \"./AppActions\";\nimport {IScenarioSpec} from \"./tok/Scenario\";\nimport {useTranslation} from \"react-i18next\";\nimport {AppState} from \"./AppState\";\nimport {Campaign} from \"./tok/Campaign\";\nimport {TokHeader} from \"./TokHeader\";\n\nconst App = connect(\n    (store: AppState) => ({\n        campaign: store.selectedCampaign\n}),\n    (dispatch => ({\n        changeScenario: (scenario:IScenarioSpec) => dispatch(changeScenarioAction(scenario)),\n    }))\n)(AppComponent);\n\nfunction AppComponent({campaign, changeScenario}: {campaign: Campaign,\n                        changeScenario: (scenario: IScenarioSpec) => void}) {\n    const { t } = useTranslation();\n    return (\n    <ThemeProvider theme={tokTheme().theme}>\n        <CssBaseline>\n            <div className=\"App\">\n                <TokHeader campaign={campaign} />\n                <Container className=\"MainContainer\" maxWidth=\"lg\">\n                    <Box textAlign={\"center\"}>\n                        <Button color=\"secondary\"\n                                onClick={() => changeScenario(campaign.prevScenario())}>{t('prev')}</Button>\n                        <Button color=\"secondary\"\n                                onClick={() => changeScenario(campaign.nextScenario())}>{t('next')}</Button>\n                    </Box>\n                    <CurrentScenarioPassZone/>\n                </Container>\n            </div>\n        </CssBaseline>\n    </ThemeProvider>\n  );\n}\n\nexport default App;\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\ntype Config = {\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\n};\n\nexport function register(config?: Config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(\n      process.env.PUBLIC_URL,\n      window.location.href\n    );\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl: string, config?: Config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' }\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready\n      .then(registration => {\n        registration.unregister();\n      })\n      .catch(error => {\n        console.error(error.message);\n      });\n  }\n}\n","import i18 from \"i18next\";\nimport {initReactI18next} from \"react-i18next\";\nimport {campaignTranslations} from \"./tok/Campaign\";\n\nexport default function (lang = \"es\") {\n    i18.use(initReactI18next)\n        .init({\n            resources: {\n                es: {\n                    translation: {\n                        ...campaignTranslations[\"es\"],\n                        \"prev\": \"prev.\",\n                        \"next\": \"sig.\",\n                        \"Pass zone\": \"Zona de éxito\",\n                        \"Skill\": \"Habilidad\",\n                        \"Test\": \"Dificultad\",\n                        \"Bag average\": \"Valor medio\",\n                        \"Current character\": \"Personaje actual\",\n                        \"Manage chaos bag\": \"Gestionar bolsa del caos\",\n                        \"Chaos bag\": \"Bolsa del caos\",\n                        \"Current bag\": \"Bolsa actual\",\n                        \"Select tokens to remove them\": \"Selecciona tokens para eliminarlos\",\n                        \"Select tokens to add them to the bag\": \"Selecciona tokens para añadirlos a la bolsa\",\n                        \"Select campaign\": \"Selecciona campaña\",\n                        \"Create campaign\": \"Crear campaña\",\n                        \"Select level\": \"Selecciona nivel\",\n                        \"easy\": \"fácil\", \"normal\": \"normal\", \"hard\": \"difícil\", \"expert\": \"experto\",\n                        \"Pick up two four characters\": \"Elige hasta 4 personajes\",\n                        \"Create\": \"Crear\"\n                    }\n                },\n            },\n            lng: lang,\n            fallbackLng: \"en\"\n        })\n}","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport * as serviceWorker from './serviceWorker';\nimport {loadCurrentLang, store} from \"./AppStore\";\nimport {Provider} from \"react-redux\";\nimport I18n from \"./I18n\";\n\nI18n(loadCurrentLang());\nReactDOM.render(\n  <React.StrictMode>\n      <Provider store={store}>\n        <App />\n      </Provider>\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}