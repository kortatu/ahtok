{"version":3,"sources":["Utils.ts","tok/Token.ts","tok/TokenSpan.tsx","tok/ParamChanger.tsx","AppActions.ts","tok/SkillTestChanger.tsx","tok/PassZone.tsx","tok/CharacterSelector.tsx","AppState.ts","tok/Scenario.ts","tok/ContextManager.tsx","tok/TokenBag.tsx","tok/ScenarioPassZone.tsx","tok/AHCharacter.ts","tok/ElCirculoRoto.ts","tok/LaEraOlvidada.ts","tok/Campaign.ts","AppReducers.ts","AppStore.ts","App.tsx","I18n.tsx","TokTheme.ts","serviceWorker.ts","index.tsx"],"names":["incDecNatural","previous","incDec","Math","max","elderSignEffect","tokenBag","character","tokenSpecDef","value","count","chaos","name","actualName","id","uuid","copyTokenSpec","tokenSpec","findName","tokenBagSpec","tokens","find","t","removeToken","tokenName","newBag","map","ts","tokenSpecInBag","filter","addTokens","forEach","push","buildBagSpec","incDecContextNatural","state","key","buildEffectSpecs","effectMap","Map","effectSpecs","ns","set","effect","buildBagFromSpec","bagSpec","effects","context","tokenDef","get","FALLO_AUTOMATICO","sortTokens","sort","a","b","tokenFloatAverage","numOfTokens","reduce","sum","token","tokenAverage","floatAverage","floor","accumulated","previousValues","last","length","undefined","histogram","prev","curr","prevValue","concat","seal","tokensFiltered","decCount","tokenBagPassZone","accum","total","vc","prob","sorted","i","j","tokensWithValue","passZoneLines","tokenBagMap","skill","test","lines","stillPass","result","pass","nextPass","currentProb","firstFail","TokenSpan","props","useState","fadeIn","setFadeIn","Fade","in","onExited","onClick","style","cursor","className","fadeOut","fadeOutFadeIn","ContextValueChanger","valueSpec","useTranslation","type","NumericParamChanger","inline","currentValue","incValue","incDecContextValue","decValue","BooleanParamChanger","toggle","toggleContextValue","incDecStyle","verticalAlign","InputLabel","IconButton","_","Switch","checked","onChange","color","inputProps","changeSkill","changeTest","CurrentSkillTestChanger","connect","skillTest","dispatch","incSkill","decSkill","incTest","decTest","Typography","variant","CurrentPassZone","ownProps","passZone","Grid","container","alignItems","item","xs","sm","md","direction","line","PassLine","textAlign","lineSeparator","liStyle","borderColor","spacing","toFixed","noWrap","index","useStyles","makeStyles","theme","createStyles","formControl","margin","minWidth","selectEmpty","marginTop","CurrentCharacterSelector","selectedCharacter","characters","selectedCampaign","setCharacter","changeCharacter","FormControl","Select","labelId","shortName","e","target","c","aChar","MenuItem","buildBagFromState","appState","selectedScenario","scenarioEffectSpec","gameContext","initContext","contextSpec","valuesSpec","vs","initialValue","CurrentScenarioContextManager","spec","paddingTop","Object","keys","contextKey","BagDisplay","showAverage","fadeOutTokens","bag","allTokensIndividually","allTokens","CurrentTokenBagManager","addToken","classes","useModalStyles","allKnown","Box","paper","BagSpecDisplay","position","left","top","width","opacity","backgroundColor","palette","background","border","boxShadow","shadows","padding","CurrentScenarioPassZone","scenario","open","setOpen","Modal","onClose","aria-labelledby","Button","AHCharacters","JoeDiamond","DianaStanley","LeoAnderson","normal","EnLasGarrasDelCaos","getPerdicionYBrecha","translations","potentialBag","description","AnteElTronoNegro","ceil","getHalfDoomInAzathot","buildElCirculoRotoCampaignSpec","scenarios","bagSpecsByLevel","easy","hard","expert","LaPerdicionDeEztli","fichas","buildLaEraOlvidadaCampaignSpec","min","Campaigns","TheCircleUndone","TheForgottenAge","campaignTranslations","values","allTrans","campaign","thisTranslations","lang","scenarioLang","valueSpecLang","Campaign","campaignSpec","currentBagSpec","currentScenario","this","startCampaign","scenarioNum","scenarioIndex","getScenarioSpec","level","defaultCampaign","start","addTokensToBagSpec","startAlvaroElCirculoRotoLPDP","firstScenario","initialContext","initialSkillTest","appReducers","combineReducers","action","nextScenario","prevScenario","tokenAction","scenarioSpec","contextAction","assign","contextToggleAction","skillTestAction","preloadCampaign","storageStateString","localStorage","getItem","JSON","parse","loadStorageStage","campaignSpecId","cId","currentCharacter","currentContext","startAlvaroLaEraOlvidada","currentScenarioSpec","initialState","store","createStore","saveLang","setItem","window","location","reload","subscribe","getState","newStorageCampaign","stringify","Flags","require","App","changeScenario","myLang","appLang","userLang","navigator","language","dashPosition","indexOf","substring","loadCurrentLang","i18","use","initReactI18next","init","resources","es","translation","lng","fallbackLng","I18n","themeSpec","baseFontFamily","uglyQuaFontFamily","responsiveFontSizes","createMuiTheme","typography","fontFamily","join","fontSize","tonalOffset","primary","main","secondary","headerFontFamily","headerFontFamilyNonAscii","tokTheme","campaignName","ThemeProvider","CssBaseline","aString","variantMapping","h1","float","GB","ES","Container","maxWidth","Boolean","hostname","match","ReactDOM","render","StrictMode","document","getElementById","serviceWorker","ready","then","registration","unregister","catch","error","console","message"],"mappings":"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","file":"static/js/main.ff908c0e.chunk.js","sourcesContent":["export function incDecNatural(previous: number, incDec: boolean) {\n    return incDec ? previous + 1 : Math.max(0, previous - 1);\n}\n\nexport function repeat(num: number, f: () => void) {\n    for (let i = 0; i < num; i++) {\n        f();\n    }\n}\n\nexport function repeatMap<T>(num: number, f: (index: number) => T): T[] {\n    const list = []\n    for (let i = 0; i < num; i++) {\n        list.push(f(i));\n    }\n    return list;\n}\n\nexport function nonAscii(aString: string) {\n    const ascii = /^[ -~]+$/;\n    return !ascii.test(aString);\n}\n\nexport interface Translation {\n    [k: string]: string\n}\n","import {AHCharacter} from \"./AHCharacter\";\nimport {incDecNatural} from \"../Utils\";\nimport * as uuid from \"uuid\";\n\nexport interface TokenSpec {\n    id: string;\n    value: number,\n    count: number,\n    name: string,\n    chaos: boolean\n}\nexport type EffectSpec = (tokenBag: TokenBag) => number;\n\nexport const elderSignEffect = (tokenBag: TokenBag) => tokenBag.character.elderSignEffect(tokenBag);\n\nexport interface Token extends TokenSpec {\n    effect: EffectSpec;\n}\n\nexport function tokenSpecDef(value: number, count: number, chaos = false, name?: string): TokenSpec {\n    const actualName = name ?? \"Token\" + value;\n    return {\n        value, count, chaos,\n        name: actualName,\n        id: actualName + \"_\" + uuid.v4()\n    }\n}\n\nfunction copyTokenSpec(tokenSpec: TokenSpec): TokenSpec {\n    return {\n        ...tokenSpec\n    }\n}\n\nfunction decCount(t: Token) {\n    return {...t, count: t.count - 1};\n}\n\nexport interface TokenBagSpec {\n    tokens: TokenSpec[];\n}\n\nfunction findName(tokenBagSpec: TokenBagSpec, name: string): TokenSpec | undefined {\n    return tokenBagSpec.tokens.find(t => t.name === name);\n}\n\nexport function removeToken(tokenBagSpec: TokenBagSpec, tokenName: string): TokenBagSpec {\n    const newBag = {\n        tokens: tokenBagSpec.tokens.map(ts => copyTokenSpec(ts))\n    }\n    const tokenSpecInBag = findName(newBag, tokenName);\n    if (tokenSpecInBag) {\n        tokenSpecInBag.count-=1;\n    }\n    newBag.tokens = newBag.tokens.filter(ts => ts.count > 0);\n    return newBag;\n}\n\nexport function addTokens(tokenBagSpec: TokenBagSpec, ...tokens: TokenSpec[]): TokenBagSpec {\n    const newBag = {\n        tokens: tokenBagSpec.tokens.map(ts => copyTokenSpec(ts))\n    }\n    tokens.forEach(tokenSpec => {\n        const tokenSpecInBag = findName(newBag, tokenSpec.name);\n        if (tokenSpecInBag) {\n            tokenSpecInBag.count += tokenSpec.count\n        } else {\n            newBag.tokens.push(tokenSpec);\n        }\n    })\n    return newBag;\n}\n\n\nexport function buildBagSpec(...tokens: TokenSpec[]): TokenBagSpec {\n    return {tokens}\n}\n\nexport function allTokenSpecs(bagSpec: TokenBagSpec): TokenSpec[] {\n    const allTokensIndividually: TokenSpec[] = [];\n    bagSpec.tokens.forEach( t => {\n        for(let i = 0; i < t.count; i++) allTokensIndividually.push({...t, count: 1});\n    })\n    return allTokensIndividually;\n}\n\nexport function allKnownTokens(): TokenBagSpec {\n    return buildBagSpec(\n        tokenSpecDef(2, 1, false, 'elderSign'),\n        tokenSpecDef(1, 1, false),\n        tokenSpecDef(0, 1, false),\n        tokenSpecDef(-1, 1, false),\n        tokenSpecDef(-2, 1, false),\n        tokenSpecDef(-3, 1, false),\n        tokenSpecDef(-4, 1, false),\n        tokenSpecDef(-5, 1, false),\n        tokenSpecDef(-6, 1, false),\n        // tokenSpecDef(-7, 1, false),\n        tokenSpecDef(-8, 1, false),\n        // tokenSpecDef(-9, 1, false),\n        tokenSpecDef(0, 1, true, 'Calavera'),\n        tokenSpecDef(0, 1, true, 'Sectario'),\n        tokenSpecDef(0, 1, true, 'Lápida'),\n        tokenSpecDef(0, 1, true, 'Antiguo'),\n        FALLO_AUTOMATICO\n    );\n}\n\nexport type ScenarioContext = { [key: string]: number|boolean };\nexport function incDecContextNatural(state: ScenarioContext, key: string, incDec: boolean) {\n    return incDecNatural(state[key] as number, incDec);\n}\nexport function incContextValue(context: ScenarioContext, key: string): ScenarioContext {\n    const newValue: number = ((context[key] as number) ?? 0) + 1;\n    const newContext = {\n        ...context,\n        [key]: newValue\n    }\n    return newContext;\n}\n\nexport function decContextValue(context: ScenarioContext, key: string): ScenarioContext {\n    let oldValue: number = (context[key] as number) ?? 0;\n    let newContext = context;\n    if (oldValue > 0) {\n        const newValue = oldValue - 1;\n        newContext = {\n            ...context,\n            [key]: newValue\n        }\n    }\n    return newContext;\n}\n\nexport function toggleContextValue(context: ScenarioContext, key: string): ScenarioContext {\n    const oldValue = context[key] as boolean;\n    return {\n        ...context,\n        [key]: !oldValue\n    };\n}\n\nexport interface TokenBag {\n    context: ScenarioContext;\n    character: AHCharacter;\n    tokens: Token[];\n}\n\nexport type ScenarioEffectSpecs = { name: string, effect: EffectSpec }[];\n\nexport function buildEffectSpecs(...effectSpecs: ScenarioEffectSpecs): Map<string, EffectSpec> {\n    const effectMap = new Map<string, EffectSpec>();\n    effectSpecs.forEach( ns => effectMap.set(ns.name, ns.effect));\n    return effectMap;\n}\n\nexport function buildBagFromSpec(bagSpec: TokenBagSpec, effects: Map<string, EffectSpec>, character: AHCharacter, context: ScenarioContext): TokenBag {\n    return {\n        character,\n        context,\n        tokens: bagSpec.tokens.map(tokenSpec => tokenDef(tokenSpec, effects.get(tokenSpec.name)))\n    }\n}\n\n\n\nexport function tokenDef(tokenSpec: TokenSpec, effect?: EffectSpec): Token {\n    return {\n        ...tokenSpec,\n        effect: effect ?? (() => tokenSpec.value),\n    }\n}\n\nconst FALLO_AUTOMATICO_VALUE = -99\n\nexport const FALLO_AUTOMATICO = tokenSpecDef(FALLO_AUTOMATICO_VALUE, 1, true, \"Fallo\");\n\nfunction sortTokens(tokenBag: TokenBag) {\n    return tokenBag.tokens.sort((a, b) => b.effect(tokenBag) - a.effect(tokenBag));\n}\n\nexport function tokenFloatAverage(tokenBag: TokenBag) {\n    const tokens = tokenBag.tokens;\n    let numOfTokens = 0;\n    const total = tokens.reduce<number>((sum, token) => {\n        if (token.effect(tokenBag) !== FALLO_AUTOMATICO_VALUE) {\n            numOfTokens += token.count;\n            return sum + (token.effect(tokenBag) * token.count)\n        } else {\n            return sum;\n        }\n    }, 0);\n    return total / numOfTokens;\n}\n\nexport function tokenAverage(tokenBag: TokenBag): number {\n    const floatAverage = tokenFloatAverage(tokenBag);\n    return Math.floor(floatAverage);\n}\n\ninterface ValueCount {\n    value: number;\n    count: number;\n}\n\nexport function tokensWithValue(tokenBag: TokenBag, value: number): Token[] {\n    const tokens = [];\n    const sorted = sortTokens(tokenBag);\n    let i = 0;\n    while (i < sorted.length && sorted[i].effect(tokenBag) >= value) {\n        if (sorted[i].effect(tokenBag) === value) {\n            for (let j=0; j < sorted[i].count; j++) {\n                tokens.push(sorted[i]);\n            }\n        }\n        i++;\n    }\n    return tokens;\n}\n\nexport function histogram(tokenBag: TokenBag) {\n    return sortTokens(tokenBag).reduce<ValueCount[]>((previousValues: ValueCount[], token: Token) => {\n        const last = previousValues.length >= 1 ? previousValues[previousValues.length - 1] : undefined;\n        if (last && last.value === token.effect(tokenBag)) {\n            last.count = last.count + token.count;\n        } else {\n            previousValues.push({value: token.effect(tokenBag), count: token.count});\n        }\n        return previousValues;\n    }, []);\n}\n\nexport function accumulated(tokenBag: TokenBag) {\n    return histogram(tokenBag).reduce<ValueCount[]>((prev, curr: ValueCount) => {\n        const prevValue = prev.length > 0 ? prev[prev.length - 1].count : 0;\n        return prev.concat({value: curr.value, count: curr.count + prevValue});\n    }, []);\n}\n\n\n\nexport function sealAll(tokenBag: TokenBag, tokenName: string): TokenBag {\n    const tokensFiltered: Token[] = tokenBag.tokens.map(t => {\n        return t.name !== tokenName ? t : null\n    }).filter(t => t !== null) as Token[];\n    return {\n        ...tokenBag,\n        tokens: tokensFiltered,\n    }\n}\n\nexport function seal(tokenBag: TokenBag, tokenName: string): TokenBag {\n    const tokensFiltered = tokenBag.tokens.map(t => {\n        return t.name !== tokenName ? t : decCount(t)\n    }).filter(t => t.count > 0)\n    return {\n        ...tokenBag,\n        tokens: tokensFiltered\n    }\n}\n\nexport function allTokens(bag: TokenBag): Token[] {\n    const allTokensIndividually: Token[] = [];\n    bag.tokens.forEach( t => {\n        for(let i = 0; i < t.count; i++) allTokensIndividually.push({...t, count: 1, id: t.id + \"_\" + i});\n    })\n    return allTokensIndividually;\n}\n\n\n// TokenBagPassZone\nexport interface WithTokenBag {\n    tokenBag: TokenBag;\n}\nexport interface ITokensInPassLine {\n    tokens: Token[];\n    prob: number;\n}\nexport type TokenBagPassZone = Map<number, ITokensInPassLine> & WithTokenBag;\nexport function tokenBagPassZone(tokenBag: TokenBag): TokenBagPassZone {\n    const accum = accumulated(tokenBag);\n    const map = new Map<number, ITokensInPassLine>() as TokenBagPassZone;\n    map.tokenBag = tokenBag;\n    const total = accum[accum.length - 1].count;\n    accum.forEach(vc => {\n        if (vc.value !== FALLO_AUTOMATICO_VALUE) {\n            const prob = 100 * vc.count / total;\n            const tokens = tokensWithValue(tokenBag, vc.value);\n            map.set(vc.value, {tokens, prob});\n        }\n    });\n    return map;\n}\n\nexport interface ISkillLine {\n    key: number;\n    tokens: Token[];\n    prob: number;\n    pass: boolean;\n    firstFail: boolean;\n    currentProb: boolean;\n}\n\nexport function passZoneLines(tokenBagMap: TokenBagPassZone, skill: number, test: number): ISkillLine[] {\n    const lines: ISkillLine[] = [];\n    let stillPass = true;\n    tokenBagMap.forEach((value, key) => {\n        const result = Math.max(skill+key, 0);\n        const pass = result >= test;\n        const nextPass = Math.max(result -1, 0) >= test;\n        const currentProb = pass && !nextPass;\n        const firstFail = !pass && stillPass;\n        stillPass = pass;\n        lines.push({\n            key,\n            tokens: value.tokens,\n            prob: value.prob,\n            pass,\n            firstFail,\n            currentProb\n        });\n    });\n    return lines;\n}\n\nexport function printSkillLine(tokenBagMap: TokenBagPassZone, skill: number, test: number): string {\n    let output = \"\";\n    output+=\"******************\\n\";\n    output+=`Skill: ${skill}, Test: ${test}\\n`;\n    output+=\"******************\\n\";\n    const lines = passZoneLines(tokenBagMap, skill, test);\n    lines.forEach(line => {\n        const keyFormat = line.key.toString().padStart(2, \" \");\n        if (line.firstFail) {\n            output+=\"------------------\\n\";\n        }\n        output+=`${keyFormat} => ${line.prob.toFixed(2)}% ${line.currentProb ? \"<----\":\"     \"}`;\n        output+=\"[\" + line.tokens.map(t => t.name).join(',') + \"]\\n\";\n    });\n    output+=\"******************\\n\";\n    return output;\n}\n\nexport function nnDec(nn: number): number {\n    return Math.max(nn -1 , 0);\n}\n\n\n","import {TokenSpec} from \"./Token\";\nimport React, {useState} from \"react\";\nimport {Fade} from \"@material-ui/core\";\n\nexport function TokenSpan(props: {token: TokenSpec, onClick?: (token: TokenSpec) => void, fadeOut?: boolean, fadeOutFadeIn?: boolean}){\n    const [fadeIn, setFadeIn] = useState(true);\n    const handler = () => {\n        if (props.onClick) {\n            if (props.fadeOut || props.fadeOutFadeIn) {\n                setFadeIn(false);\n            } else {\n                props.onClick(props.token);\n            }\n        }\n    };\n    const fadeExitedHandler = () => {\n        if (props.onClick) {\n            props.onClick(props.token);\n        }\n        // if (props.fadeOutFadeIn) {\n            setFadeIn(true);\n        // }\n    }\n    return (\n        <Fade in={fadeIn} onExited={fadeExitedHandler}>\n            <span style={{cursor: \"pointer\"}} className={\"Token \" + props.token.name} onClick={handler}>T</span>\n        </Fade>\n    )\n}","import React from \"react\";\nimport {IContextValueSpec} from \"./Scenario\";\nimport {IconButton, InputLabel, Switch} from \"@material-ui/core\";\nimport {useTranslation} from \"react-i18next\";\n\nexport function ContextValueChanger(props: {\n    currentValue: number | boolean, valueSpec: IContextValueSpec, incDecContextValue: (incDec: boolean) => void, toggleContextValue: () => void}) {\n    const valueSpec = props.valueSpec;\n    const { t } = useTranslation();\n    if (valueSpec.type === \"number\") {\n        return (\n            <NumericParamChanger inline={false} name={t(valueSpec.name)} currentValue={props.currentValue as number}\n                                 incValue={() => props.incDecContextValue(true)}\n                                 decValue={() => props.incDecContextValue(false)} />\n        )\n    } else {\n        return (\n            <BooleanParamChanger name={t(valueSpec.name)} currentValue={props.currentValue as boolean}\n                                 toggle={() => props.toggleContextValue()}/>\n        )\n    }\n}\n\ntype NumericParamChangerProps =\n    { inline: boolean, name: string, currentValue: number, incValue: () => void, decValue: () => void };\n\nexport function NumericParamChanger({inline, name, currentValue, incValue, decValue}: NumericParamChangerProps) {\n    const incDecStyle = {verticalAlign: \"middle\"};\n    return (\n        <div className=\"ParamChanger\">\n            {inline ? <span>{name}</span> : <InputLabel>{name}</InputLabel>}\n            <IconButton className=\"IconAction material-icons\" style={incDecStyle} onClick={_ => incValue()}>arrow_circle_up</IconButton>\n            {currentValue}\n            <IconButton className=\"IconAction material-icons\" style={incDecStyle} onClick={_ => decValue()}>arrow_circle_down</IconButton>\n        </div>\n    )\n}\n\ntype BooleanParamChangerProps = { name: string, currentValue: boolean, toggle: () => void };\n\nexport function BooleanParamChanger({name, currentValue, toggle}: BooleanParamChangerProps) {\n    return (\n        <div className=\"ParamChanger\">\n            <InputLabel>{name}:</InputLabel>\n            <Switch\n                checked={currentValue}\n                onChange={_ => toggle()}\n                color=\"primary\"\n                name=\"name\"\n                inputProps={{ 'aria-label': 'primary checkbox' }}\n            />\n        </div>\n    )\n}","import {Action} from \"redux\";\nimport {AHCharacter} from \"./tok/AHCharacter\";\nimport {IScenarioSpec} from \"./tok/Scenario\";\nimport {TokenSpec} from \"./tok/Token\";\n\nexport interface IAppAction extends Action {}\nexport interface ICampaignAction extends IAppAction {}\nexport interface IScenarioAction extends IAppAction { scenarioSpec: IScenarioSpec }\nexport interface ICharacterAction extends IAppAction { character: AHCharacter }\nexport interface IContextAction extends IAppAction { key: string }\nexport interface IIncDecAction extends IAppAction { incDec: boolean }\nexport interface ITokenAction extends IAppAction { tokenSpec: TokenSpec}\n\n// Campaign\nexport const NEXT_SCENARIO = 'NEXT_SCENARIO';\nexport const PREV_SCENARIO = 'PREV_SCENARIO';\n// Scenario\nexport const CHANGE_SCENARIO = 'CHANGE_SCENARIO';\n\n// Character\nexport const CHANGE_CHARACTER = 'CHANGE_CHARACTER';\n\n// Context\nexport const INC_DEC_CONTEXT_VALUE = 'INC_DEC_CONTEXT_VALUE';\nexport const TOGGLE_CONTEXT_VALUE = 'TOGGLE_CONTEXT_VALUE';\n\n// SkillTest\nexport const CHANGE_SKILL = 'CHANGE_SKILL';\nexport const CHANGE_TEST = 'CHANGE_TEST';\n\n//BagTokenSpec\nexport const ADD_TOKEN = 'ADD_TOKEN';\nexport const REMOVE_TOKEN = 'REMOVE_TOKEN';\n\nexport function advanceScenario(): ICampaignAction {\n    return {\n        type: NEXT_SCENARIO\n    }\n}\n\nexport function getBackScenario(): ICampaignAction {\n    return {\n        type: PREV_SCENARIO\n    }\n}\n\n// Scenario\nexport function changeScenario(scenarioSpec: IScenarioSpec): IScenarioAction {\n    return {\n        type: CHANGE_SCENARIO,\n        scenarioSpec\n    }\n}\n// Character\nexport function changeCharacter(character: AHCharacter): ICharacterAction {\n    return {\n        type: CHANGE_CHARACTER,\n        character\n    }\n}\n\n// Context\nexport function incDecContextValue(key: string, incDec: boolean): IContextAction & IIncDecAction {\n    return {\n        type: INC_DEC_CONTEXT_VALUE,\n        key, incDec\n    }\n}\n\nexport function toggleContextValue(key: string): IContextAction {\n    return {\n        type: TOGGLE_CONTEXT_VALUE,\n        key\n    }\n}\n\n// SkillTest\nexport function changeSkill(incDec: boolean): IIncDecAction {\n    return {\n        type: CHANGE_SKILL,\n        incDec\n    }\n}\nexport const decreaseSkill = () => changeSkill(false);\nexport const increaseSkill = () => changeSkill(true);\n\nexport function changeTest(incDec: boolean): IIncDecAction {\n    return {\n        type: CHANGE_TEST,\n        incDec\n    }\n}\nexport const decreaseTest = () => changeTest(false);\nexport const increaseTest = () => changeTest(true);\n\nexport function addToken(tokenSpec: TokenSpec): ITokenAction {\n    return {\n        type: ADD_TOKEN,\n        tokenSpec\n    }\n}\n\nexport function removeToken(tokenSpec: TokenSpec): ITokenAction {\n    return {\n        type: REMOVE_TOKEN,\n        tokenSpec\n    }\n}\n","import {Typography} from \"@material-ui/core\";\nimport {NumericParamChanger} from \"./ParamChanger\";\nimport React from \"react\";\nimport {connect} from \"react-redux\";\nimport {AppState} from \"../AppState\";\nimport {Dispatch} from \"redux\";\nimport {decreaseSkill, decreaseTest, increaseSkill, increaseTest} from \"../AppActions\";\nimport {useTranslation} from \"react-i18next\";\n\nconst mapStateToProps = (state: AppState) => {\n    return {\n        skill: state.skillTest.skill,\n        test: state.skillTest.test\n    }\n}\n\nconst mapDispatchToProps = (dispatch: Dispatch) => {\n    return {\n        incSkill: () => dispatch(increaseSkill()),\n        decSkill: () => dispatch(decreaseSkill()),\n        incTest: () => dispatch(increaseTest()),\n        decTest: () => dispatch(decreaseTest())\n    }\n}\n\nexport const CurrentSkillTestChanger = connect(mapStateToProps, mapDispatchToProps)(SkillTestChanger);\n\nfunction SkillTestChanger(props: {skill: number, test: number,\n                                  incSkill: () => void, decSkill: () => void,\n                                  incTest: () => void, decTest: () => void}) {\n    const {skill, test, incSkill, decSkill, incTest, decTest} = props;\n    const { t } = useTranslation();\n    return (\n        <Typography variant=\"h5\">\n            <NumericParamChanger inline={true} name={t('Skill')} currentValue={skill} incValue={incSkill} decValue={decSkill}/>\n            <NumericParamChanger inline={true} name={t('Test')} currentValue={test} incValue={incTest} decValue={decTest}/>\n        </Typography>\n    );\n}","import React from \"react\";\nimport {passZoneLines, ISkillLine, TokenBagPassZone, TokenBag, tokenBagPassZone} from \"./Token\";\nimport \"./Tok.css\"\nimport {TokenSpan} from \"./TokenSpan\";\nimport {Grid, Typography} from \"@material-ui/core\";\nimport {CurrentSkillTestChanger} from \"./SkillTestChanger\";\nimport {SkillTest} from \"./SkillTest\";\nimport {connect} from \"react-redux\";\nimport {AppState} from \"../AppState\";\nimport {useTranslation} from \"react-i18next\";\n\nfunction mapStateToProps(state: AppState, ownProps: {tokenBag: TokenBag}) {\n    return {\n        passZone: tokenBagPassZone(ownProps.tokenBag),\n        skillTest: state.skillTest\n    }\n}\n\nexport const CurrentPassZone = connect(mapStateToProps)(PassZone);\n\nexport function PassZone({passZone, skillTest}: {passZone: TokenBagPassZone, skillTest: SkillTest}) {\n    const { t } = useTranslation();\n    const lines = passZoneLines(passZone, skillTest.skill, skillTest.test);\n    return (\n        <Grid container className=\"PassZone\" alignItems={\"center\"}>\n            <Grid item xs={12} sm={7} md={6} >\n            <Typography variant=\"h4\">{t('Pass zone')}</Typography>\n            <hr />\n            <Grid container direction=\"column\">\n                {\n                    lines.map(line => (\n                        <Grid key={line.key} item>\n                            <PassLine line={line} />\n                        </Grid>\n                    ))\n                }\n            </Grid>\n            <hr />\n            </Grid>\n            <Grid item xs={12} sm={5} md={6} style={{textAlign: \"center\"}}>\n                <CurrentSkillTestChanger />\n            </Grid>\n        </Grid>\n    )\n}\n\nfunction PassLine(props: {line: ISkillLine}) {\n    const line = props.line;\n    const liStyle = {\n        color: line.pass ? \"green\" : \"red\",\n    }\n    let lineSeparator;\n    if (line.firstFail) {\n        lineSeparator = <hr className=\"PassSeparator Current\"/>;\n    } else {\n        lineSeparator = <hr className=\"PassSeparator\" style={{borderColor: \"transparent\"}}/>;\n    }\n    return (\n        <div>{lineSeparator}\n        <Grid container  direction=\"row\"  alignItems=\"flex-start\" spacing={1}>\n            <Grid item style={{...liStyle, textAlign: \"center\"}} xs={2} sm={1}>\n                <Typography variant=\"h5\" >{line.key}</Typography>\n            </Grid>\n            <Grid item style={liStyle} className=\"LineProb\" xs={2} sm={2}>\n                <Typography variant=\"body1\">{line.prob.toFixed(2)}%</Typography>\n            </Grid>\n            <Grid item style={{textAlign: \"left\"}} xs={8} sm={9}>\n                <Typography variant=\"h3\" noWrap={true}>\n                {line.tokens.map((token, index) => (\n                    <TokenSpan key={index} token={token} />\n                ))}\n                </Typography>\n            </Grid>\n        </Grid>\n        </div>\n    )\n}\n","import {createStyles, FormControl, InputLabel, makeStyles, MenuItem, Select, Theme} from \"@material-ui/core\";\nimport {AppState} from \"../AppState\";\nimport {Dispatch} from \"redux\";\nimport {AHCharacter} from \"./AHCharacter\";\nimport {changeCharacter} from \"../AppActions\";\nimport {connect} from \"react-redux\";\nimport React from \"react\";\nimport {useTranslation} from \"react-i18next\";\n\nconst useStyles = makeStyles((theme: Theme) =>\n    createStyles({\n        formControl: {\n            margin: theme.spacing(1),\n            minWidth: 120,\n        },\n        selectEmpty: {\n            marginTop: theme.spacing(2),\n        },\n    }),\n);\n\nconst mapStateToProps = (state: AppState) => ({character: state.selectedCharacter, characters: state.selectedCampaign.characters});\nconst mapDispatchToProps = (dispatch: Dispatch) => ({setCharacter: (character: AHCharacter) => dispatch(changeCharacter(character))});\nexport const CurrentCharacterSelector = connect(\n    mapStateToProps,\n    mapDispatchToProps)(CharacterSelector);\n\nexport function CharacterSelector(props: {character: AHCharacter, characters: AHCharacter[], setCharacter: (character: AHCharacter) => void}) {\n    const {character, characters, setCharacter} = props;\n    const { t } = useTranslation();\n    const findCharacterByShortName = (shortName: string): AHCharacter | undefined => {\n        return characters.find(c => c.shortName === shortName);\n    }\n\n    return <div>\n        <InputLabel>{t('Current character')}:</InputLabel>\n        <FormControl variant=\"standard\" className={useStyles().formControl}>\n            <Select\n                labelId=\"character-selector-label\"\n                id=\"character-selector\"\n                value={character.shortName}\n                onChange={e => setCharacter(findCharacterByShortName(e.target.value as string)!)}>\n                {characters.map(aChar => (\n                    <MenuItem key={aChar.shortName} value={aChar.shortName}>{aChar.shortName}</MenuItem>\n                ))}\n            </Select>\n        </FormControl>\n    </div>;\n}","import {Campaign} from \"./tok/Campaign\";\nimport {IScenarioSpec} from \"./tok/Scenario\";\nimport {buildBagFromSpec, buildEffectSpecs, ScenarioContext, TokenBagSpec} from \"./tok/Token\";\nimport {SkillTest} from \"./tok/SkillTest\";\nimport {AHCharacter} from \"./tok/AHCharacter\";\n\nexport interface AppState {\n    selectedCampaign: Campaign;\n    bagSpec: TokenBagSpec;\n    selectedScenario: IScenarioSpec;\n    selectedCharacter: AHCharacter;\n    gameContext: ScenarioContext;\n    skillTest: SkillTest;\n}\n\nexport function buildBagFromState(appState: AppState) {\n    return buildBagFromSpec(\n        appState.bagSpec,\n        buildEffectSpecs(...appState.selectedScenario.scenarioEffectSpec),\n        appState.selectedCharacter,\n        appState.gameContext\n    );\n}\n","import {ScenarioContext, ScenarioEffectSpecs} from \"./Token\";\nimport {Translation} from \"../Utils\";\n\nexport interface IScenarioSpec {\n    name: string;\n    scenarioEffectSpec: ScenarioEffectSpecs;\n    contextSpec: IScenarioContextSpec;\n    translations: Translation;\n}\n\nexport function initContext(contextSpec: IScenarioContextSpec): ScenarioContext {\n    const context: ScenarioContext = {};\n    contextSpec.valuesSpec.forEach( vs => context[vs.name] = vs.initialValue)\n    return context;\n}\n\nexport interface IScenarioContextSpec {\n    valuesSpec: IContextValueSpec[];\n}\n\nexport function findValueSpec(contextSpec: IScenarioContextSpec, key: string) {\n    return contextSpec.valuesSpec.find(vs => vs.name === key);\n}\n\nexport type IContextValueType = \"number\" | \"boolean\";\n\nexport interface IContextValueSpec {\n    name: string;\n    description: string;\n    initialValue: number | boolean;\n    type: IContextValueType;\n    translations: Translation;\n}\n","import {connect} from \"react-redux\";\nimport {AppState} from \"../AppState\";\nimport React, {Dispatch} from \"react\";\nimport {\n    IContextAction,\n    IIncDecAction,\n    incDecContextValue,\n    toggleContextValue\n} from \"../AppActions\";\nimport {findValueSpec, IScenarioContextSpec} from \"./Scenario\";\nimport {Typography} from \"@material-ui/core\";\nimport {ContextValueChanger} from \"./ParamChanger\";\nimport {ScenarioContext} from \"./Token\";\n\nexport const CurrentScenarioContextManager = connect(\n    (state: AppState) => ({spec: state.selectedScenario.contextSpec, context: state.gameContext}),\n    (dispatch: Dispatch<IContextAction | IContextAction & IIncDecAction>) => ({\n        incDecContextValue: (key: string, incDec: boolean) => dispatch(incDecContextValue(key, incDec)),\n        toggleContextValue: (key: string) => dispatch(toggleContextValue(key))\n    })\n)(ContextManager);\nfunction ContextManager({spec, context, incDecContextValue, toggleContextValue}:\n                               {spec: IScenarioContextSpec, context: ScenarioContext,\n                                incDecContextValue: (key: string, incDec: boolean) => void,\n                                toggleContextValue: (key: string) => void}) {\n    return <Typography variant=\"h5\" style={{paddingTop: \"2vmin\"}}>\n        {Object.keys(context).map(contextKey => (\n            <ContextValueChanger key={contextKey} currentValue={context[contextKey]}\n                                 valueSpec={(findValueSpec(spec, contextKey)!)}\n                                 incDecContextValue={(incDec: boolean) => incDecContextValue(contextKey, incDec)}\n                                 toggleContextValue={() => toggleContextValue(contextKey)}/>\n        ))}\n    </Typography>\n\n}","import {allKnownTokens, allTokens, TokenBag, TokenBagSpec, tokenFloatAverage, TokenSpec} from \"./Token\";\nimport {Box, createStyles, Theme, Typography} from \"@material-ui/core\";\nimport {TokenSpan} from \"./TokenSpan\";\nimport {makeStyles} from \"@material-ui/core/styles\";\nimport {AppState} from \"../AppState\";\nimport {Dispatch} from \"redux\";\nimport {addToken, ITokenAction, removeToken} from \"../AppActions\";\nimport {connect} from \"react-redux\";\nimport React from \"react\";\nimport {useTranslation} from \"react-i18next\";\n\nexport function BagDisplay({tokenBag, showAverage = true, onClick, fadeOutTokens = false}:\n                               {tokenBag: TokenBag, showAverage?: boolean, onClick?: (token: TokenSpec) => void, fadeOutTokens: boolean}) {\n    const { t } = useTranslation();\n    return <div className=\"BagDisplay\">\n        {showAverage ? (<Typography>{t('Bag average')}: {tokenFloatAverage(tokenBag)}</Typography>) : null }\n        <p className=\"TokenStrip\">\n            {allTokens(tokenBag).map((token, index) => (\n                <TokenSpan key={token.id} token={token} onClick={onClick} fadeOut={fadeOutTokens}/>\n            ))}\n        </p>\n    </div>\n}\n\nexport const CurrentTokenBagManager = connect(\n    (state: AppState, ownProps: { tokenBag: TokenBag }) => {\n        return {\n            tokenBag: ownProps.tokenBag\n        }\n    },\n    (dispatch: Dispatch<ITokenAction>) => {\n        return {\n            addToken: (token: TokenSpec) => dispatch(addToken(token)),\n            removeToken: (token: TokenSpec) => dispatch(removeToken(token)),\n        }\n    }\n)(TokenBagManager);\nfunction TokenBagManager({tokenBag, addToken, removeToken}: {tokenBag: TokenBag,\n    addToken: (token: TokenSpec) => void, removeToken: (token: TokenSpec) => void}) {\n    const classes = useModalStyles();\n    const { t }  = useTranslation();\n    const allKnown = allKnownTokens();\n    return (\n        <Box textAlign=\"center\" className={classes.paper}>\n            <Typography id=\"bag-management-title\" variant=\"h3\">{t('Chaos bag')}</Typography>\n            <Typography>{t('Current bag')}. {t('Select tokens to remove them')}</Typography>\n            <BagDisplay tokenBag={tokenBag} showAverage={false}\n                        onClick={(token: TokenSpec) => removeToken(token)} fadeOutTokens={true}/>\n            <Typography >{t('Select tokens to add them to the bag')}</Typography>\n            <BagSpecDisplay tokenBagSpec={allKnown} onClick={(token: TokenSpec) => addToken(token)}/>\n        </Box>\n    );\n}\n\nfunction BagSpecDisplay({tokenBagSpec, onClick}: {tokenBagSpec: TokenBagSpec, onClick?: (token: TokenSpec) => void}) {\n    return <div className=\"BagDisplay\">\n        <p className=\"TokenStrip\">\n            {tokenBagSpec.tokens.map((token, index) => (\n                <TokenSpan key={index} token={token} onClick={onClick} fadeOut={false} fadeOutFadeIn={true}/>\n            ))}\n        </p>\n    </div>\n}\n\nconst useModalStyles = makeStyles((theme: Theme) =>\n    createStyles({\n        paper: {\n            position: 'relative',\n            left: \"15%\",\n            top: \"40%\",\n            width: \"70%\",\n            opacity: 0.9,\n            backgroundColor: theme.palette.background.paper,\n            border: '2px solid #FFF',\n            boxShadow: theme.shadows[5],\n            padding: theme.spacing(2, 4, 3),\n        },\n    }),\n);\n\n\n\n","import React, {useState} from \"react\";\nimport {IScenarioSpec} from \"./Scenario\";\nimport {CurrentPassZone} from \"./PassZone\";\nimport {TokenBag} from \"./Token\";\nimport {Box, Button, Modal, Typography} from \"@material-ui/core\";\nimport {CurrentCharacterSelector} from \"./CharacterSelector\";\nimport {connect} from \"react-redux\";\nimport {AppState, buildBagFromState} from \"../AppState\";\nimport {CurrentScenarioContextManager} from \"./ContextManager\";\nimport {BagDisplay, CurrentTokenBagManager} from \"./TokenBag\";\nimport {useTranslation} from \"react-i18next\";\n\n\nconst mapStateToProps = (state: AppState) => ({tokenBag: buildBagFromState(state), scenario: state.selectedScenario});\n\nexport const CurrentScenarioPassZone = connect(mapStateToProps)(ScenarioPassZone);\n\nexport function ScenarioPassZone({tokenBag, scenario}: {tokenBag: TokenBag, scenario: IScenarioSpec}) {\n    const [open, setOpen] = useState<boolean>(false);\n    const { t } = useTranslation();\n    return (\n        <div className=\"Scenario\">\n            <div className=\"ScenarioInfo\">\n                <Typography variant=\"h3\">{t(scenario.name)}</Typography>\n                <CurrentScenarioContextManager />\n                <CurrentCharacterSelector />\n            </div>\n            <CurrentPassZone tokenBag={tokenBag}/>\n\n            <BagDisplay tokenBag={tokenBag} onClick={() => setOpen(true)} fadeOutTokens={false}/>\n            <Modal open={open} onClose={() => setOpen(false)} aria-labelledby=\"bag-management-title\">\n                <CurrentTokenBagManager tokenBag={tokenBag}/>\n            </Modal>\n            <Box textAlign={\"center\"}>\n                <Button color=\"secondary\" onClick={() => setOpen(true)}>{t('Manage chaos bag')}</Button>\n            </Box>\n        </div>\n    );\n}\n","import {EffectSpec} from \"./Token\";\n\nexport interface AHCharacter {\n    id: string,\n    name: string;\n    shortName: string;\n    elderSignEffect: EffectSpec;\n}\n\n\nexport const AHCharacters: {[key: string]: AHCharacter} = {\n    JoeDiamond: {id: \"JoeDiamond\", name: \"Joe Diamond\", shortName: \"Joe\", elderSignEffect: () => 1},\n    DianaStanley: {id: \"DianaStanley\", name: \"Diana Stanley\", shortName: \"Diana\", elderSignEffect: () => 2},\n    LeoAnderson: {id: \"LeoAnderson\", name: \"Leo Anderson\", shortName: \"Leo\", elderSignEffect: () => 2}\n}","import {\n    addTokens,\n    buildBagSpec,\n    FALLO_AUTOMATICO,\n    removeToken, seal,\n    tokenAverage, TokenBag,\n    TokenBagSpec,\n    tokenSpecDef\n} from \"./Token\";\nimport {AHLevel, Campaign, ICampaignSpec} from \"./Campaign\";\nimport {IScenarioSpec} from \"./Scenario\";\nimport {AHCharacter, AHCharacters} from \"./AHCharacter\";\n\n\nfunction easy(): TokenBagSpec {\n    return buildBagSpec(\n        tokenSpecDef(1, 1, false, \"elderSign\"),\n        tokenSpecDef(1, 2),\n        tokenSpecDef(0, 3),\n        tokenSpecDef(-1, 2),\n        tokenSpecDef(-2,1),\n        tokenSpecDef(-3, 1),\n        tokenSpecDef(0, 2, true, \"Calavera\"),\n        FALLO_AUTOMATICO\n    );\n}\nexport function normal(): TokenBagSpec {\n    return buildBagSpec(\n        tokenSpecDef(1, 1, false, \"elderSign\"),\n        tokenSpecDef(1, 1),\n        tokenSpecDef(0, 2),\n        tokenSpecDef(-1, 2),\n        tokenSpecDef(-2,2),\n        tokenSpecDef(-3, 1),\n        tokenSpecDef(-4, 1),\n        tokenSpecDef(0, 2, true, \"Calavera\"),\n        FALLO_AUTOMATICO\n        );\n}\nfunction hard (): TokenBagSpec {\n    return addTokens(\n            removeToken(normal(), \"1\"),\n            tokenSpecDef(-5, 1),\n    )\n}\n\nfunction expert (): TokenBagSpec {\n    return buildBagSpec(\n        tokenSpecDef(1, 1, false, \"elderSign\"),\n        tokenSpecDef(0, 1),\n        tokenSpecDef(-1, 2),\n        tokenSpecDef(-2,2),\n        tokenSpecDef(-3, 1),\n        tokenSpecDef(-4, 1),\n        tokenSpecDef(-6, 1),\n        tokenSpecDef(-8, 1),\n        tokenSpecDef(0, 2, true, \"Calavera\"),\n        FALLO_AUTOMATICO\n    );\n}\n\nfunction Prologo(): IScenarioSpec {\n    return {\n        name: \"Disappearance at the Twilight Estate\",\n        translations: {\n            \"es\": \"Desaparición en la finca del crepúsculo\",\n        },\n        scenarioEffectSpec: [\n            {name: \"elderSign\", effect: (tokenBag) => tokenBag.character.elderSignEffect(tokenBag)},\n            {name: \"Calavera\", effect: () => -3},\n        ],\n        contextSpec: {\n            valuesSpec: []\n        }\n    };\n}\n\nfunction LaHoraBruja(): IScenarioSpec {\n    return {\n        name: \"The Witching Hour\",\n        translations: {\n            \"es\": \"La hora bruja\"\n        },\n        scenarioEffectSpec: [\n            { name: \"elderSign\", effect: (tokenBag) => tokenBag.character.elderSignEffect(tokenBag) },\n            { name: \"Calavera\", effect: () => -1 },\n            { name: \"Lápida\", effect: () => -3 },\n            { name: \"Antiguo\", effect: () => -3 },\n        ],\n        contextSpec: {\n            valuesSpec: []\n        }\n    }\n}\n\nfunction ALasPuertasDeLaMuerte(): IScenarioSpec {\n    const HAUNTED_LOCATION = \"Haunted location\";\n    return {\n        name: \"At Death's Doorstep\",\n        translations: {\n            \"es\": \"A las puertas de la muerte\",\n        },\n        scenarioEffectSpec: [\n            { name: \"elderSign\", effect: (tokenBag) => tokenBag.character.elderSignEffect(tokenBag) },\n            { name: \"Calavera\", effect: (tokenBag) => tokenBag.context[HAUNTED_LOCATION] ? -3 : -1 },\n            { name: \"Lápida\", effect: () => -2 },\n            { name: \"Antiguo\", effect: () => -2 },\n        ],\n        contextSpec: {\n            valuesSpec: [{\n                name: HAUNTED_LOCATION,\n                description: \"Haunted location\",\n                type: \"boolean\",\n                initialValue: false,\n                translations: {\n                    \"es\": \"Lugar embrujado\"\n                }\n            }]\n        }\n    }\n}\n\nfunction ElNombreSecreto(): IScenarioSpec {\n    const EXTRADIMENSIONAL_LOCATION = \"Extradimensional location\";\n    return {\n        name: \"The Secret Name\",\n        translations: {\n            \"es\": \"El nombre secreto\",\n        },\n        scenarioEffectSpec: [\n            { name: \"elderSign\", effect: (tokenBag) => tokenBag.character.elderSignEffect(tokenBag) },\n            { name: \"Calavera\", effect: (tokenBag) => tokenBag.context[EXTRADIMENSIONAL_LOCATION] ? -3 : -1 },\n            { name: \"Sectario\", effect: tokenBag => tokenAverage(seal(tokenBag, \"Sectario\"))},\n            { name: \"Lápida\", effect: () => -2 },\n            { name: \"Antiguo\", effect: () => -3 },\n        ],\n        contextSpec: {\n            valuesSpec: [{\n                name: EXTRADIMENSIONAL_LOCATION,\n                description: \"Extradimensional location\",\n                type: \"boolean\",\n                initialValue: false,\n                translations: {\n                    \"es\": \"Lugar Extradimensional\"\n                }\n            }]\n        }\n    }\n}\n\nfunction LaPagaDelPecado(): IScenarioSpec {\n    const UNFINISHED_BUSINESS = \"Unfinished business\";\n    const FIGHTING_EVADING_HERETIC = \"Fighting/evading Heretic\";\n    return {\n        name: \"The Wages of Sin\",\n        translations: {\n            \"es\": \"La paga del pecado\",\n        },\n        scenarioEffectSpec: [\n            {name: \"elderSign\", effect: (tokenBag) => tokenBag.character.elderSignEffect(tokenBag)},\n            {name: \"Calavera\", effect: (tokenBag) => 0 - (tokenBag.context[UNFINISHED_BUSINESS] as number)},\n            {name: \"Sectario\", effect: (tokenBag) => tokenBag.context[FIGHTING_EVADING_HERETIC] ? -4 : -3 },\n            {name: \"Lápida\", effect: () => -3},\n            {name: \"Antiguo\", effect: () => -2},\n        ],\n        contextSpec: {\n            valuesSpec: [\n                {\n                    name: UNFINISHED_BUSINESS,\n                    description: \"Unfinished business\",\n                    type: \"number\",\n                    initialValue: 0,\n                    translations: {\n                        \"es\": \"Asuntos inconclusos\",\n                    }\n                },\n                {\n                    name: FIGHTING_EVADING_HERETIC,\n                    description: \"Fighting/evading Heretic\",\n                    type: \"boolean\",\n                    initialValue: false,\n                    translations: {\n                        \"es\": \"Atacando/Evitando Hereje\"\n                    }\n                }\n            ]\n        }\n    };\n}\n\nfunction PorElBienComun(): IScenarioSpec {\n    const MAXIMA_PERDICION = \"Max Doom\";\n    return {\n        name: \"For the Greater Good\",\n        translations: {\n            \"es\": \"Por el bien común\",\n        },\n        scenarioEffectSpec: [\n            {name: \"elderSign\", effect: (tokenBag) => tokenBag.character.elderSignEffect(tokenBag)},\n            {name: \"Calavera\", effect: (tokenBag) => 0 - (tokenBag.context[MAXIMA_PERDICION] as number)},\n            {name: \"Sectario\", effect: tokenBag => tokenAverage(seal(tokenBag, \"Sectario\")) - 2},\n            {name: \"Lápida\", effect: () => -3},\n            {name: \"Antiguo\", effect: () => -3},\n        ],\n        contextSpec: {\n            valuesSpec: [{\n                name: MAXIMA_PERDICION,\n                description: \"Highest number of doom on a Cultist\",\n                type: \"number\",\n                initialValue: 0,\n                translations: {\n                    \"es\": \"Máxima perdición\"\n                }\n            }]\n        }\n    };\n}\n\nfunction UnionYDesilusion(): IScenarioSpec {\n    const ACCION_CIRCULO = \"Circle action\";\n    return {\n        name: \"Union and Disillusion\",\n        translations: {\n            \"es\": \"Unión y desilusión\"\n        },\n        scenarioEffectSpec: [\n            {name: \"elderSign\", effect: (tokenBag) => tokenBag.character.elderSignEffect(tokenBag)},\n            {name: \"Calavera\", effect: (tokenBag) =>\n                    tokenBag.context[ACCION_CIRCULO] ? tokenAverage(seal(tokenBag, \"Calavera\")) - 2 : -2},\n            {name: \"Sectario\", effect: () => -3},\n            {name: \"Lápida\", effect: () => -3},\n            {name: \"Antiguo\", effect: () => -3},\n        ],\n        contextSpec: {\n            valuesSpec: [{\n                name: ACCION_CIRCULO,\n                description: \"This skill test is a circle action\",\n                type: \"boolean\",\n                initialValue: false,\n                translations: {\n                    \"es\": \"Acción círculo\"\n                }\n            }]\n        }\n    };\n}\n\nfunction EnLasGarrasDelCaos(): IScenarioSpec {\n    const PERDICION_Y_BRECHA = \"Doom and breaches on your location\";\n    const getPerdicionYBrecha = (tokenBag: TokenBag) => {\n        return tokenBag.context[PERDICION_Y_BRECHA] as number;\n    }\n\n    return {\n        name: \"In the Clutches of Chaos\",\n        translations: {\n          \"es\": \"En las garras del caos\",\n        },\n        scenarioEffectSpec: [\n            {name: \"elderSign\", effect: (tokenBag) => tokenBag.character.elderSignEffect(tokenBag)},\n            {name: \"Calavera\", effect: (tokenBag) => 0 - getPerdicionYBrecha(tokenBag)},\n            {name: \"Sectario\", effect: (tokenBag) => {\n                //Creates a new bag and a new context for this calculation\n                    const potentialBag = seal(tokenBag, \"Sectario\");\n                    potentialBag.context = {\n                        [PERDICION_Y_BRECHA]: Math.max(3, getPerdicionYBrecha(tokenBag) + 1),\n                    }\n                    return tokenAverage(potentialBag);\n                }},\n            {name: \"Lápida\", effect: () => -2},\n            {name: \"Antiguo\", effect: () => -3},\n        ],\n        contextSpec: {\n            valuesSpec: [{\n                name: PERDICION_Y_BRECHA,\n                description: \"Total amount of doom and breaches on your location\",\n                type: \"number\",\n                initialValue: 0,\n                translations: {\n                    \"es\": \"Perdición y brecha en tu lugar\"\n                }\n            }]\n        }\n    };\n}\n\nfunction AnteElTronoNegro(): IScenarioSpec {\n    const PERDICION_EN_AZATHOTH = \"Doom on Azathoth\";\n    const getHalfDoomInAzathot = (tokenBag: TokenBag) => {\n        return Math.ceil((tokenBag.context[PERDICION_EN_AZATHOTH] as number) / 2);\n    }\n\n    return {\n        name: \"Before the Black Throne\",\n        translations: {\n            \"es\": \"Ante el trono negro\"\n        },\n        scenarioEffectSpec: [\n            {name: \"elderSign\", effect: (tokenBag) => tokenBag.character.elderSignEffect(tokenBag)},\n            {name: \"Calavera\", effect: (tokenBag) => 0 - Math.max(2, getHalfDoomInAzathot(tokenBag))},\n            {name: \"Sectario\", effect: (tokenBag) => tokenAverage(seal(tokenBag, \"Sectario\"))},\n            {name: \"Lápida\", effect: () => -2},\n            {name: \"Antiguo\", effect: () => -4},\n        ],\n        contextSpec: {\n            valuesSpec: [{\n                name: PERDICION_EN_AZATHOTH,\n                description: PERDICION_EN_AZATHOTH,\n                type: \"number\",\n                initialValue: 0,\n                translations: {\n                    \"es\": \"Perdición en Azathoth\"\n                }\n            }]\n        }\n    };\n}\n\nexport function buildElCirculoRotoCampaignSpec(): ICampaignSpec {\n    return {\n        id: \"TheCircleUndone\",\n        name: \"The Circle Undone\",\n        scenarios: [\n            Prologo(),\n            LaHoraBruja(), ALasPuertasDeLaMuerte(), ElNombreSecreto(), LaPagaDelPecado(),\n            PorElBienComun(), UnionYDesilusion(), EnLasGarrasDelCaos(), AnteElTronoNegro()\n        ],\n        bagSpecsByLevel: {\n            easy: easy(),\n            normal: normal(),\n            hard: hard(),\n            expert: expert(),\n        },\n        translations: {\n            \"es\": \"El círculo roto\"\n        }\n    }\n}\n\nexport function startElCirculoRoto(characters: AHCharacter[], level: AHLevel) {\n    return Campaign.start(buildElCirculoRotoCampaignSpec(), characters, level);\n}\n\nexport function startAlvaroElCirculoRotoLPDP() {\n    const campaign = startElCirculoRoto([\n        AHCharacters[\"JoeDiamond\"], AHCharacters[\"DianaStanley\"],\n        // {name: \"Joe Diamond\", shortName: \"Joe\", elderSignEffect: () => 1},\n        // {name: \"Diana Stanley\", shortName: \"Diana\", elderSignEffect: () => 2},\n    ], \"normal\");\n    campaign.addTokensToBagSpec(\n        tokenSpecDef(0, 2, true, \"Lápida\"), // <- La hora bruja: Los inv han aceptado su destino\n        tokenSpecDef(0, 1, true, \"Sectario\"), // <- El precio del progreso, unirme a la logia\n        tokenSpecDef(0, 1, true, \"Calavera\"), // <- El nombre secreto, coger el Libro Negro\n        // tokenSpecDef(0, 1, true, \"Antiguo\"),\n        // tokenSpecDef(-5, 1, false),\n    );\n    campaign.startCampaign(0);\n    return campaign;\n}","import {\n    buildBagSpec,\n    elderSignEffect,\n    FALLO_AUTOMATICO,\n    seal,\n    tokenAverage,\n    TokenBag,\n    TokenBagSpec,\n    tokenSpecDef\n} from \"./Token\";\nimport {Campaign, ICampaignSpec} from \"./Campaign\";\nimport {IScenarioSpec} from \"./Scenario\";\nimport {AHCharacters} from \"./AHCharacter\";\n\nfunction easy(): TokenBagSpec {\n    return buildBagSpec(\n        tokenSpecDef(1, 1, false, \"elderSign\"),\n        tokenSpecDef(1, 2),\n        tokenSpecDef(0, 3),\n        tokenSpecDef(-1, 2),\n        tokenSpecDef(-2,1),\n        tokenSpecDef(-3, 1),\n        tokenSpecDef(0, 2, true, \"Calavera\"),\n        tokenSpecDef(0, 1, true, \"Antiguo\"),\n        FALLO_AUTOMATICO\n    );\n}\nexport function normal(): TokenBagSpec {\n    return buildBagSpec(\n        tokenSpecDef(1, 1, false, \"elderSign\"),\n        tokenSpecDef(1, 1),\n        tokenSpecDef(0, 3),\n        tokenSpecDef(-1, 1),\n        tokenSpecDef(-2,2),\n        tokenSpecDef(-3, 1),\n        tokenSpecDef(-5, 1),\n        tokenSpecDef(0, 2, true, \"Calavera\"),\n        tokenSpecDef(0, 1, true, \"Antiguo\"),\n        FALLO_AUTOMATICO\n    );\n}\nfunction hard (): TokenBagSpec {\n    return buildBagSpec(\n        tokenSpecDef(1, 1, false, \"elderSign\"),\n        tokenSpecDef(1, 1),\n        tokenSpecDef(0, 2),\n        tokenSpecDef(-1, 1),\n        tokenSpecDef(-2,2),\n        tokenSpecDef(-3, 2),\n        tokenSpecDef(-4, 1),\n        tokenSpecDef(-6, 1),\n        tokenSpecDef(0, 2, true, \"Calavera\"),\n        tokenSpecDef(0, 1, true, \"Antiguo\"),\n        FALLO_AUTOMATICO\n    );\n}\n\nfunction expert (): TokenBagSpec {\n    return buildBagSpec(\n        tokenSpecDef(1, 1, false, \"elderSign\"),\n        tokenSpecDef(0, 1),\n        tokenSpecDef(-1, 1),\n        tokenSpecDef(-2,2),\n        tokenSpecDef(-3, 2),\n        tokenSpecDef(-4, 2),\n        tokenSpecDef(-6, 1),\n        tokenSpecDef(-8, 1),\n        tokenSpecDef(0, 2, true, \"Calavera\"),\n        tokenSpecDef(0, 1, true, \"Antiguo\"),\n        FALLO_AUTOMATICO\n    );\n}\n\nfunction NaturalezaSalvaje(): IScenarioSpec {\n    const PUNTOS_DE_VENGANZA=\"Vengeance points\";\n    const LUGARES_EN_JUEGO=\"Locations in play\";\n    const CARTAS_EXPLORACION=\"Cards in exploration deck\";\n    const ENVENENADO=\"Poisoned\";\n\n    return {\n        name: \"The Untamed Wilds\",\n        translations: {\n            \"es\": \"Naturaleza Salvaje\"\n        },\n        scenarioEffectSpec: [\n            {name: \"elderSign\", effect: elderSignEffect},\n            {name: \"Calavera\", effect: (tokenBag) => 0 - (tokenBag.context[PUNTOS_DE_VENGANZA] as number)},\n            {name: \"Sectario\", effect: (tokenBag) => 0 - Math.min(5, tokenBag.context[LUGARES_EN_JUEGO] as number)},\n            {name: \"Lápida\", effect: (tokenBag) => 0 - Math.min(5, tokenBag.context[CARTAS_EXPLORACION] as number)},\n            {name: \"Antiguo\", effect: (tokenBag) => tokenBag.context[ENVENENADO] ? -99 : -2},\n        ],\n        contextSpec: {\n            valuesSpec: [{\n                name: PUNTOS_DE_VENGANZA,\n                description: \"Puntos de Venganza en la zona de victoria\",\n                type: \"number\",\n                initialValue: 0,\n                translations: {\n                    \"es\": \"Puntos de venganza\"\n                }\n            },{\n                name: LUGARES_EN_JUEGO,\n                description: \"Lugares en juego\",\n                type: \"number\",\n                initialValue: 1,\n                translations: {\n                    \"es\": \"Lugares en juego\"\n                }\n            },{\n                name: CARTAS_EXPLORACION,\n                description: \"Lugares en el mazo de exploración\",\n                type: \"number\",\n                initialValue: 0,\n                translations: {\n                    \"es\": \"Cartas en el mazo de exploración\"\n                }\n            },{\n                name: ENVENENADO,\n                description: \"Envenenado\",\n                type: \"boolean\",\n                initialValue: false,\n                translations: {\n                    \"es\": \"Envenenado\"\n                }\n            }]\n        }\n    };\n}\n\nfunction LaPerdicionDeEztli(): IScenarioSpec {\n    const FICHAS_PERDICION=\"Locations with doom\";\n    const PERDICION_EN_TU_LUGAR=\"Doom on your location\";\n    function fichas(tokenBag: TokenBag) {\n        return 0 - (tokenBag.context[FICHAS_PERDICION] as  number);\n    }\n    return {\n        name: \"The Doom of Eztli\",\n        translations: {\n            \"es\": \"La perdición de Eztli\",\n        },\n        scenarioEffectSpec: [\n            {name: \"elderSign\", effect: elderSignEffect},\n            {name: \"Calavera\", effect: (tokenBag) => tokenBag.context[PERDICION_EN_TU_LUGAR] ? -3 : -1},\n            {name: \"Sectario\", effect: (tokenBag) => fichas(tokenBag)},\n            {name: \"Lápida\", effect: (tokenBag) => fichas(tokenBag)},\n            {name: \"Antiguo\", effect: (tokenBag) => tokenAverage(seal(tokenBag, \"Antiguo\"))},\n        ],\n        contextSpec: {\n            valuesSpec: [{\n                name: FICHAS_PERDICION,\n                description: \"Number of locations with doom on them\",\n                type: \"number\",\n                initialValue: 0,\n                translations: {\n                    \"es\": \"Lugares con perdición\"\n                }\n            },{\n                name: PERDICION_EN_TU_LUGAR,\n                description: \"Doom on yout location\",\n                type: \"boolean\",\n                initialValue: false,\n                translations: {\n                    \"es\": \"Perdición en tu lugar\"\n                }\n            }]\n        }\n    };\n}\n\nfunction LosHilosDelDestino(): IScenarioSpec {\n    const MAYOR_PERDICION_EN_CULTISTA=\"Highest doom\";\n    return {\n        name: \"Threads of Fate\",\n        translations: {\n            \"es\": \"Los hilos del destino\"\n        },\n        scenarioEffectSpec: [\n            {name: \"elderSign\", effect: (tokenBag) => tokenBag.character.elderSignEffect(tokenBag)},\n            {name: \"Calavera\", effect: (tokenBag) => 0 - (tokenBag.context[MAYOR_PERDICION_EN_CULTISTA] as number)},\n            {name: \"Sectario\", effect: (tokenBag) => -2},\n            {name: \"Lápida\", effect: (tokenBag) => -2},\n            {name: \"Antiguo\", effect: (tokenBag) => -2},\n        ],\n        contextSpec: {\n            valuesSpec: [{\n                name: MAYOR_PERDICION_EN_CULTISTA,\n                description: \"Highest number of doom in a cultist\",\n                type: \"number\",\n                initialValue: 0,\n                translations: {\n                    \"es\": \"Mayor perdición en un cultista\"\n                }\n            }]\n        }\n    };\n}\n\nfunction ElLimiteDelOtroLado(): IScenarioSpec {\n    const LUGAR_ANTIGUO=\"Ancient location\";\n    return {\n        name: \"The Boundary Beyond\",\n        translations: {\n            \"es\": \"El límite del otro lado\"\n        },\n        scenarioEffectSpec: [\n            {name: \"elderSign\", effect: elderSignEffect},\n            {name: \"Calavera\", effect: (tokenBag) => (tokenBag.context[LUGAR_ANTIGUO] as boolean) ? -3 : -1},\n            {name: \"Sectario\", effect: (tokenBag) => tokenAverage(seal(tokenBag, \"Sectario\"))},\n            {name: \"Lápida\", effect: (tokenBag) => tokenAverage(seal(tokenBag, \"Lápida\"))},\n            {name: \"Antiguo\", effect: (tokenBag) => -4},\n        ],\n        contextSpec: {\n            valuesSpec: [{\n                name: LUGAR_ANTIGUO,\n                description: \"You are at an ancient location\",\n                type: \"boolean\",\n                initialValue: false,\n                translations: {\n                    \"es\": \"Lugar antiguo\"\n                }\n            }]\n        }\n    };\n}\n\nfunction ElCorazonDeLosAncianos(): IScenarioSpec {\n    const EN_UNA_CUEVA=\"Cave location\";\n    const ENVENENADO=\"Poisoned\";\n    return {\n        name: \"Heart of the Elders\",\n        translations: {\n            \"es\": \"El corazón de los ancianos\"\n        },\n        scenarioEffectSpec: [\n            {name: \"elderSign\", effect: elderSignEffect},\n            {name: \"Calavera\", effect: (tokenBag) => (tokenBag.context[EN_UNA_CUEVA] as boolean) ? -3 : -1},\n            {name: \"Sectario\", effect: (tokenBag) => -2},\n            {name: \"Lápida\", effect: (tokenBag) => (tokenBag.context[ENVENENADO] as boolean) ? -99 : -2},\n            {name: \"Antiguo\", effect: (tokenBag) => -3},\n        ],\n        contextSpec: {\n            valuesSpec: [{\n                name: EN_UNA_CUEVA,\n                description: \"You are at in a cave location\",\n                type: \"boolean\",\n                initialValue: false,\n                translations: {\n                    \"es\": \"Lugar cueva\"\n                }\n            },{\n                name: ENVENENADO,\n                description: \"You are poisoned\",\n                type: \"boolean\",\n                initialValue: false,\n                translations: {\n                    \"es\": \"Envenenado\"\n                }\n            }]\n        }\n    };\n}\n\nfunction LaCiudadDeLosArchivos(): IScenarioSpec {\n    const CARTAS_EN_LA_MANO=\"Cards in hand\";\n\n    return {\n        name: \"The City of Archives\",\n        translations: {\n            \"es\": \"La ciudad de los archivos\"\n        },\n        scenarioEffectSpec: [\n            {name: \"elderSign\", effect: elderSignEffect},\n            {name: \"Calavera\", effect: (tokenBag) => (tokenBag.context[CARTAS_EN_LA_MANO] as number) >= 5 ? -3 : -1},\n            {name: \"Sectario\", effect: (tokenBag) => -2},\n            {name: \"Lápida\", effect: (tokenBag) => -2},\n            {name: \"Antiguo\", effect: (tokenBag) => -3},\n        ],\n        contextSpec: {\n            valuesSpec: [{\n                name: CARTAS_EN_LA_MANO,\n                description: \"Cards in hand\",\n                type: \"number\",\n                initialValue: 0,\n                translations: {\n                    \"es\": \"Cartas en la mano\"\n                }\n            }]\n        }\n    };\n}\n\nfunction LasProfundidadesDeYoth(): IScenarioSpec {\n    const NIVEL_DE_PROFUNDIDAD=\"Depth level\";\n    const PUNTOS_DE_VENGANZA=\"Vengeance points\";\n    return {\n        name: \"The Depths of Yoth\",\n        translations: {\n            \"es\": \"Las profundidades de Yoth\"\n        },\n        scenarioEffectSpec: [\n            {name: \"elderSign\", effect: elderSignEffect},\n            {name: \"Calavera\", effect: (tokenBag) => 0 - (tokenBag.context[NIVEL_DE_PROFUNDIDAD] as number)},\n            {name: \"Sectario\", effect: (tokenBag) => tokenAverage(seal(tokenBag, \"Sectario\"))},\n            {name: \"Lápida\", effect: (tokenBag) => tokenAverage(seal(tokenBag, \"Lápida\"))},\n            {name: \"Antiguo\", effect: (tokenBag) => (tokenBag.context[PUNTOS_DE_VENGANZA] as number) >= 3 ? -99 : -2},\n        ],\n        contextSpec: {\n            valuesSpec: [{\n                name: NIVEL_DE_PROFUNDIDAD,\n                description: \"Current Depth level\",\n                type: \"number\",\n                initialValue: 0,\n                translations: {\n                    \"es\": \"Nivel de profundidad\"\n                }\n            },{\n                name: PUNTOS_DE_VENGANZA,\n                description: \"Vengeance points in the victory display\",\n                type: \"number\",\n                initialValue: 0,\n                translations: {\n                    \"es\": \"Puntos de venganza\"\n                }\n            }]\n        }\n    };\n}\n\nfunction EonesDestozados(): IScenarioSpec {\n    const RELIQUIA_DE_LAS_ERAS_EN_TU_LUGAR=\"Relic of ages at your location\";\n    const ENVENENADO=\"Poisoned\";\n    return {\n        name: \"Shattered Aeons\",\n        translations: {\n            \"es\": \"Eones destrozados\"\n        },\n        scenarioEffectSpec: [\n            {name: \"elderSign\", effect: elderSignEffect},\n            {name: \"Calavera\", effect: (tokenBag) => (tokenBag.context[RELIQUIA_DE_LAS_ERAS_EN_TU_LUGAR] as boolean) ? -4 : -2},\n            {name: \"Sectario\", effect: (tokenBag) => -2},\n            {name: \"Lápida\", effect: (tokenBag) => (tokenBag.context[ENVENENADO] as boolean) ? -99 : -2},\n            {name: \"Antiguo\", effect: (tokenBag) => -2},\n        ],\n        contextSpec: {\n            valuesSpec: [{\n                name: RELIQUIA_DE_LAS_ERAS_EN_TU_LUGAR,\n                description: \"Relic of ages at your location\",\n                type: \"boolean\",\n                initialValue: false,\n                translations: {\n                    \"es\": \"Reliquia de las eras en tu lugar\"\n                }\n            },{\n                name: ENVENENADO,\n                description: \"You are poisoned\",\n                type: \"boolean\",\n                initialValue: false,\n                translations: {\n                    \"es\": \"Envenenado\"\n                }\n            }]\n        }\n    };\n}\n\nexport function buildLaEraOlvidadaCampaignSpec(): ICampaignSpec {\n    return {\n        id: \"TheForgottenAge\",\n        name: \"The Forgotten Age\",\n        scenarios: [\n            NaturalezaSalvaje(),LaPerdicionDeEztli(), LosHilosDelDestino(), ElLimiteDelOtroLado(),\n            ElCorazonDeLosAncianos(), LaCiudadDeLosArchivos(), LasProfundidadesDeYoth(), EonesDestozados()\n        ],\n        bagSpecsByLevel: {\n            easy: easy(),\n            normal: normal(),\n            hard: hard(),\n            expert: expert(),\n        },\n        translations: {\n            \"es\": \"La Era Olvidada\",\n        }\n    }\n}\n\nexport function startAlvaroLaEraOlvidada() {\n    const campaign = Campaign.start(buildLaEraOlvidadaCampaignSpec(), [\n        AHCharacters[\"LeoAnderson\"], AHCharacters[\"DianaStanley\"],\n    ], \"normal\");\n    campaign.startCampaign(0);\n    return campaign;\n}\n","import {IScenarioSpec} from \"./Scenario\";\nimport {addTokens, TokenBagSpec, TokenSpec} from \"./Token\";\nimport {AHCharacter} from \"./AHCharacter\";\nimport {buildElCirculoRotoCampaignSpec} from \"./ElCirculoRoto\";\nimport {Translation} from \"../Utils\";\nimport {buildLaEraOlvidadaCampaignSpec} from \"./LaEraOlvidada\";\n\nexport type AHLevel = \"easy\" | \"normal\" | \"hard\" | \"expert\";\ntype IBagSpecByLevel = {\n    [key in AHLevel]: TokenBagSpec;\n};\n\nexport interface ICampaignSpec {\n    id: string;\n    name: string;\n    scenarios: IScenarioSpec[];\n    bagSpecsByLevel: IBagSpecByLevel;\n    translations: Translation;\n}\n\ninterface ICampaigns {\n    [key: string]: ICampaignSpec\n}\nexport const Campaigns: ICampaigns = {\n    TheCircleUndone: buildElCirculoRotoCampaignSpec(),\n    TheForgottenAge: buildLaEraOlvidadaCampaignSpec(),\n}\n\nexport const campaignTranslations = Object.values(Campaigns).reduce<any>((allTrans, campaign) => {\n    const thisTranslations = campaign.translations;\n    Object.keys(thisTranslations).forEach(lang => {\n        if (allTrans[lang] === undefined) {\n            allTrans[lang] = {}\n        }\n        allTrans[lang][campaign.name] = thisTranslations[lang];\n    });\n    campaign.scenarios.forEach(scenario =>  {\n        Object.keys(scenario.translations).forEach(scenarioLang => {\n            if (allTrans[scenarioLang] === undefined) {\n                allTrans[scenarioLang] = {}\n            }\n            allTrans[scenarioLang][scenario.name] = scenario.translations[scenarioLang]\n        });\n        scenario.contextSpec.valuesSpec.forEach(valueSpec => {\n            Object.keys(valueSpec.translations).forEach(valueSpecLang => {\n                if (allTrans[valueSpecLang] === undefined) {\n                    allTrans[valueSpecLang] = {}\n                }\n                allTrans[valueSpecLang][valueSpec.name] = valueSpec.translations[valueSpecLang];\n            });\n\n        })\n    });\n    return allTrans;\n}, {});\n\ninterface ICampaign {\n}\n\nexport class Campaign implements ICampaign {\n    public currentScenario = 0;\n\n    constructor(public name: string,\n                public campaignSpec: ICampaignSpec,\n                public characters: AHCharacter[],\n                public currentBagSpec: TokenBagSpec,\n                currentScenario = 0) {\n        this.startCampaign(currentScenario);\n    }\n\n    public static start(campaignSpec: ICampaignSpec, characters: AHCharacter[], level: AHLevel): Campaign {\n        return new Campaign(campaignSpec.name, campaignSpec, characters, campaignSpec.bagSpecsByLevel[level]);\n    }\n\n\n    startCampaign(scenarioNum = 0) {\n        this.currentScenario = scenarioNum;\n        let scenarioIndex = 0;\n        while (scenarioIndex <= scenarioNum) {\n            this.currentScenario = scenarioIndex;\n            scenarioIndex++;\n        }\n    }\n\n    getScenarioSpec() {\n        return this.campaignSpec.scenarios[this.currentScenario];\n    }\n\n    addTokensToBagSpec(...tokens: TokenSpec[]) {\n        this.currentBagSpec = addTokens(this.currentBagSpec, ...tokens);\n    }\n\n    nextScenario() {\n        if ((this.currentScenario + 1 ) < this.campaignSpec.scenarios.length) {\n            this.currentScenario++;\n            // console.log(\"Current scenario index\", this.currentScenario, \"name\", this.campaignSpec.scenarios[this.currentScenario].name);\n            if (this.currentScenario >= this.campaignSpec.scenarios.length) {\n                // TODO: Modify current bag spec depending on resolution or preparation of new scenario\n                // advanceScenario\n            }\n        }\n        return this.getScenarioSpec();\n    }\n\n    // Returns to the previous scenario with the bag as it was\n    prevScenario() {\n        if (this.currentScenario  > 0) {\n            this.currentScenario--;\n        }\n        return this.getScenarioSpec();\n    }\n}\n","import {CombinedState, combineReducers, Reducer} from \"redux\";\nimport {Campaign} from \"./tok/Campaign\";\nimport {initContext, IScenarioSpec} from \"./tok/Scenario\";\nimport {\n    addTokens,\n    incDecContextNatural,\n    removeToken,\n    ScenarioContext,\n    TokenBagSpec\n} from \"./tok/Token\";\nimport {startAlvaroElCirculoRotoLPDP} from \"./tok/ElCirculoRoto\";\nimport {\n    ADD_TOKEN,\n    CHANGE_CHARACTER,\n    CHANGE_SCENARIO,\n    CHANGE_SKILL,\n    CHANGE_TEST,\n    IAppAction,\n    ICharacterAction,\n    IContextAction,\n    IIncDecAction,\n    INC_DEC_CONTEXT_VALUE,\n    IScenarioAction, ITokenAction,\n    NEXT_SCENARIO,\n    PREV_SCENARIO, REMOVE_TOKEN,\n    TOGGLE_CONTEXT_VALUE\n} from \"./AppActions\";\nimport {AppState} from \"./AppState\";\nimport {SkillTest} from \"./tok/SkillTest\";\nimport {AHCharacter} from \"./tok/AHCharacter\";\nimport {incDecNatural} from \"./Utils\";\n\n\nconst defaultCampaign = startAlvaroElCirculoRotoLPDP();\n\nconst  selectedCampaign: Reducer<Campaign, IAppAction> = (state: Campaign = defaultCampaign, action: IAppAction) => {\n    switch (action.type) {\n        case NEXT_SCENARIO:\n            state.nextScenario();\n            return state;\n        case PREV_SCENARIO:\n            state.prevScenario();\n            return state;\n        default:\n            return state;\n    }\n}\n\n\nconst firstScenario = defaultCampaign.getScenarioSpec();\nconst selectedScenario: Reducer<IScenarioSpec, IAppAction> = (state = firstScenario, action: IAppAction) => {\n    switch (action.type) {\n        case CHANGE_SCENARIO:\n            return (action as IScenarioAction).scenarioSpec;\n        default:\n            return state;\n    }\n}\n\nconst selectedCharacter: Reducer<AHCharacter, IAppAction> = (state = defaultCampaign.characters[0], action: IAppAction) => {\n    switch (action.type) {\n        case CHANGE_CHARACTER:\n            return (action as ICharacterAction).character;\n        default:\n            return state;\n    }\n}\nconst initialContext = initContext(firstScenario.contextSpec);\nconst gameContext: Reducer<ScenarioContext, IAppAction> = (gameContext = initialContext, action: IAppAction) => {\n    switch (action.type) {\n        case CHANGE_SCENARIO:\n            return initContext((action as IScenarioAction).scenarioSpec.contextSpec);\n        case INC_DEC_CONTEXT_VALUE:\n            const contextAction = action as IContextAction & IIncDecAction;\n            const key = contextAction.key;\n            return Object.assign({}, gameContext, {\n                [key]: incDecContextNatural(gameContext, key, contextAction.incDec)\n            });\n        case TOGGLE_CONTEXT_VALUE:\n            const contextToggleAction = action as IContextAction;\n            return Object.assign({}, gameContext, {\n                [contextToggleAction.key]: !(gameContext[contextToggleAction.key] as boolean)\n            });\n        default:\n            return gameContext;\n    }\n}\n\nconst initialSkillTest = {skill: 4, test: 2} as SkillTest;\nconst skillTest: Reducer<SkillTest, IAppAction> = (state = initialSkillTest, action) => {\n    const skillTestAction = action as IIncDecAction;\n    switch (action.type) {\n        case CHANGE_SKILL:\n            return Object.assign({}, state, {\n                skill: incDecNatural(state.skill, skillTestAction.incDec)\n            });\n        case CHANGE_TEST:\n            return Object.assign({}, state, {\n                test: incDecNatural(state.test, skillTestAction.incDec)\n            });\n        default:\n            return state;\n\n    }\n}\n\nconst bagSpec: Reducer<TokenBagSpec, IAppAction> = (state = defaultCampaign.currentBagSpec, action) => {\n    const tokenAction = action as ITokenAction;\n    switch (action.type) {\n        case ADD_TOKEN:\n            return addTokens(state, tokenAction.tokenSpec);\n        case REMOVE_TOKEN:\n            return removeToken(state, tokenAction.tokenSpec.name);\n        default:\n            return state;\n    }\n}\n\nexport const appReducers: Reducer<CombinedState<AppState>, IAppAction>  = combineReducers<AppState, IAppAction>({\n    selectedCampaign,  bagSpec, selectedCharacter, selectedScenario, gameContext, skillTest\n});\n","import {createStore, Store} from \"redux\";\nimport {appReducers} from \"./AppReducers\";\nimport {IAppAction} from \"./AppActions\";\nimport {AppState} from \"./AppState\";\nimport {Campaign, Campaigns, ICampaignSpec} from \"./tok/Campaign\";\nimport {SkillTest} from \"./tok/SkillTest\";\nimport {ScenarioContext, TokenBagSpec} from \"./tok/Token\";\nimport {AHCharacters} from \"./tok/AHCharacter\";\nimport {initContext} from \"./tok/Scenario\";\nimport {startAlvaroLaEraOlvidada} from \"./tok/LaEraOlvidada\";\n\n\ninterface IStorageStage {\n    name: string;\n    campaignSpecId: string;\n    bagSpec: TokenBagSpec;\n    characters: string[];\n    currentScenario: number;\n    currentCharacter: string;\n    currentContext: ScenarioContext;\n}\nfunction loadStorageStage(): IStorageStage | undefined {\n    const storageStateString = localStorage.getItem(\"ahtok.kortsoft.net/state\");\n    return storageStateString ? JSON.parse(storageStateString) : undefined;\n}\n\n\nconst LANGUAGE_STORE_KEY = \"ahtok.kortsoft.net/lang\";\n\nexport function loadCurrentLang() {\n    const appLang = localStorage.getItem(LANGUAGE_STORE_KEY);\n    if (appLang === null) {\n        let userLang: string = navigator.language;\n        const dashPosition = userLang.indexOf(\"-\");\n        if (dashPosition > -1) {\n            userLang = userLang.substring(0, dashPosition);\n        }\n        return userLang;\n    }\n    return appLang;\n}\n\nfunction initialState():AppState {\n    function defaultCampaign() {\n        return startAlvaroLaEraOlvidada();\n    }\n    const preloadCampaign = loadStorageStage();\n    if (preloadCampaign) {\n        const campaignSpec: ICampaignSpec = Campaigns[preloadCampaign.campaignSpecId];\n        const characters = preloadCampaign.characters.map(cId => AHCharacters[cId]);\n        const campaign = new Campaign(\n            preloadCampaign.name, campaignSpec, characters,\n            preloadCampaign.bagSpec, preloadCampaign.currentScenario);\n        const character = AHCharacters[preloadCampaign.currentCharacter];\n        return {\n            selectedCampaign: campaign,\n            selectedScenario: campaign.getScenarioSpec(),\n            selectedCharacter: character,\n            skillTest: {skill: 4, test: 2} as SkillTest,\n            gameContext: preloadCampaign.currentContext,\n            bagSpec: preloadCampaign.bagSpec\n        }\n    } else {\n        const campaign = defaultCampaign();\n        const currentScenarioSpec = campaign.getScenarioSpec();\n        return {\n            selectedCampaign: campaign,\n            selectedScenario: currentScenarioSpec,\n            selectedCharacter: campaign.characters[0],\n            skillTest: {skill: 4, test: 2} as SkillTest,\n            gameContext: initContext(currentScenarioSpec.contextSpec),\n            bagSpec: campaign.currentBagSpec,\n        };\n    }\n\n}\n\nconst appState = initialState();\nexport let store: Store<AppState, IAppAction> =\n    createStore<AppState, IAppAction, {}, {}>(appReducers, appState);\n\nexport function resetStore() {\n    store = createStore<AppState, IAppAction, {}, {}>(appReducers);\n}\n\nexport function saveLang(lang: string) {\n    localStorage.setItem(LANGUAGE_STORE_KEY, lang);\n    window.location.reload();\n}\n\nstore.subscribe(() => {\n    const campaign = store.getState().selectedCampaign;\n    const newStorageCampaign: IStorageStage = {\n        name: campaign.name,\n        campaignSpecId: campaign.campaignSpec.id,\n        bagSpec: store.getState().bagSpec,\n        characters: campaign.characters.map(c => c.id),\n        currentScenario: campaign.currentScenario,\n        currentCharacter: store.getState().selectedCharacter.id,\n        currentContext: store.getState().gameContext\n    };\n    localStorage.setItem(\"ahtok.kortsoft.net/state\", JSON.stringify(newStorageCampaign));\n});","import React from 'react';\nimport './App.css';\nimport {CurrentScenarioPassZone} from \"./tok/ScenarioPassZone\";\nimport {Box, Button, Container, CssBaseline, Typography} from \"@material-ui/core\";\nimport {ThemeProvider} from \"@material-ui/core/styles\";\nimport {tokTheme} from \"./TokTheme\";\nimport {connect} from \"react-redux\";\nimport {changeScenario as changeScenarioAction} from \"./AppActions\";\nimport {IScenarioSpec} from \"./tok/Scenario\";\nimport {nonAscii} from \"./Utils\";\nimport {useTranslation} from \"react-i18next\";\nimport I18n from \"./I18n\";\nimport {AppState} from \"./AppState\";\nimport {Campaign} from \"./tok/Campaign\";\nimport {loadCurrentLang, saveLang} from \"./AppStore\";\nconst Flags = require('country-flag-icons/react/3x2');\n\nconst App = connect(\n    (store: AppState) => ({\n        campaign: store.selectedCampaign\n}),\n    (dispatch => ({\n        changeScenario: (scenario:IScenarioSpec) => dispatch(changeScenarioAction(scenario)),\n    }))\n)(AppComponent);\n\nfunction AppComponent(props: {campaign: Campaign,\n                        changeScenario: (scenario: IScenarioSpec) => void}) {\n    const myLang = loadCurrentLang();\n    I18n(myLang);\n    const { t } = useTranslation();\n    const themeSpec = tokTheme();\n    const campaign = props.campaign;\n    const campaignName = t(campaign.name);\n    return (\n    <ThemeProvider theme={themeSpec.theme}>\n\n        <CssBaseline>\n            <div className=\"App\">\n                <Typography style={{fontFamily: nonAscii(campaignName) ? themeSpec.headerFontFamilyNonAscii : themeSpec.headerFontFamily, textAlign: \"center\"}}\n                            variant=\"h2\" color=\"secondary\" variantMapping={{h1: \"header\"}} className=\"App-header\">\n                    <Box style={{float: \"right\"}}>\n                        <Flags.GB className={\"IconAction\"} onClick={() => saveLang('en')} style={{width: \"0.5em\", opacity: myLang === \"en\" ? \"1.0\" : \"0.4\"}}/>\n                        <Flags.ES className={\"IconAction\"} onClick={() => saveLang('es')} style={{width: \"0.5em\", opacity: myLang === \"es\" ? \"1.0\" : \"0.4\"}}/>\n                    </Box>\n                    {campaignName}\n                </Typography>\n                <Container className=\"MainContainer\" maxWidth=\"lg\">\n                    <Box textAlign={\"center\"}>\n                        <Button color=\"secondary\" onClick={() => props.changeScenario(campaign.prevScenario())}>{t('prev')}</Button>\n                        <Button color=\"secondary\" onClick={() => props.changeScenario(campaign.nextScenario())}>{t('next')}</Button>\n                    </Box>\n                    <CurrentScenarioPassZone />\n                </Container>\n            </div>\n        </CssBaseline>\n    </ThemeProvider>\n  );\n}\n\nexport default App;\n","import i18 from \"i18next\";\nimport {initReactI18next} from \"react-i18next\";\nimport {campaignTranslations} from \"./tok/Campaign\";\n\nexport default function (lang = \"es\") {\n    i18.use(initReactI18next)\n        .init({\n            resources: {\n                es: {\n                    translation: {\n                        ...campaignTranslations[\"es\"],\n                        \"prev\": \"prev.\",\n                        \"next\": \"sig.\",\n                        \"Pass zone\": \"Zona de éxito\",\n                        \"Skill\": \"Habilidad\",\n                        \"Test\": \"Dificultad\",\n                        \"Bag average\": \"Valor medio\",\n                        \"Current character\": \"Personaje actual\",\n                        \"Manage chaos bag\": \"Gestionar bolsa del caos\",\n                        \"Chaos bag\": \"Bolsa del caos\",\n                        \"Current bag\": \"Bolsa actual\",\n                        \"Select tokens to remove them\": \"Selecciona tokens para eliminarlos\",\n                        \"Select tokens to add them to the bag\": \"Selecciona tokens para añadirlos a la bolsa\",\n                    }\n                },\n            },\n            lng: lang,\n            fallbackLng: \"en\"\n        })\n}","import {createMuiTheme, responsiveFontSizes} from \"@material-ui/core\";\n\nexport function tokTheme() {\n    const baseFontFamily = [\n        '-apple-system',\n        'BlinkMacSystemFont',\n        '\"Segoe UI\"',\n        'Roboto',\n        '\"Helvetica Neue\"',\n        'Arial',\n        'sans-serif',\n        '\"Apple Color Emoji\"',\n        '\"Segoe UI Emoji\"',\n        '\"Segoe UI Symbol\"',\n    ];\n    const birminghamFontFamily = \"Birmingham\";\n    const uglyQuaFontFamily = 'UglyQua';\n    const theme = responsiveFontSizes(createMuiTheme({\n        typography: {\n            fontFamily: [uglyQuaFontFamily].concat(baseFontFamily).join(','),\n            fontSize: 14\n        },\n        palette: {\n            tonalOffset: 1,\n            type: \"dark\",\n            primary: {\n                main: \"#205b57\",\n            },\n            secondary: {\n                main: \"#f4ebcc\",\n            }\n        }\n    }));\n\n    const headerFontFamily = [birminghamFontFamily].concat(baseFontFamily).join(',');\n    const headerFontFamilyNonAscii = [uglyQuaFontFamily].concat(baseFontFamily).join(',');\n    return {\n        theme,\n        headerFontFamily,\n        headerFontFamilyNonAscii\n    };\n}","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\ntype Config = {\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\n};\n\nexport function register(config?: Config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(\n      process.env.PUBLIC_URL,\n      window.location.href\n    );\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl: string, config?: Config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' }\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready\n      .then(registration => {\n        registration.unregister();\n      })\n      .catch(error => {\n        console.error(error.message);\n      });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport * as serviceWorker from './serviceWorker';\nimport {store} from \"./AppStore\";\nimport {Provider} from \"react-redux\";\n\nReactDOM.render(\n  <React.StrictMode>\n      <Provider store={store}>\n        <App />\n      </Provider>\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}