(this.webpackJsonpahtok=this.webpackJsonpahtok||[]).push([[0],{65:function(e,n,t){e.exports=t(78)},70:function(e,n,t){},71:function(e,n,t){},72:function(e,n,t){},78:function(e,n,t){"use strict";t.r(n);var a=t(0),r=t.n(a),c=t(8),i=t.n(c),o=(t(70),t(71),t(13)),u=t(15);function l(e,n){return n?e+1:Math.max(0,e-1)}function s(e,n){var t=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=arguments.length>3?arguments[3]:void 0;return{value:e,count:n,chaos:t,name:null!==a&&void 0!==a?a:"Token"+e}}function f(e){return Object(o.a)({},e)}function m(e,n){return e.tokens.find((function(e){return e.name===n}))}function p(e){for(var n={tokens:e.tokens.map((function(e){return f(e)}))},t=arguments.length,a=new Array(t>1?t-1:0),r=1;r<t;r++)a[r-1]=arguments[r];return a.forEach((function(e){var t=m(n,e.name);t?t.count+=e.count:n.tokens.push(e)})),n}function d(){for(var e=arguments.length,n=new Array(e),t=0;t<e;t++)n[t]=arguments[t];return{tokens:n}}function g(e,n,t){return l(e[n],t)}function v(){for(var e=new Map,n=arguments.length,t=new Array(n),a=0;a<n;a++)t[a]=arguments[a];return t.forEach((function(n){return e.set(n.name,n.effect)})),e}function h(e,n,t,a){return{character:t,context:a,tokens:e.tokens.map((function(e){return function(e,n){return Object(o.a)({},e,{effect:null!==n&&void 0!==n?n:function(){return e.value}})}(e,n.get(e.name))}))}}var S=s(-99,1,!0,"Fallo");function E(e){return e.tokens.sort((function(n,t){return t.effect(e)-n.effect(e)}))}function k(e){var n=e.tokens,t=0;return n.reduce((function(n,a){return-99!==a.value?(t+=a.count,n+a.effect(e)*a.count):n}),0)/t}function C(e){var n=k(e);return Math.floor(n)}function y(e){return function(e){return E(e).reduce((function(n,t){var a=n.length>=1?n[n.length-1]:void 0;return a&&a.value===t.effect(e)?a.count=a.count+t.count:n.push({value:t.effect(e),count:t.count}),n}),[])}(e).reduce((function(e,n){var t=e.length>0?e[e.length-1].count:0;return e.concat({value:n.value,count:n.count+t})}),[])}function b(e,n){var t=e.tokens.map((function(e){return e.name!==n?e:function(e){return Object(o.a)({},e,{count:e.count-1})}(e)})).filter((function(e){return e.count>0}));return Object(o.a)({},e,{tokens:t})}function x(e){var n=y(e),t=new Map;t.tokenBag=e;var a=n[n.length-1].count;return n.forEach((function(n){if(-99!==n.value){var r=100*n.count/a,c=function(e,n){for(var t=[],a=E(e),r=0;r<a.length&&a[r].effect(e)>=n;){if(a[r].effect(e)===n)for(var c=0;c<a[r].count;c++)t.push(a[r]);r++}return t}(e,n.value);t.set(n.value,{tokens:c,prob:r})}})),t}function A(e,n,t){var a=[],r=!0;return e.forEach((function(e,c){var i=Math.max(n+c,0),o=i>=t,u=Math.max(i-1,0)>=t,l=o&&!u,s=!o&&r;r=o,a.push({key:c,tokens:e.tokens,prob:e.prob,pass:o,firstFail:s,currentProb:l})})),a}t(72);function N(e){return r.a.createElement("span",{className:"Token "+e.token.name},"T")}var O=t(110),T=t(109),j=t(121),V=t(108),L=t(122);function w(e){var n=e.valueSpec;return"number"===n.type?r.a.createElement(_,{inline:!1,name:n.description,currentValue:e.currentValue,incValue:function(){return e.incDecContextValue(!0)},decValue:function(){return e.incDecContextValue(!1)}}):r.a.createElement(D,{name:n.description,currentValue:e.currentValue,toggle:function(){return e.toggleContextValue()}})}function _(e){var n=e.inline,t=e.name,a=e.currentValue,c=e.incValue,i=e.decValue,o={verticalAlign:"middle"};return r.a.createElement("div",{className:"ParamChanger"},n?r.a.createElement("span",null,t):r.a.createElement(j.a,null,t),r.a.createElement(V.a,{className:"IconAction material-icons",style:o,onClick:function(e){return c()}},"arrow_circle_up"),a,r.a.createElement(V.a,{className:"IconAction material-icons",style:o,onClick:function(e){return i()}},"arrow_circle_down"))}function D(e){var n=e.name,t=e.currentValue,a=e.toggle;return r.a.createElement("div",{className:"ParamChanger"},r.a.createElement(j.a,null,n,":"),r.a.createElement(L.a,{checked:t,onChange:function(e){return a()},color:"primary",name:"name",inputProps:{"aria-label":"primary checkbox"}}))}var I=t(14);function B(e){return{type:"CHANGE_SKILL",incDec:e}}function P(e){return{type:"CHANGE_TEST",incDec:e}}var M=Object(I.b)((function(e){return{skill:e.skillTest.skill,test:e.skillTest.test}}),(function(e){return{incSkill:function(){return e(B(!0))},decSkill:function(){return e(B(!1))},incTest:function(){return e(P(!0))},decTest:function(){return e(P(!1))}}}))((function(e){var n=e.skill,t=e.test,a=e.incSkill,c=e.decSkill,i=e.incTest,o=e.decTest;return r.a.createElement(T.a,{variant:"h5"},r.a.createElement(_,{inline:!0,name:"Skill",currentValue:n,incValue:a,decValue:c}),r.a.createElement(_,{inline:!0,name:"Test",currentValue:t,incValue:i,decValue:o}))}));var H=Object(I.b)((function(e,n){return{passZone:x(n.tokenBag),skillTest:e.skillTest}}))((function(e){var n=e.passZone,t=e.skillTest,a=A(n,t.skill,t.test);return r.a.createElement(O.a,{container:!0,className:"PassZone",alignItems:"center"},r.a.createElement(O.a,{item:!0,xs:12,sm:8,md:6},r.a.createElement(T.a,{variant:"h4"},"Pass zone"),r.a.createElement("hr",null),r.a.createElement(O.a,{container:!0,direction:"column"},a.map((function(e){return r.a.createElement(O.a,{key:e.key,item:!0},r.a.createElement(G,{line:e}))}))),r.a.createElement("hr",null)),r.a.createElement(O.a,{item:!0,xs:12,sm:4,md:6,style:{textAlign:"center"}},r.a.createElement(M,null)))}));function G(e){var n,t=e.line,a={color:t.pass?"green":"red"};return n=t.firstFail?r.a.createElement("hr",{className:"PassSeparator Current"}):r.a.createElement("hr",{className:"PassSeparator",style:{borderColor:"transparent"}}),r.a.createElement("div",null,n,r.a.createElement(O.a,{container:!0,direction:"row",alignItems:"flex-start",spacing:1},r.a.createElement(O.a,{item:!0,style:Object(o.a)({},a,{textAlign:"center"}),xs:2,sm:1},r.a.createElement(T.a,{variant:"h5"},t.key)),r.a.createElement(O.a,{item:!0,style:a,className:"LineProb",xs:2,sm:2},r.a.createElement(T.a,{variant:"body1"},t.prob.toFixed(2),"%")),r.a.createElement(O.a,{item:!0,style:{textAlign:"left"},xs:8,sm:9},r.a.createElement(T.a,{variant:"h3",noWrap:!0},t.tokens.map((function(e,n){return r.a.createElement(N,{key:n,token:e})}))))))}var F=t(111),R=t(124),U=t(112),J=t(117),z=t(123),W=Object(F.a)((function(e){return Object(R.a)({formControl:{margin:e.spacing(1),minWidth:120},selectEmpty:{marginTop:e.spacing(2)}})})),X=Object(I.b)((function(e){return{character:e.selectedCharacter,characters:e.selectedCampaign.characters}}),(function(e){return{setCharacter:function(n){return e(function(e){return{type:"CHANGE_CHARACTER",character:e}}(n))}}}))((function(e){var n=e.character,t=e.characters,a=e.setCharacter;return r.a.createElement("div",null,r.a.createElement(j.a,null,"Personaje actual:"),r.a.createElement(U.a,{variant:"standard",className:W().formControl},r.a.createElement(J.a,{labelId:"character-selector-label",id:"character-selector",value:n.shortName,onChange:function(e){return a((n=e.target.value,t.find((function(e){return e.shortName===n}))));var n}},t.map((function(e){return r.a.createElement(z.a,{key:e.shortName,value:e.shortName},e.shortName)})))))}));var Z=t(57);function K(e){return h(e.selectedCampaign.currentBagSpec,v.apply(void 0,Object(Z.a)(e.selectedScenario.scenarioEffectSpec)),e.selectedCharacter,e.gameContext)}function Q(e){var n={};return e.valuesSpec.forEach((function(e){return n[e.name]=e.initialValue})),n}var $=Object(I.b)((function(e){return{spec:e.selectedScenario.contextSpec,context:e.gameContext}}),(function(e){return{incDecContextValue:function(n,t){return e(function(e,n){return{type:"INC_DEC_CONTEXT_VALUE",key:e,incDec:n}}(n,t))},toggleContextValue:function(n){return e(function(e){return{type:"TOGGLE_CONTEXT_VALUE",key:e}}(n))}}}))((function(e){var n=e.spec,t=e.context,a=e.incDecContextValue,c=e.toggleContextValue;return r.a.createElement(T.a,{variant:"h5",style:{paddingTop:"2vmin"}},Object.keys(t).map((function(e){return r.a.createElement(w,{key:e,currentValue:t[e],valueSpec:(i=n,o=e,i.valuesSpec.find((function(e){return e.name===o}))),incDecContextValue:function(n){return a(e,n)},toggleContextValue:function(){return c(e)}});var i,o})))}));var q=Object(I.b)((function(e){return{tokenBag:K(e),scenario:e.selectedScenario}}))((function(e){var n=e.tokenBag,t=e.scenario;return r.a.createElement("div",{className:"Scenario"},r.a.createElement("div",{className:"ScenarioInfo"},r.a.createElement(T.a,{variant:"h3"},t.name),r.a.createElement($,null),r.a.createElement(X,null)),r.a.createElement(H,{tokenBag:n}),r.a.createElement(Y,{tokenBag:n}))}));function Y(e){var n=e.tokenBag;return r.a.createElement("div",{className:"BagDisplay"},r.a.createElement(T.a,null,"Bag average: ",k(n)),r.a.createElement("p",{className:"TokenStrip"},function(e){var n=[];return e.tokens.forEach((function(e){for(var t=0;t<e.count;t++)n.push(Object(o.a)({},e,{count:1}))})),n}(n).map((function(e,n){return r.a.createElement(N,{key:n,token:e})}))))}var ee=t(114),ne=t(115),te=t(118),ae=t(116),re=t(113),ce=t(120),ie=t(56);var oe=t(29),ue=t(54),le=t(55),se={TheCircleUndone:he()},fe=function(){function e(n,t,a,r){var c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;Object(ue.a)(this,e),this.name=n,this.campaignSpec=t,this.characters=a,this.currentBagSpec=r,this.currentScenario=0,this.startCampaign(c)}return Object(le.a)(e,[{key:"startCampaign",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.currentScenario=e;for(var n=0;n<=e;)this.currentScenario=n,n++}},{key:"getScenarioSpec",value:function(){return this.campaignSpec.scenarios[this.currentScenario]}},{key:"addTokensToBagSpec",value:function(){for(var e=arguments.length,n=new Array(e),t=0;t<e;t++)n[t]=arguments[t];this.currentBagSpec=p.apply(void 0,[this.currentBagSpec].concat(n))}},{key:"nextScenario",value:function(){return this.currentScenario+1<this.campaignSpec.scenarios.length&&(this.currentScenario++,this.currentScenario,this.campaignSpec.scenarios.length),this.getScenarioSpec()}},{key:"prevScenario",value:function(){return this.currentScenario>0&&this.currentScenario--,this.getScenarioSpec()}}],[{key:"start",value:function(n,t,a){return new e(n.name,n,t,n.bagSpecsByLevel[a])}}]),e}(),me={JoeDiamond:{id:"JoeDiamond",name:"Joe Diamond",shortName:"Joe",elderSignEffect:function(){return 1}},DianaStanley:{id:"DianaStanley",name:"Diana Stanley",shortName:"Diana",elderSignEffect:function(){return 2}}};function pe(){return d(s(1,1,!1,"elderSign"),s(1,1),s(0,2),s(-1,2),s(-2,2),s(-3,1),s(-4,1),s(0,2,!0,"Calavera"),S)}function de(){return p(function(e,n){var t={tokens:e.tokens.map((function(e){return f(e)}))},a=m(t,n);return a&&(a.count-=1),t.tokens=t.tokens.filter((function(e){return 0===e.count})),t}(pe(),"1"),s(-5,1))}function ge(){var e="Perdici\xf3n y brecha en tu lugar",n=function(n){return n.context[e]};return{name:"En las garras del caos",scenarioEffectSpec:[{name:"elderSign",effect:function(e){return e.character.elderSignEffect(e)}},{name:"Calavera",effect:function(e){return 0-n(e)}},{name:"Sectario",effect:function(t){var a=b(t,"Sectario");return a.context=Object(u.a)({},e,Math.max(3,n(t)+1)),C(a)}},{name:"L\xe1pida",effect:function(){return-2}},{name:"Antiguo",effect:function(){return-3}}],contextSpec:{valuesSpec:[{name:e,description:e,type:"number",initialValue:0}]}}}function ve(){return{name:"Ante el trono negro",scenarioEffectSpec:[{name:"elderSign",effect:function(e){return e.character.elderSignEffect(e)}},{name:"Calavera",effect:function(e){return 0-Math.max(2,function(e){return Math.ceil(e.context["Perdici\xf3n en Azathoth"]/2)}(e))}},{name:"Sectario",effect:function(e){return C(b(e,"Sectario"))}},{name:"L\xe1pida",effect:function(){return-2}},{name:"Antiguo",effect:function(){return-4}}],contextSpec:{valuesSpec:[{name:"Perdici\xf3n en Azathoth",description:"Perdici\xf3n en Azathoth",type:"number",initialValue:0}]}}}function he(){return{id:"TheCircleUndone",name:"El ci\xb4rculo roto",scenarios:[{name:"Desaparici\xf3n en la finca del crep\xfasculo",scenarioEffectSpec:[{name:"elderSign",effect:function(e){return e.character.elderSignEffect(e)}},{name:"Calavera",effect:function(){return-3}}],contextSpec:{valuesSpec:[]}},{name:"La hora bruja",scenarioEffectSpec:[{name:"elderSign",effect:function(e){return e.character.elderSignEffect(e)}},{name:"Calavera",effect:function(){return-1}},{name:"L\xe1pida",effect:function(){return-3}},{name:"Antiguo",effect:function(){return-3}}],contextSpec:{valuesSpec:[]}},{name:"A las puertas de la muerte",scenarioEffectSpec:[{name:"elderSign",effect:function(e){return e.character.elderSignEffect(e)}},{name:"Calavera",effect:function(e){return e.context["Lugar Embrujado"]?-3:-1}},{name:"L\xe1pida",effect:function(){return-2}},{name:"Antiguo",effect:function(){return-2}}],contextSpec:{valuesSpec:[{name:"Lugar Embrujado",description:"Lugar Embrujado",type:"boolean",initialValue:!1}]}},{name:"El nombre secreto",scenarioEffectSpec:[{name:"elderSign",effect:function(e){return e.character.elderSignEffect(e)}},{name:"Calavera",effect:function(e){return e.context["Lugar Extradimensional"]?-3:-1}},{name:"Sectario",effect:function(e){return C(b(e,"Sectario"))}},{name:"L\xe1pida",effect:function(){return-2}},{name:"Antiguo",effect:function(){return-3}}],contextSpec:{valuesSpec:[{name:"Lugar Extradimensional",description:"Lugar Extradimensional",type:"boolean",initialValue:!1}]}},{name:"La paga del pecado",scenarioEffectSpec:[{name:"elderSign",effect:function(e){return e.character.elderSignEffect(e)}},{name:"Calavera",effect:function(e){return 0-e.context["Asuntos inconclusos"]}},{name:"Sectario",effect:function(e){return e.context["Atacando/Evitando Hereje"]?-4:-3}},{name:"L\xe1pida",effect:function(){return-3}},{name:"Antiguo",effect:function(){return-2}}],contextSpec:{valuesSpec:[{name:"Asuntos inconclusos",description:"Asuntos inconclusos",type:"number",initialValue:0},{name:"Atacando/Evitando Hereje",description:"Atacando/Evitando Hereje",type:"boolean",initialValue:!1}]}},{name:"Por el bien com\xfan",scenarioEffectSpec:[{name:"elderSign",effect:function(e){return e.character.elderSignEffect(e)}},{name:"Calavera",effect:function(e){return 0-e.context["M\xe1xima Perdici\xf3n"]}},{name:"Sectario",effect:function(e){return C(b(e,"Sectario"))-2}},{name:"L\xe1pida",effect:function(){return-3}},{name:"Antiguo",effect:function(){return-3}}],contextSpec:{valuesSpec:[{name:"M\xe1xima Perdici\xf3n",description:"M\xe1xima Perdici\xf3n",type:"number",initialValue:0}]}},{name:"Uni\xf3n y desilusi\xf3n",scenarioEffectSpec:[{name:"elderSign",effect:function(e){return e.character.elderSignEffect(e)}},{name:"Calavera",effect:function(e){return e.context["Acci\xf3n c\xedrculo"]?C(b(e,"Calavera"))-2:-2}},{name:"Sectario",effect:function(){return-3}},{name:"L\xe1pida",effect:function(){return-3}},{name:"Antiguo",effect:function(){return-3}}],contextSpec:{valuesSpec:[{name:"Acci\xf3n c\xedrculo",description:"Acci\xf3n c\xedrculo",type:"boolean",initialValue:!1}]}},ge(),ve()],bagSpecsByLevel:{easy:d(s(1,1,!1,"elderSign"),s(1,2),s(0,3),s(-1,2),s(-2,1),s(-3,1),s(0,2,!0,"Calavera"),S),normal:pe(),hard:de(),expert:d(s(1,1,!1,"elderSign"),s(0,1),s(-1,2),s(-2,2),s(-3,1),s(-4,1),s(-6,1),s(-8,1),s(0,2,!0,"Calavera"),S)}}}function Se(){var e,n,t=(e=[me.JoeDiamond,me.DianaStanley],n="normal",fe.start(he(),e,n));return t.addTokensToBagSpec(s(0,2,!0,"L\xe1pida"),s(0,1,!0,"Sectario"),s(0,1,!0,"Calavera")),t.startCampaign(0),t}var Ee=Se(),ke=Ee.getScenarioSpec(),Ce=Q(ke.contextSpec),ye={skill:4,test:2},be=Object(oe.b)({selectedCampaign:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Ee,n=arguments.length>1?arguments[1]:void 0;switch(n.type){case"NEXT_SCENARIO":return e.nextScenario(),e;case"PREV_SCENARIO":return e.prevScenario(),e;default:return e}},selectedCharacter:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Ee.characters[0],n=arguments.length>1?arguments[1]:void 0;switch(n.type){case"CHANGE_CHARACTER":return n.character;default:return e}},selectedScenario:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ke,n=arguments.length>1?arguments[1]:void 0;switch(n.type){case"CHANGE_SCENARIO":return n.scenarioSpec;default:return e}},gameContext:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Ce,n=arguments.length>1?arguments[1]:void 0;switch(n.type){case"CHANGE_SCENARIO":return Q(n.scenarioSpec.contextSpec);case"INC_DEC_CONTEXT_VALUE":var t=n,a=t.key;return Object.assign({},e,Object(u.a)({},a,g(e,a,t.incDec)));case"TOGGLE_CONTEXT_VALUE":var r=n;return Object.assign({},e,Object(u.a)({},r.key,!e[r.key]));default:return e}},skillTest:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ye,n=arguments.length>1?arguments[1]:void 0,t=n;switch(n.type){case"CHANGE_SKILL":return Object.assign({},e,{skill:l(e.skill,t.incDec)});case"CHANGE_TEST":return Object.assign({},e,{test:l(e.test,t.incDec)});default:return e}}});var xe=function(){var e=function(){var e=localStorage.getItem("ahtok.kortsoft.net/state");return e?JSON.parse(e):void 0}();if(e){var n=se[e.campaignSpecId],t=e.characters.map((function(e){return me[e]})),a=new fe(e.name,n,t,e.bagSpec,e.currentScenario),r=me[e.currentCharacter];return{selectedCampaign:a,selectedScenario:a.getScenarioSpec(),selectedCharacter:r,skillTest:{skill:4,test:2},gameContext:e.currentContext}}var c=Se(),i=c.getScenarioSpec();return{selectedCampaign:c,selectedScenario:i,selectedCharacter:c.characters[0],skillTest:{skill:4,test:2},gameContext:Q(i.contextSpec)}}();console.log("Loaded initial state",xe);var Ae=Object(oe.c)(be,xe);Ae.subscribe((function(){var e=Ae.getState().selectedCampaign,n={name:e.name,campaignSpecId:e.campaignSpec.id,bagSpec:e.currentBagSpec,characters:e.characters.map((function(e){return e.id})),currentScenario:e.currentScenario,currentCharacter:Ae.getState().selectedCharacter.id,currentContext:Ae.getState().gameContext};localStorage.setItem("ahtok.kortsoft.net/state",JSON.stringify(n))}));var Ne=function(){var e=Ae.getState().selectedCampaign;function n(e){Ae.dispatch({type:"CHANGE_SCENARIO",scenarioSpec:e})}var t=function(){var e=["-apple-system","BlinkMacSystemFont",'"Segoe UI"',"Roboto",'"Helvetica Neue"',"Arial","sans-serif",'"Apple Color Emoji"','"Segoe UI Emoji"','"Segoe UI Symbol"'];return{theme:Object(ce.a)(Object(ie.a)({typography:{fontFamily:["UglyQua"].concat(e).join(","),fontSize:14},palette:{tonalOffset:1,type:"dark",primary:{main:"#205b57"},secondary:{main:"#f4ebcc"}}})),headerFontFamily:["Birmingham"].concat(e).join(",")}}();return r.a.createElement(re.a,{theme:t.theme},r.a.createElement(ee.a,null,r.a.createElement(I.a,{store:Ae},r.a.createElement("div",{className:"App"},r.a.createElement(T.a,{style:{fontFamily:t.headerFontFamily,textAlign:"center"},variant:"h2",color:"secondary",variantMapping:{h1:"header"},className:"App-header"},e.name),r.a.createElement(ne.a,{className:"MainContainer",maxWidth:"lg"},r.a.createElement(te.a,{textAlign:"center"},r.a.createElement(ae.a,{color:"secondary",onClick:function(){return n(e.prevScenario())}},"Prev"),r.a.createElement(ae.a,{color:"secondary",onClick:function(){return n(e.nextScenario())}},"Next")),r.a.createElement(q,null))))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(Ne,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[65,1,2]]]);
//# sourceMappingURL=main.978ab4c3.chunk.js.map